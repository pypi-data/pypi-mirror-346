<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video</title>
    <style>
        html, body { margin:0; padding:0; background:#000; }
        video {
            width:100vw; height:100vh;
            object-fit: contain;
            /* prevent context-menu seeking on some browsers */
            -webkit-touch-callout:none; user-select:none;
        }
    </style>
</head>
<body>
    <video id="vid"
           autoplay
           muted                <!-- plays without sound -->
           playsinline          <!-- iOS iPad/iPhone stays in-page -->
           disablepictureinpicture
           controlslist="nodownload noremoteplayback nofullscreen">
        <source src="{{ url_for('static', filename='videos/' + filename) }}"  type="video/mp4">
        <source src="{{ url_for('static', filename='videos/' + filename.rsplit('.', 1)[0] + '.webm') }}" type="video/webm">
        Your browser does not support the video tag.
    </video>

    <script>
        const start = Date.now();
        const video = document.getElementById('vid');
        let lastSafeTime = 0;      // track legitimate playback position

        /* extra safety: be sure itâ€™s muted even if the attribute fails */
        video.muted = true;

        // Keep track of normal progress
        video.addEventListener('timeupdate', () => { lastSafeTime = video.currentTime; });

        // Block any seek attempts (keyboard drag/touch, etc.)
        video.addEventListener('seeking', () => {
            if (Math.abs(video.currentTime - lastSafeTime) > 0.25) {
                video.currentTime = lastSafeTime;
            }
        });

        // Auto-resume if user pauses
        video.addEventListener('pause', () => {
            if (!video.ended) video.play();
        });

        // When finished, hand control back to parent
        video.addEventListener('ended', () => {
            const duration = Date.now() - start;
            parent.nextStep(null, duration);
        });

        // Optional: prevent space-bar from pausing the video
        window.addEventListener('keydown', e => {
            if (e.code === 'Space') { e.preventDefault(); }
        });
    </script>
</body>
</html>