# Copyright (C) 2023 Bloomberg LP
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#  <http://www.apache.org/licenses/LICENSE-2.0>
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

[build-system]
requires = ["setuptools >= 44", "wheel >= 0.35"]
build-backend = "setuptools.build_meta"

[project]
name = "buildgrid-common"
version = "0.5.2"
requires-python = ">=3.10"
description = "Shared Python library for BuildGrid ecosystem"
license = { text = "Apache License, Version 2.0" }
classifiers = ["Programming Language :: Python :: 3"]
readme = "README.md"
dependencies = ["grpcio >= 1.33.2", "protobuf", "pydantic", "ruamel.yaml"]

[tool.setuptools.package-data]
"*" = ["*.pyi", "py.typed"]

[project.optional-dependencies]
metrics = ["statsd"]
jwt = ["pyjwt[crypto]"]
dev = [
    # Testing
    "pytest",
    "pytest-cov",
    "pytest-asyncio",
    "freezegun",
    # Typing
    "mypy",
    "mypy-protobuf < 3.5", # The upstream released a new approach to generate async subs. TODO: have a discussion whether we should follow that approach.
    "grpc-stubs",
    # Formating / linting
    "isort",
    "black",
    "flake8",
]
all = ["buildgrid-common[dev,metrics,jwt]"]

[tool.setuptools.packages.find]
include = ["buildgrid.common*"]
exclude = ["tests*"]

[tool.mypy]
strict = true
ignore_missing_imports = true
explicit_package_bases = true

[tool.black]
line-length = 119
extend-exclude = "(buildgrid/common/protos)"

[tool.isort]
line_length = 119
multi_line_output = 3
include_trailing_comma = true
use_parentheses = true
ensure_newline_before_comments = true
extend_skip_glob = ["buildgrid/common/protos/*"]
