import{d as A,aA as me,aC as fe,c as f,o as p,e as g,f as d,s as P,ah as ge,G as X,_ as R,i as x,a as V,r as N,aT as ve,aU as Y,w as U,b as D,x as T,z as S,A as z,t as Q,aE as he,aV as ye,am as Z,u as ee,I as F,X as w,N as C,Y as te,k as Ce,W as H,y as J}from"./index-C7odhkMa.js";import{T as be}from"./BuilderApp-DRMjpidg.js";import{u as _e}from"./useComponentDescription-X_W6P_20.js";import"./marked.esm-273vDTCT.js";const Be={class:"BuilderSidebarPanel"},Ie={class:"BuilderSidebarPanel__inputContainer"},Se={class:"BuilderSidebarPanel__main"},Te={class:"BuilderSidebarPanel__footer"},ke=A({__name:"BuilderSidebarPanel",props:me({placeholder:{type:String,required:!0},searchCount:{type:Number,required:!1,default:void 0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const o=fe(i,"modelValue"),e=i,a=f(()=>{if(e.searchCount!==void 0)return`${e.searchCount} result${e.searchCount===1?"":"s"}`});return(t,u)=>(p(),g("div",Be,[d("div",Ie,[P(ge,{modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=s=>o.value=s),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:i.placeholder,"right-text":a.value,"enable-clear-button":""},null,8,["modelValue","placeholder","right-text"])]),d("div",Se,[X(t.$slots,"default",{},void 0,!0)]),d("div",Te,[X(t.$slots,"footer",{},void 0,!0)])]))}}),ne=R(ke,[["__scopeId","data-v-99679ce7"]]),$e={class:"header"},we={class:"tools"},De=["data-writer-tooltip","data-component-type","onDragstart"],xe={class:"name"},Ve=A({__name:"BuilderSidebarToolkit",setup(i){const o=x(V.core),e=x(V.builderManager),{removeInsertionCandidacy:a}=Z(o),t=N(""),u=["Layout","Content","Input","Embed","Writer","Logic","Triggers","Other"],s=f(()=>e.getMode()=="blueprints"?"blueprints":"core"),k=f(()=>{const m=u.map(c=>[c,v(c)]).filter(([c,b])=>b.length>0);return Object.fromEntries(m)}),L=f(()=>{if(t.value)return Object.values(k.value).reduce((m,c)=>m+c.length,0)}),q=f(()=>s.value=="core"?"Core toolkit":s.value=="blueprints"?"Blueprints toolkit":"Toolkit");function v(m){const b=ve().filter(l=>{const _=Y(l);return!(_.category!=m||!_.toolkit&&s.value!=="core"||_.toolkit&&_.toolkit!==s.value||_.deprecated)}).map(l=>{const{name:_,description:O,category:j}=Y(l);return{type:l,name:_,description:O,category:j??"Other"}}),I=t.value.toLocaleLowerCase();return b.filter(l=>!I||l.name.toLocaleLowerCase().includes(I))}function h(m,c){e.setSelection(null),m.dataTransfer.setData(`application/json;writer=${c},`,"{}")}function M(m){a(m)}function E(m){return[`/components/${m.type}.svg`,`/components/${s.value=="blueprints"?"blueprints_":""}category_${m.category}.svg`].map(c=>ye(c))}return U(s,()=>{t.value=""}),(m,c)=>(p(),D(ne,{modelValue:t.value,"onUpdate:modelValue":c[1]||(c[1]=b=>t.value=b),class:"BuilderSidebarToolkit",placeholder:q.value,"search-count":L.value},{default:T(()=>[(p(!0),g(S,null,z(k.value,(b,I)=>(p(),g("div",{key:I,class:"category"},[d("div",$e,Q(I),1),d("div",we,[(p(!0),g(S,null,z(b,y=>(p(),g("div",{key:y.type,class:"tool","data-writer-tooltip":y.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":y.type,onDragend:c[0]||(c[0]=l=>M(l)),onDragstart:l=>h(l,y.type)},[P(he,{alt:`(Icon for ${y.name})`,draggable:"false",urls:E(y)},null,8,["alt","urls"]),d("div",xe,Q(y.name),1)],40,De))),128))])]))),128))]),_:1},8,["modelValue","placeholder","search-count"]))}}),Le=R(Ve,[["__scopeId","data-v-7ac79aa6"]]);function oe(i,o){function e(a){if(!o.value)return!0;const t=i.getComponentDefinition(a.type);return!!(t!=null&&t.name.toLocaleLowerCase().includes(o.value)||Object.values(a.content).filter(s=>s.toLocaleLowerCase().includes(o.value)).length>0)}return{isComponentMatchingQuery:e}}function qe(i,o,e){const{isComponentMatchingQuery:a}=oe(i,o);return{searchResultCount:f(()=>{if(!o.value)return;let u=0;for(const s of i.getComponentsNested(e.value))a(s)&&u++;return u})}}function Me(i,o,e){const{isComponentMatchingQuery:a}=oe(i,o),t=f(()=>!o.value||a(e.value));return{hasMatchingChildren:f(()=>{if(!o.value)return!0;for(const s of i.getComponentsNested(e.value.id))if(a(s))return!0;return!1}),matched:t}}const Pe={class:"BuilderSidebarComponentTreeBranch__nameRight"},Ae={class:"previewText"},Re=A({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch"],setup(i,{emit:o}){const e=i,a=N(),t=x(V.core),u=x(V.builderManager),s=N(!1),k=f(()=>u.isComponentIdSelected(e.componentId)),L=ee(t),{createAndInsertComponent:q,moveComponent:v,goToComponentParentPage:h,isDraggingAllowed:M}=te(t,u,L),{getComponentInfoFromDrag:E,removeInsertionCandidacy:m,isParentSuitable:c}=Z(t),{isComponentVisible:b}=Ce(t),I=o,y=f(()=>{var r;return((r=e.query)==null?void 0:r.toLocaleLowerCase())??""}),l=f(()=>t.getComponentById(e.componentId)),{hasMatchingChildren:_,matched:O}=Me(t,y,l);U(_,r=>{var n;return(n=a.value)==null?void 0:n.toggleCollapse(!r)},{immediate:!0});const j=f(()=>t.getComponents(e.componentId,{sortedByPosition:!0})),{name:re,previewText:G}=_e(t,l);async function se(r){h(e.componentId),await F(),u.handleSelectionFromEvent(r,e.componentId,void 0,"tree"),W()}function W(){a.value&&(a.value.expand(),s.value=!1,I("expandBranch"))}function le(){var K;const r=(K=a.value)==null?void 0:K.$el;if(!r)return;const n=r.closest(".BuilderSidebarComponentTree"),B=n.getBoundingClientRect(),$=a.value.$el.offsetTop-B.height/2,pe=a.value.$el.offsetLeft-B.left-16;n.scrollTo({top:$,left:Math.max(0,pe),behavior:"smooth"})}function ie(r){u.setSelection(null),r.dataTransfer.setData(`application/json;writer=${l.value.type},${l.value.id}`,"{}")}function de(r){m(r)}function ue(r){const n=E(r);if(!n)return;const{draggedType:B,draggedId:$}=n;c(e.componentId,$,B)&&r.preventDefault()}function ce(r){const n=E(r);if(!n)return;const{draggedType:B,draggedId:$}=n;$?v($,l.value.id):q(B,l.value.id),m(r)}return U(u.firstSelectedItem,async r=>{r&&r.componentId===e.componentId&&r.source!="tree"&&(W(),await F(),le())},{immediate:!0}),(r,n)=>(p(),D(be,{ref_key:"treeBranch",ref:a,class:"BuilderSidebarComponentTreeBranch","component-id":i.componentId,name:C(re),query:i.query,"has-children":j.value.length>0,"data-automation-key":l.value.type,draggable:C(M)(i.componentId),matched:C(O),selected:k.value,onSelect:se,onDragover:ue,onDragstart:ie,onDragend:de,onDrop:ce},{nameRight:T(()=>[d("span",Pe,[Object.keys(l.value.handlers??{}).length>0?(p(),g(S,{key:0},[n[0]||(n[0]=d("span",{class:"middot"},null,-1)),n[1]||(n[1]=d("i",{class:"material-symbols-outlined"},"bolt",-1))],64)):w("",!0),C(b)(l.value.id)?w("",!0):(p(),g(S,{key:1},[n[2]||(n[2]=d("span",{class:"middot"},null,-1)),n[3]||(n[3]=d("i",{class:"material-symbols-outlined"},"visibility_off",-1))],64)),l.value.isCodeManaged?(p(),g(S,{key:2},[n[4]||(n[4]=d("span",{class:"middot"},null,-1)),n[5]||(n[5]=d("i",{class:"material-symbols-outlined"},"terminal",-1))],64)):w("",!0),C(G)?(p(),g(S,{key:3},[n[6]||(n[6]=d("span",{class:"middot"},null,-1)),d("span",Ae,Q(C(G)),1)],64)):w("",!0)])]),children:T(()=>[(p(!0),g(S,null,z(j.value,B=>(p(),D(ae,{key:B.id,"component-id":B.id,query:i.query,onExpandBranch:W},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected"]))}}),ae=R(Re,[["__scopeId","data-v-35723b97"]]),Ee={class:"add"},je=A({__name:"BuilderSidebarComponentTree",setup(i){const o=x(V.core),e=x(V.builderManager),a=N(""),t=ee(o),{createAndInsertComponent:u}=te(o,e,t),s=e.activeRootId,{searchResultCount:k}=qe(o,a,s);async function L(){const v=u("page","root");o.setActivePageId(v),await F(),e.setSelection(v),t.track("ui_page_added")}async function q(){const v=u("blueprints_blueprint","blueprints_root");o.setActivePageId(v),await F(),e.setSelection(v),t.track("blueprints_new_added")}return(v,h)=>(p(),D(ne,{modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=M=>a.value=M),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":C(k)},{footer:T(()=>[d("div",Ee,[C(s)=="root"?(p(),D(H,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:L},{default:T(()=>h[1]||(h[1]=[d("i",{class:"material-symbols-outlined"}," add ",-1),J(" Add page")])),_:1})):w("",!0),C(s)=="blueprints_root"?(p(),D(H,{key:1,variant:"special",size:"small","data-automation-action":"add-blueprint",onClick:q},{default:T(()=>h[2]||(h[2]=[d("i",{class:"material-symbols-outlined"}," add ",-1),J(" Add blueprint")])),_:1})):w("",!0)])]),default:T(()=>[d("div",null,[P(ae,{class:"rootBranch","component-id":C(s),query:a.value},null,8,["component-id","query"])])]),_:1},8,["modelValue","search-count"]))}}),Ne=R(je,[["__scopeId","data-v-4a1fcc37"]]),Fe={class:"BuilderSidebar"},Oe=A({__name:"BuilderSidebar",setup(i){return(o,e)=>(p(),g("div",Fe,[P(Le),P(Ne)]))}}),Ge=R(Oe,[["__scopeId","data-v-c1777f55"]]);export{Ge as default};
