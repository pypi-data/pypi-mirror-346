/* Global styles */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
    display: grid;
    grid-template-columns: 250px 1fr; /* Sidebar and main content */
    grid-template-rows: auto 1fr auto; /* Header, content, footer */
    grid-template-areas:
        "header header"
        "sidebar main"
        "footer footer";
    min-height: 100vh;
    margin: 0; 
    background-color: var(--pico-background-color); /* Ensure body background is dark too */
}
header.top-header { 
    grid-area: header; 
    border-bottom: 1px solid var(--pico-muted-border-color); 
    padding: 0.5rem 1rem; 
    background-color: var(--pico-card-background-color); /* Consistent dark background */
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    position: fixed; 
    top: 0; 
    left: 0; 
    right: 0; 
    z-index: 1001; 
}
main.main-content { 
    grid-area: main; 
    padding: 1rem; 
    overflow-y: auto; 
    margin-top: 3.5rem; 
    background-color: var(--pico-background-color); /* Main content area background */
} 
footer.main-footer { 
    grid-area: footer; 
    padding: 0.5rem 1rem; 
    border-top: 1px solid var(--pico-muted-border-color); 
    font-size: 0.8em; 
    text-align: center;
    background-color: var(--pico-card-background-color); /* Consistent dark background */
}

/* --- Updated Sidebar Styles --- */
aside.sidebar { 
    grid-area: sidebar; 
    /* THIS IS THE KEY CHANGE FOR BACKGROUND */
    background-color: var(--pico-card-background-color); /* Match card/header */
    padding: 1rem; 
    border-right: 1px solid var(--pico-muted-border-color); 
    overflow-y: auto;
    margin-top: 3.5rem; 
    height: calc(100vh - 3.5rem - 2.1rem); 
    position: fixed; 
    left: 0;
    top: 3.5rem; 
    bottom: 2.1rem; 
    width: 250px; 
    z-index: 1000; 
}
.sidebar nav h5 { 
    margin-top: 1rem; 
    margin-bottom: 0.75rem; 
    padding-left: 0.75rem; 
    color: var(--pico-muted-color);
    font-size: 0.9em;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}
.sidebar nav h5:first-of-type {
    margin-top: 0; 
}
.sidebar nav ul { 
    padding-left: 0; 
    list-style: none; 
    margin-bottom: 1.5rem; 
}
.sidebar nav li { 
    margin-bottom: 0; 
}
/* Links and buttons in sidebar */
.sidebar nav a, .sidebar nav button { 
    display: block; 
    width: 100%; 
    text-align: left; 
    margin-bottom: 0; 
    padding: 0.6rem 0.75rem; 
    border: none; 
    background-color: transparent; 
    color: var(--pico-contrast); /* Ensure good contrast on dark background */
    text-decoration: none; 
    border-radius: var(--pico-border-radius); 
    font-size: 0.95em;
    cursor: pointer; 
    transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out;
}
/* Remove Pico's default outline styling for buttons if class 'outline' or 'contrast' is used */
.sidebar nav button.outline, .sidebar nav button.contrast {
     border: 1px solid transparent; /* Make border transparent initially */
     background-color: transparent; 
     color: var(--pico-contrast); 
}
.sidebar nav button.outline:hover, .sidebar nav button.contrast:hover {
    border-color: var(--pico-primary-hover-border); /* Show border on hover for outline/contrast */
}

.sidebar nav a:hover, .sidebar nav button:hover {
    background-color: var(--pico-primary-focus); /* Use a subtle hover, primary-focus is good */
    color: var(--pico-primary-inverse);
    text-decoration: none; 
}
/* Active navigation item */
.sidebar nav a[aria-current="page"], 
.sidebar nav button[aria-current="page"],
.sidebar nav a.active-nav, 
.sidebar nav button.active-nav { 
     background-color: var(--pico-primary);
     color: var(--pico-primary-inverse);
     font-weight: bold;
}
/* --- End Sidebar Styles --- */


/* Message container positioning */
.message-container { position: fixed; bottom: 3rem; right: 1rem; z-index: 1002; /* Higher than sidebar */ width: auto; max-width: 400px; }
.message-container > div { margin-top: 0.5rem; box-shadow: var(--pico-card-box-shadow); display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-radius: var(--pico-border-radius); font-weight: 500;}
.message-container .success { background-color: var(--pico-ins-color); color: var(--pico-primary-inverse); border: 1px solid var(--pico-ins-color); }
.message-container .error { background-color: var(--pico-del-color); color: var(--pico-primary-inverse); border: 1px solid var(--pico-del-color); }
.message-container .close { background: none; border: none; color: inherit; font-size: 1.2rem; cursor: pointer; padding: 0 0.5rem; margin-left: 1rem; }


/* Editor Layout - Agent Manager View */
.editor-grid { display: grid; grid-template-columns: minmax(250px, 1fr) 2fr; gap: var(--pico-spacing); align-items: start; }
#agent-list-panel, #agent-detail-panel { height: calc(80vh - var(--pico-block-spacing-vertical) * 2); overflow-y: auto; }
#agent-list-panel article, #agent-detail-panel article { background-color: var(--pico-card-background-color); padding: var(--pico-block-spacing-vertical) var(--pico-block-spacing-horizontal); height: 100%; display: flex; flex-direction: column; }
#agent-list-panel header, #agent-detail-panel header { flex-shrink: 0; }
#agent-list-panel ul { flex-grow: 1; overflow-y: auto; list-style-type: none; padding: 0; margin-top: 1rem; }
#agent-list-panel li { padding: 0.75rem; border: 1px solid var(--pico-muted-border-color); margin-bottom: 0.5rem; border-radius: var(--pico-border-radius); cursor: pointer; transition: background-color 0.2s ease-in-out; }
#agent-list-panel li:hover, #agent-list-panel li.htmx-settling { background-color: var(--pico-muted-hover-background-color); }
#agent-list-panel li.selected-agent { background-color: var(--pico-primary-focus); border-color: var(--pico-primary); color: var(--pico-primary-inverse); }
#agent-list-panel li small { color: var(--pico-muted-color); }
#agent-list-panel .grid { margin-top: auto; padding-top: 1rem; }

/* Agent Detail Form Refinements */
#agent-detail-panel form { flex-grow: 1; overflow-y: auto; padding-right: 0.5rem; }
#agent-detail-panel fieldset { margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--pico-muted-border-color); }
#agent-detail-panel fieldset:last-of-type { border-bottom: none; margin-bottom: 0; }
#agent-detail-form-content .grid { margin-top: 1rem; flex-shrink: 0; }

/* Tool Checklist */
.tool-checklist { max-height: 150px; overflow-y: auto; border: 1px solid var(--pico-muted-border-color); padding: 0.5rem; margin-bottom: 0.75rem; border-radius: var(--pico-border-radius); background-color: var(--pico-form-element-background-color); /* Match form input background */}
.tool-checklist label { display: block; margin-bottom: 0.25rem; font-weight: normal; }
.tool-checklist input[type="checkbox"] { margin-right: 0.5rem; }
.tool-checklist label small { color: var(--pico-muted-color); }

/* Execution & Results Display */
#execution-panel article { margin-bottom: 1rem; } 
#results-display-container { margin-top: 0; }
#results-display { background-color: var(--pico-code-background-color); color: var(--pico-code-color); padding: 1rem; border-radius: var(--pico-border-radius); overflow-x: auto; margin-top: 1rem; min-height: 100px; border: 1px solid var(--pico-muted-border-color); }
#results-display pre { margin: 0; white-space: pre-wrap; word-break: break-all; }
#results-display .structured-table { border: 1px solid var(--pico-muted-border-color); font-size: 0.9em; width: 100%; margin-bottom: 0.75rem !important; border-collapse: collapse; } 
#results-display .structured-table td, #results-display .structured-table th { padding: 0.4em 0.6em !important; vertical-align: top; border-bottom: 1px solid var(--pico-muted-border-color); }
#results-display .structured-table tr:last-child td { border-bottom: none; }
#results-display .structured-table td[style*="font-weight: bold"] { color: var(--pico-secondary); min-width: 120px; max-width: 250px; word-break: break-word; border-right: 1px solid var(--pico-muted-border-color); }
#results-display .structured-table ul { margin-left: 1em; padding-left: 1em; } 

/* HTMX Indicators */
.htmx-indicator { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; }
.htmx-request .htmx-indicator { display: inline-block; opacity: 1; margin-left: 0.5em; }
.htmx-request.htmx-indicator { display: inline-block; opacity: 1; }

/* Registry Viewer Specific */
#registry-page-content nav ul[role="group"] { margin-bottom: 1rem; }
#registry-page-content nav ul[role="group"] li button { width: 100%; }
#registry-table-container table { margin-top: 1rem; }

/* Utility for form field errors */
.field-error { color: var(--pico-del-color); font-size: var(--pico-font-size-small); margin-top: -0.5rem; margin-bottom: 0.5rem; }