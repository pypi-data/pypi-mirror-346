{"version":3,"file":"CApsgvDX.js","sources":["../../../../../../src/lib/utils/websocket.ts"],"sourcesContent":["import { io } from 'socket.io-client';\n\nimport { socket, activeUserIds, USAGE_POOL } from '$lib/stores';\nimport { WEBUI_BASE_URL } from '$lib/constants';\n\nexport const setupSocket = async (enableWebsocket) => {\n\tconst _socket = io(`${WEBUI_BASE_URL}` || undefined, {\n\t\treconnection: true,\n\t\treconnectionDelay: 1000,\n\t\treconnectionDelayMax: 5000,\n\t\trandomizationFactor: 0.5,\n\t\tpath: '/ws/socket.io',\n\t\ttransports: enableWebsocket ? ['websocket'] : ['polling', 'websocket'],\n\t\tauth: { token: localStorage.token }\n\t});\n\n\tawait socket.set(_socket);\n\n\t_socket.on('connect_error', (err) => {\n\t\tconsole.log('connect_error', err);\n\t});\n\n\t_socket.on('connect', () => {\n\t\tconsole.log('connected', _socket.id);\n\t});\n\n\t_socket.on('reconnect_attempt', (attempt) => {\n\t\tconsole.log('reconnect_attempt', attempt);\n\t});\n\n\t_socket.on('reconnect_failed', () => {\n\t\tconsole.log('reconnect_failed');\n\t});\n\n\t_socket.on('disconnect', (reason, details) => {\n\t\tconsole.log(`Socket ${_socket.id} disconnected due to ${reason}`);\n\t\tif (details) {\n\t\t\tconsole.log('Additional details:', details);\n\t\t}\n\t});\n\n\t_socket.on('user-list', (data) => {\n\t\tconsole.log('user-list', data);\n\t\tactiveUserIds.set(data.user_ids);\n\t});\n\n\t_socket.on('usage', (data) => {\n\t\tconsole.log('usage', data);\n\t\tUSAGE_POOL.set(data['models']);\n\t});\n};\n"],"names":["setupSocket","enableWebsocket","_socket","io","WEBUI_BASE_URL","socket","err","attempt","reason","details","data","activeUserIds","USAGE_POOL"],"mappings":"yFAKa,MAAAA,EAAc,MAAOC,GAAoB,CACrD,MAAMC,EAAUC,EAAG,GAAGC,CAAc,IAAM,OAAW,CACpD,aAAc,GACd,kBAAmB,IACnB,qBAAsB,IACtB,oBAAqB,GACrB,KAAM,gBACN,WAAYH,EAAkB,CAAC,WAAW,EAAI,CAAC,UAAW,WAAW,EACrE,KAAM,CAAE,MAAO,aAAa,KAAM,CAAA,CAClC,EAEK,MAAAI,EAAO,IAAIH,CAAO,EAEhBA,EAAA,GAAG,gBAAkBI,GAAQ,CAC5B,QAAA,IAAI,gBAAiBA,CAAG,CAAA,CAChC,EAEOJ,EAAA,GAAG,UAAW,IAAM,CACnB,QAAA,IAAI,YAAaA,EAAQ,EAAE,CAAA,CACnC,EAEOA,EAAA,GAAG,oBAAsBK,GAAY,CACpC,QAAA,IAAI,oBAAqBA,CAAO,CAAA,CACxC,EAEOL,EAAA,GAAG,mBAAoB,IAAM,CACpC,QAAQ,IAAI,kBAAkB,CAAA,CAC9B,EAEDA,EAAQ,GAAG,aAAc,CAACM,EAAQC,IAAY,CAC7C,QAAQ,IAAI,UAAUP,EAAQ,EAAE,wBAAwBM,CAAM,EAAE,EAC5DC,GACK,QAAA,IAAI,sBAAuBA,CAAO,CAC3C,CACA,EAEOP,EAAA,GAAG,YAAcQ,GAAS,CACzB,QAAA,IAAI,YAAaA,CAAI,EACfC,EAAA,IAAID,EAAK,QAAQ,CAAA,CAC/B,EAEOR,EAAA,GAAG,QAAUQ,GAAS,CACrB,QAAA,IAAI,QAASA,CAAI,EACdE,EAAA,IAAIF,EAAK,MAAS,CAAA,CAC7B,CACF"}