<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- Form view -->
    <record id="view_email_template_form" model="ir.ui.view">
        <field name="name">view_email_template_form</field>
        <field name="model">mail.template</field>
        <field name="inherit_id" ref="mail.email_template_form" />
        <field name="arch" type="xml">
            <field name="model_id" position="after">
                <field name="is_redner_template" />
            </field>

            <!-- Hide HTML contents, superseded by the body produced by redner. -->
            <xpath expr="//field[@name='body_html']" position="attributes">
                <attribute name="invisible"><![CDATA[is_redner_template]]></attribute>
            </xpath>

            <!-- Hide the single attachment selector too, not supported with redner. -->
            <xpath expr="//field[@name='attachment_ids']" position="attributes">
                <attribute name="invisible"><![CDATA[is_redner_template]]></attribute>
            </xpath>

            <!-- Add redner fields instead of the above. -->
            <xpath expr="//field[@name='body_html']" position="before">
                <group string="Redner Template" invisible="not is_redner_template">
                    <field name="redner_tmpl_id" required="is_redner_template" />
                </group>

                <button
                    confirm="Keywords will be updated. Continue?"
                    name="action_get_substitutions"
                    type="object"
                    string="Get Substitutions from Redner Template"
                    invisible="not is_redner_template"
                />

                <group string="Substitutions" invisible="not is_redner_template">
                    <field name="redner_substitution_ids" nolabel="1" colspan="2">
                        <list editable="top" default_order="keyword asc">
                            <field name="sequence" widget="handle" />
                            <field name="keyword" />
                            <field name="converter" />
                            <field name="value_type" />
                            <field name="render_model" column_invisible="1" />
                            <field name="value_placeholder" column_invisible="1" />
                            <field
                                name="hide_placeholder_button"
                                column_invisible="1"
                            />
                            <field
                                name="value"
                                class="text-break"
                                required="converter != False"
                                options="{
                                    'dynamic_placeholder': true,
                                    'dynamic_placeholder_model_reference_field': 'render_model'
                                    'placeholder_field': 'value_placeholder',
                                    'redner_dynamic_placeholder': true,
                                    'button_visibility_field': 'hide_placeholder_button',
                                    'converter_field': 'converter',
                                }"
                                default_focus="1"
                            />
                        </list>
                    </field>
                </group>
            </xpath>
        </field>
    </record>
</odoo>
