const B=/\{[^{}]+\}/g,F=()=>{var e,r;return typeof process=="object"&&Number.parseInt((r=(e=process==null?void 0:process.versions)==null?void 0:e.node)==null?void 0:r.substring(0,2))>=18&&process.versions.undici};function G(){return Math.random().toString(36).slice(2,11)}function M(e){let{baseUrl:r="",Request:t=globalThis.Request,fetch:a=globalThis.fetch,querySerializer:n,bodySerializer:s,headers:l,requestInitExt:f=void 0,...v}={...e};f=F()?f:void 0,r=H(r);const h=[];async function y(i,o){const{baseUrl:m,fetch:C=a,Request:Y=t,headers:N,params:w={},parseAs:T="json",querySerializer:g,bodySerializer:I=s??Q,body:D,...U}=o||{};m&&(r=H(m));let q=typeof n=="function"?n:P(n);g&&(q=typeof g=="function"?g:P({...typeof n=="object"?n:{},...g}));const x=D===void 0?void 0:I(D),W=x===void 0||x instanceof FormData?{}:{"Content-Type":"application/json"},k={redirect:"follow",...v,...U,body:x,headers:V(W,l,N,w.header)};let j,S,p=new t(K(i,{baseUrl:r,params:w,querySerializer:q}),k);for(const d in U)d in p||(p[d]=U[d]);if(h.length){j=G(),S=Object.freeze({baseUrl:r,fetch:C,parseAs:T,querySerializer:q,bodySerializer:I});for(const d of h)if(d&&typeof d=="object"&&typeof d.onRequest=="function"){const u=await d.onRequest({request:p,schemaPath:i,params:w,options:S,id:j});if(u){if(!(u instanceof t))throw new Error("onRequest: must return new Request() when modifying the request");p=u}}}let c;try{c=await C(p,f)}catch(d){let u=d;if(h.length)for(let b=h.length-1;b>=0;b--){const $=h[b];if($&&typeof $=="object"&&typeof $.onError=="function"){const R=await $.onError({request:p,error:u,schemaPath:i,params:w,options:S,id:j});if(R){if(R instanceof Response){u=void 0,c=R;break}if(R instanceof Error){u=R;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(u)throw u}if(h.length)for(let d=h.length-1;d>=0;d--){const u=h[d];if(u&&typeof u=="object"&&typeof u.onResponse=="function"){const b=await u.onResponse({request:p,response:c,schemaPath:i,params:w,options:S,id:j});if(b){if(!(b instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");c=b}}}if(c.status===204||c.headers.get("Content-Length")==="0")return c.ok?{data:void 0,response:c}:{error:void 0,response:c};if(c.ok)return T==="stream"?{data:c.body,response:c}:{data:await c[T](),response:c};let z=await c.text();try{z=JSON.parse(z)}catch{}return{error:z,response:c}}return{request(i,o,m){return y(o,{...m,method:i.toUpperCase()})},GET(i,o){return y(i,{...o,method:"GET"})},PUT(i,o){return y(i,{...o,method:"PUT"})},POST(i,o){return y(i,{...o,method:"POST"})},DELETE(i,o){return y(i,{...o,method:"DELETE"})},OPTIONS(i,o){return y(i,{...o,method:"OPTIONS"})},HEAD(i,o){return y(i,{...o,method:"HEAD"})},PATCH(i,o){return y(i,{...o,method:"PATCH"})},TRACE(i,o){return y(i,{...o,method:"TRACE"})},use(...i){for(const o of i)if(o){if(typeof o!="object"||!("onRequest"in o||"onResponse"in o||"onError"in o))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");h.push(o)}},eject(...i){for(const o of i){const m=h.indexOf(o);m!==-1&&h.splice(m,1)}}}}function A(e,r,t){if(r==null)return"";if(typeof r=="object")throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${e}=${(t==null?void 0:t.allowReserved)===!0?r:encodeURIComponent(r)}`}function L(e,r,t){if(!r||typeof r!="object")return"";const a=[],n={simple:",",label:".",matrix:";"}[t.style]||"&";if(t.style!=="deepObject"&&t.explode===!1){for(const f in r)a.push(f,t.allowReserved===!0?r[f]:encodeURIComponent(r[f]));const l=a.join(",");switch(t.style){case"form":return`${e}=${l}`;case"label":return`.${l}`;case"matrix":return`;${e}=${l}`;default:return l}}for(const l in r){const f=t.style==="deepObject"?`${e}[${l}]`:l;a.push(A(f,r[l],t))}const s=a.join(n);return t.style==="label"||t.style==="matrix"?`${n}${s}`:s}function _(e,r,t){if(!Array.isArray(r))return"";if(t.explode===!1){const s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[t.style]||",",l=(t.allowReserved===!0?r:r.map(f=>encodeURIComponent(f))).join(s);switch(t.style){case"simple":return l;case"label":return`.${l}`;case"matrix":return`;${e}=${l}`;default:return`${e}=${l}`}}const a={simple:",",label:".",matrix:";"}[t.style]||"&",n=[];for(const s of r)t.style==="simple"||t.style==="label"?n.push(t.allowReserved===!0?s:encodeURIComponent(s)):n.push(A(e,s,t));return t.style==="label"||t.style==="matrix"?`${a}${n.join(a)}`:n.join(a)}function P(e){return function(t){const a=[];if(t&&typeof t=="object")for(const n in t){const s=t[n];if(s!=null){if(Array.isArray(s)){if(s.length===0)continue;a.push(_(n,s,{style:"form",explode:!0,...e==null?void 0:e.array,allowReserved:(e==null?void 0:e.allowReserved)||!1}));continue}if(typeof s=="object"){a.push(L(n,s,{style:"deepObject",explode:!0,...e==null?void 0:e.object,allowReserved:(e==null?void 0:e.allowReserved)||!1}));continue}a.push(A(n,s,e))}}return a.join("&")}}function J(e,r){let t=e;for(const a of e.match(B)??[]){let n=a.substring(1,a.length-1),s=!1,l="simple";if(n.endsWith("*")&&(s=!0,n=n.substring(0,n.length-1)),n.startsWith(".")?(l="label",n=n.substring(1)):n.startsWith(";")&&(l="matrix",n=n.substring(1)),!r||r[n]===void 0||r[n]===null)continue;const f=r[n];if(Array.isArray(f)){t=t.replace(a,_(n,f,{style:l,explode:s}));continue}if(typeof f=="object"){t=t.replace(a,L(n,f,{style:l,explode:s}));continue}if(l==="matrix"){t=t.replace(a,`;${A(n,f)}`);continue}t=t.replace(a,l==="label"?`.${encodeURIComponent(f)}`:encodeURIComponent(f))}return t}function Q(e){return e instanceof FormData?e:JSON.stringify(e)}function K(e,r){var n;let t=`${r.baseUrl}${e}`;(n=r.params)!=null&&n.path&&(t=J(t,r.params.path));let a=r.querySerializer(r.params.query??{});return a.startsWith("?")&&(a=a.substring(1)),a&&(t+=`?${a}`),t}function V(...e){const r=new Headers;for(const t of e){if(!t||typeof t!="object")continue;const a=t instanceof Headers?t.entries():Object.entries(t);for(const[n,s]of a)if(s===null)r.delete(n);else if(Array.isArray(s))for(const l of s)r.append(n,l);else s!==void 0&&r.set(n,s)}return r}function H(e){return e.endsWith("/")?e.substring(0,e.length-1):e}const Z="/images",X="/",O=M({baseUrl:X,fetch}),ee=async e=>{const r={data:void 0,error:void 0};try{const t=await O.GET("/api/datasets/{dataset_id}",{params:{path:{dataset_id:e}}});if(t.error)throw new Error(JSON.stringify(t.error,null,2));if(!t.data)throw new Error("No data");r.data=t.data}catch(t){r.error="Error loading dataset: "+String(t)}return r},te=async()=>{const e={data:void 0,error:void 0};try{const{data:r}=await O.GET("/api/datasets");if(!r)throw new Error("No data");const t=r.sort((n,s)=>Date.parse(s.created_at)-Date.parse(n.created_at))[0].dataset_id,a=await O.GET("/api/datasets/{dataset_id}",{params:{path:{dataset_id:t}}});if(a.error)throw new Error(JSON.stringify(a.error,null,2));if(!a.data)throw new Error("No data");e.data=a.data}catch(r){e.error="Error loading dataset: "+String(r)}return e},E={home:()=>"/",dataset:{sample:e=>`/samples/${e}`,sampleWithAnnotation:(e,r)=>`/samples/${e}?annotationId=${r}`,samples:e=>`/datasets/${e}/samples`,annotations:e=>`/datasets/${e}/annotations`}},re={toHome:()=>E.home(),toSamples:e=>E.dataset.samples(e),toAnnotations:e=>E.dataset.annotations(e),toSample:e=>E.dataset.sample(e),toSampleWithAnnotation:(e,r)=>E.dataset.sampleWithAnnotation(e,r)};export{Z as P,ee as a,O as c,te as l,re as r};
