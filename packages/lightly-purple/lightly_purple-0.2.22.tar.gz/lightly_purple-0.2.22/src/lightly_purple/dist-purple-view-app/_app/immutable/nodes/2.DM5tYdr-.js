var Gt=r=>{throw TypeError(r)};var Tt=(r,e,t)=>e.has(r)||Gt("Cannot "+t);var w=(r,e,t)=>(Tt(r,e,"read from private field"),t?t.call(r):e.get(r)),Je=(r,e,t)=>e.has(r)?Gt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),dt=(r,e,t,s)=>(Tt(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),nt=(r,e,t)=>(Tt(r,e,"access private method"),t);import{I as it,s as Ne,Q as Ct,m as ca,R as ua,n as Rt,a as mt,o as va,H as Xe,k as Ke,U as Dt,u as fa,e as ot,j as _t,_ as ga,C as ha,V as ma,b as pa,c as _a,W as xa,X as $a,Y as ya,Z as ba,$ as wa,a0 as Ht,a1 as Sa,a2 as Bt,f as Zt,a3 as Pa,d as ka,a4 as Ta}from"../chunks/BOHqcjUC.js";import{aC as Jt,x as Qe,z as Ca,p as B,a as J,f as x,n as qe,H as Et,j as a,v as A,l as C,c as f,r as c,t as Q,s as v,A as ae,q as ze,w as et,aE as ea,y as ta,aF as aa,aG as It,e as Ea}from"../chunks/DEifp24C.js";import{c as Ze,a as Ia}from"../chunks/BBLiiV7J.js";import{r as vt}from"../chunks/Cbydd1_z.js";import{r as Aa}from"../chunks/B90CZVMX.js";import{c as F,a as o,t as y,s as U,b as ye}from"../chunks/BHT-efq3.js";import{s as De,r as _e,p as we,i as be,d as le,c as ft,e as M,a as pe,b as yt}from"../chunks/BlMvkeYU.js";import{p as bt}from"../chunks/Ut6U2_jt.js";import{g as xt,u as Fa,a as Ma}from"../chunks/ZzpsRLWH.js";import{S as Kt,a as Pt,f as ct,A as Oa,T as za}from"../chunks/Cvs2XJxr.js";import"../chunks/Bui4M3W6.js";import{p as Na}from"../chunks/oLIpPV73.js";import{g as Da,u as La,F as At,S as Ft,a as Mt,G as Ot,b as zt,R as Nt,c as ja,D as Ka,d as qa}from"../chunks/DLAcbHmX.js";import{S as Ga,s as Ra,h as Vt,n as ra,a as sa,i as Ha,b as Ba,u as qt,l as Ja}from"../chunks/C_-gaMfp.js";import{L as Va,a as na}from"../chunks/Fy-2sBgm.js";var tt,at,$e,Ue,Ye,$t,Lt,Yt,Wa=(Yt=class extends Ga{constructor(e,t){super();Je(this,Ye);Je(this,tt);Je(this,at);Je(this,$e);Je(this,Ue);dt(this,tt,e),this.setOptions(t),this.bindMethods(),nt(this,Ye,$t).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var s;const t=this.options;this.options=w(this,tt).defaultMutationOptions(e),Ra(this.options,t)||w(this,tt).getMutationCache().notify({type:"observerOptionsUpdated",mutation:w(this,$e),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&Vt(t.mutationKey)!==Vt(this.options.mutationKey)?this.reset():((s=w(this,$e))==null?void 0:s.state.status)==="pending"&&w(this,$e).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=w(this,$e))==null||e.removeObserver(this)}onMutationUpdate(e){nt(this,Ye,$t).call(this),nt(this,Ye,Lt).call(this,e)}getCurrentResult(){return w(this,at)}reset(){var e;(e=w(this,$e))==null||e.removeObserver(this),dt(this,$e,void 0),nt(this,Ye,$t).call(this),nt(this,Ye,Lt).call(this)}mutate(e,t){var s;return dt(this,Ue,t),(s=w(this,$e))==null||s.removeObserver(this),dt(this,$e,w(this,tt).getMutationCache().build(w(this,tt),this.options)),w(this,$e).addObserver(this),w(this,$e).execute(e)}},tt=new WeakMap,at=new WeakMap,$e=new WeakMap,Ue=new WeakMap,Ye=new WeakSet,$t=function(){var t;const e=((t=w(this,$e))==null?void 0:t.state)??Da();dt(this,at,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},Lt=function(e){ra.batch(()=>{var t,s,n,i,l,d,m,h;if(w(this,Ue)&&this.hasListeners()){const b=w(this,at).variables,g=w(this,at).context;(e==null?void 0:e.type)==="success"?((s=(t=w(this,Ue)).onSuccess)==null||s.call(t,e.data,b,g),(i=(n=w(this,Ue)).onSettled)==null||i.call(n,e.data,null,b,g)):(e==null?void 0:e.type)==="error"&&((d=(l=w(this,Ue)).onError)==null||d.call(l,e.error,b,g),(h=(m=w(this,Ue)).onSettled)==null||h.call(m,void 0,e.error,b,g))}this.listeners.forEach(b=>{b(w(this,at))})})},Yt);function Ua(r,e){const t=sa(),s=Ha(r)?r:Jt(r),n=new Wa(t,Qe(s));let i;s.subscribe(m=>{i=(h,b)=>{n.mutate(h,b).catch(Ba)},n.setOptions(m)});const l=Jt(n.getCurrentResult(),m=>n.subscribe(ra.batchCalls(h=>m(h)))),{subscribe:d}=Ca(l,m=>({...m,mutate:i,mutateAsync:m.mutate}));return{subscribe:d}}function oa(r,e){B(e,!0);let t=_e(e,["$$slots","$$events","$$legacy"]);it(r,De({name:"image"},()=>t,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(n,i)=>{var l=F(),d=x(l);Ne(d,()=>e.children??qe),o(n,l)},$$slots:{default:!0}})),J()}function Qa(r,e){B(e,!0);let t=_e(e,["$$slots","$$events","$$legacy"]);it(r,De({name:"component"},()=>t,{iconNode:[["path",{d:"M15.536 11.293a1 1 0 0 0 0 1.414l2.376 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z"}],["path",{d:"M2.297 11.293a1 1 0 0 0 0 1.414l2.377 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414L6.088 8.916a1 1 0 0 0-1.414 0z"}],["path",{d:"M8.916 17.912a1 1 0 0 0 0 1.415l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.415l-2.377-2.376a1 1 0 0 0-1.414 0z"}],["path",{d:"M8.916 4.674a1 1 0 0 0 0 1.414l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z"}]],children:(n,i)=>{var l=F(),d=x(l);Ne(d,()=>e.children??qe),o(n,l)},$$slots:{default:!0}})),J()}var Xa=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Ya=["difference","intersection","symmetricDifference","union"],Wt=!1,ut,je,rt,wt,ia;const St=class St extends Set{constructor(t){super();Je(this,wt);Je(this,ut,new Map);Je(this,je,Et(0));Je(this,rt,Et(0));if(t){for(var s of t)super.add(s);w(this,rt).v=super.size}Wt||nt(this,wt,ia).call(this)}has(t){var s=super.has(t),n=w(this,ut),i=n.get(t);if(i===void 0){if(!s)return a(w(this,je)),!1;i=Et(!0),n.set(t,i)}return a(i),s}add(t){return super.has(t)||(super.add(t),A(w(this,rt),super.size),Ct(w(this,je))),this}delete(t){var s=super.delete(t),n=w(this,ut),i=n.get(t);return i!==void 0&&(n.delete(t),A(i,!1)),s&&(A(w(this,rt),super.size),Ct(w(this,je))),s}clear(){if(super.size!==0){super.clear();var t=w(this,ut);for(var s of t.values())A(s,!1);t.clear(),A(w(this,rt),0),Ct(w(this,je))}}keys(){return this.values()}values(){return a(w(this,je)),super.values()}entries(){return a(w(this,je)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return a(w(this,rt))}};ut=new WeakMap,je=new WeakMap,rt=new WeakMap,wt=new WeakSet,ia=function(){Wt=!0;var t=St.prototype,s=Set.prototype;for(const n of Xa)t[n]=function(...i){return a(w(this,je)),s[n].apply(this,i)};for(const n of Ya)t[n]=function(...i){a(w(this,je));var l=s[n].apply(this,i);return new St(l)}};let jt=St;var Za=y("<div><!></div>");function er(r,e){B(e,!0);let t=we(e,"id",19,ca),s=we(e,"ref",15,null),n=_e(e,["$$slots","$$events","$$legacy","id","children","child","ref"]);const i=ua({id:Rt.with(()=>t()),ref:Rt.with(()=>s(),g=>s(g))}),l=C(()=>va(n,i.props));var d=F(),m=x(d);{var h=g=>{var E=F(),_=x(E);Ne(_,()=>e.child,()=>({props:a(l)})),o(g,E)},b=g=>{var E=Za();let _;var P=f(E);Ne(P,()=>e.children??qe),c(E),Q(()=>_=mt(E,_,{...a(l)})),o(g,E)};be(m,g=>{e.child?g(h):g(b,!1)})}o(r,d),J()}var tr=y("<!> Samples",1),ar=y("<!> Annotations",1),rr=y('<div class="mb-5 mt-2 text-lg font-semibold">Collections</div> <!> <div class="flex space-x-2"><!> <!></div>',1);function sr(r,e){B(e,!0);var t=rr(),s=v(x(t),2);Kt(s,{class:"mb-4 bg-border-hard"});var n=v(s,2),i=f(n);const l=C(()=>Ke("flex-1","px-2",e.gridType=="samples"&&"inline-flex rounded-md bg-muted")),d=C(()=>vt.toSamples(e.datasetId));Xe(i,{variant:"ghost",get class(){return a(l)},get href(){return a(d)},"data-sveltekit-noscroll":!0,children:(g,E)=>{var _=tr(),P=x(_);oa(P,{class:"size-4"}),ae(),o(g,_)},$$slots:{default:!0}});var m=v(i,2);const h=C(()=>Ke("flex-1","px-2",e.gridType=="annotations"&&"inline-flex rounded-md bg-muted")),b=C(()=>vt.toAnnotations(e.datasetId));Xe(m,{get class(){return a(h)},variant:"ghost",get href(){return a(b)},"data-sveltekit-noscroll":!0,children:(g,E)=>{var _=ar(),P=x(_);Qa(P,{class:"size-4"}),ae(),o(g,_)},$$slots:{default:!0}}),c(n),o(r,t),J()}var nr=y('<div class="space-y-4"><div class="space-y-1"><h2 class="text-md">Width Filter</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <div class="space-y-1"><h2 class="text-md">Height Filter</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div></div>');function or(r,e){B(e,!0);const[t,s]=ft(),n=()=>le(e.dimensions,"$dimensions",t),{min_width:i,max_width:l,min_height:d,max_height:m}=n(),h=g=>{e.onChange({min_width:g[0],max_width:g[1],min_height:d,max_height:m})},b=g=>{e.onChange({min_width:i,max_width:l,min_height:g[0],max_height:g[1]})};Pt(r,{title:"Metadata",children:(g,E)=>{var _=nr(),P=f(_),u=v(f(P),2),p=f(u),$=f(p);c(p);var k=v(p,2),N=f(k);c(k),c(u);var T=v(u,2),R=f(T);Dt(R,{type:"multiple",class:"filter-width",min:i,max:l,value:[i,l],onValueChange:h}),c(T),c(P);var Fe=v(P,2),xe=v(f(Fe),2),K=f(xe),q=f(K);c(K);var X=v(K,2),Me=f(X);c(X),c(xe);var Se=v(xe,2),Ve=f(Se);Dt(Ve,{type:"multiple",class:"filter-height",min:d,max:m,value:[d,m],onValueChange:b}),c(Se),c(Fe),c(_),Q((Ge,Oe,re,de)=>{U($,`${Ge??""}px`),U(N,`${Oe??""}px`),U(q,`${re??""}px`),U(Me,`${de??""}px`)},[()=>ct(n().min_width),()=>ct(n().max_width),()=>ct(n().min_height),()=>ct(n().max_height)]),o(g,_)},$$slots:{default:!0}}),J(),s()}function ir(r,e){B(e,!0);let t=_e(e,["$$slots","$$events","$$legacy"]);it(r,De({name:"eraser"},()=>t,{iconNode:[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]],children:(n,i)=>{var l=F(),d=x(l);Ne(d,()=>e.children??qe),o(n,l)},$$slots:{default:!0}})),J()}function lr(r,e){B(e,!0);let t=_e(e,["$$slots","$$events","$$legacy"]);it(r,De({name:"grid-3x3"},()=>t,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M3 9h18"}],["path",{d:"M3 15h18"}],["path",{d:"M9 3v18"}],["path",{d:"M15 3v18"}]],children:(n,i)=>{var l=F(),d=x(l);Ne(d,()=>e.children??qe),o(n,l)},$$slots:{default:!0}})),J()}function dr(r,e){B(e,!0);let t=_e(e,["$$slots","$$events","$$legacy"]);it(r,De({name:"plus"},()=>t,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(n,i)=>{var l=F(),d=x(l);Ne(d,()=>e.children??qe),o(n,l)},$$slots:{default:!0}})),J()}function cr(r,e){B(e,!0);let t=_e(e,["$$slots","$$events","$$legacy"]);it(r,De({name:"search"},()=>t,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(n,i)=>{var l=F(),d=x(l);Ne(d,()=>e.children??qe),o(n,l)},$$slots:{default:!0}})),J()}function ur(r,e){B(e,!0);let t=_e(e,["$$slots","$$events","$$legacy"]);it(r,De({name:"sliders-horizontal"},()=>t,{iconNode:[["line",{x1:"21",x2:"14",y1:"4",y2:"4"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22"}]],children:(n,i)=>{var l=F(),d=x(l);Ne(d,()=>e.children??qe),o(n,l)},$$slots:{default:!0}})),J()}const vr=async r=>{const e={data:{},error:void 0};try{const t=await Ze.POST("/api/metrics/compute/detection/map",{body:r});if(t.error)throw new Error(JSON.stringify(t.error,null,2));if(!t.data)throw new Error("No data returned from metrics calculation");e.data=t.data}catch(t){e.error="Error computing metrics: "+String(t)}return e};var fr=y("<!> <!>",1),gr=y("<!> <!>",1),hr=y("<!> <!>",1),mr=y("<!> <!>",1),pr=y('<div class="rounded-md bg-destructive/15 p-3 text-sm text-destructive"> </div>'),_r=y('<span class="mr-2 animate-spin">⟳</span>'),xr=y("<!> Compute",1),$r=y('<div class="space-y-6"><!> <!> <!> <!> <div class="flex space-x-2"><!> <!></div></div>'),yr=y('<div class="flex justify-between"><span class="truncate"> </span> <span class="font-medium"> </span></div>'),br=y('<div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP by Class</h4> <div class="max-h-60 space-y-1 overflow-y-auto text-sm"></div></div>'),wr=y('<div class="space-y-4"><div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP Results</h4> <div class="space-y-2 text-sm"><div class="flex justify-between"><span>mAP:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@50:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@75:</span> <span class="font-medium"> </span></div></div></div> <!> <!></div>'),Sr=y('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 text-lg font-semibold">Metrics</div> <!> <div class="flex-1 space-y-6"><!></div></div>'),Pr=y('<div class="hidden"></div>');function kr(r,e){B(e,!0);const[t,s]=ft(),n=()=>le(E,"$isMetricsPanelOpen",t),i=()=>le(g,"$hasEnoughTasksForMetrics",t),l=()=>le(b,"$annotationTasks",t),d=()=>le(h,"$tags",t);let m=Na.params.dataset_id;const{tags:h}=qt({dataset_id:m}),{annotationTasks:b,hasEnoughTasksForMetrics:g}=fa(),{isMetricsPanelOpen:E}=La();let _=ze(""),P=ze(""),u=ze(""),p=ze(null),$=ze(!1),k=ze("");async function N(){if(!a(_)||!a(P)){A(k,"Please select both ground truth and prediction tasks");return}A($,!0),A(k,"");try{const q=await vr({dataset_id:m,ground_truth_task_id:a(_),prediction_task_id:a(P),tag_id:a(u)||null});q.error?A(k,pe(q.error)):A(p,pe(q.data))}catch(q){A(k,pe(String(q)))}finally{A($,!1)}}function T(){A(_,""),A(P,""),A(u,""),A(p,null),A(k,"")}var R=F(),Fe=x(R);{var xe=q=>{var X=Sr(),Me=v(f(X),2);Kt(Me,{class:"mb-4 bg-border-hard"});var Se=v(Me,2),Ve=f(Se);{var Ge=re=>{var de=$r(),Pe=f(de);At(Pe,{label:"Ground Truth Task",children:(D,ce)=>{var V=F(),L=x(V);M(L,()=>Nt,(Z,j)=>{j(Z,{type:"single",name:"groundTruthTaskId",get value(){return a(_)},set value(z){A(_,pe(z))},children:(z,ge)=>{var ne=fr(),Y=x(ne);M(Y,()=>Ft,(me,ee)=>{ee(me,{class:"w-full",children:(oe,We)=>{ae();var W=ye();Q(G=>U(W,G),[()=>{var G;return((G=l().find(I=>I.annotation_task_id===a(_)))==null?void 0:G.name)||"Select ground truth task"}]),o(oe,W)},$$slots:{default:!0}})});var Le=v(Y,2);M(Le,()=>Mt,(me,ee)=>{ee(me,{children:(oe,We)=>{var W=F(),G=x(W);M(G,()=>Ot,(I,ie)=>{ie(I,{children:(he,He)=>{var te=F(),Ee=x(te);ot(Ee,1,()=>l().filter(Ie=>!Ie.is_prediction),_t,(Ie,H)=>{var ue=F(),Ae=x(ue);{var Be=ve=>{var st=F(),gt=x(st);M(gt,()=>zt,(pt,lt)=>{lt(pt,{get value(){return a(H).annotation_task_id},get label(){return a(H).name},children:(kt,da)=>{ae();var ht=ye();Q(()=>U(ht,a(H).name)),o(kt,ht)},$$slots:{default:!0}})}),o(ve,st)};be(Ae,ve=>{a(H).annotation_task_id&&ve(Be)})}o(Ie,ue)}),o(he,te)},$$slots:{default:!0}})}),o(oe,W)},$$slots:{default:!0}})}),o(z,ne)},$$slots:{default:!0}})}),o(D,V)}});var ke=v(Pe,2);At(ke,{label:"Prediction Task",children:(D,ce)=>{var V=F(),L=x(V);M(L,()=>Nt,(Z,j)=>{j(Z,{type:"single",name:"predictionTaskId",get value(){return a(P)},set value(z){A(P,pe(z))},children:(z,ge)=>{var ne=gr(),Y=x(ne);M(Y,()=>Ft,(me,ee)=>{ee(me,{class:"w-full",children:(oe,We)=>{ae();var W=ye();Q(G=>U(W,G),[()=>{var G;return((G=l().find(I=>I.annotation_task_id===a(P)))==null?void 0:G.name)||"Select prediction task"}]),o(oe,W)},$$slots:{default:!0}})});var Le=v(Y,2);M(Le,()=>Mt,(me,ee)=>{ee(me,{children:(oe,We)=>{var W=F(),G=x(W);M(G,()=>Ot,(I,ie)=>{ie(I,{children:(he,He)=>{var te=F(),Ee=x(te);ot(Ee,1,()=>l().filter(Ie=>Ie.is_prediction),_t,(Ie,H)=>{var ue=F(),Ae=x(ue);{var Be=ve=>{var st=F(),gt=x(st);M(gt,()=>zt,(pt,lt)=>{lt(pt,{get value(){return a(H).annotation_task_id},get label(){return a(H).name},children:(kt,da)=>{ae();var ht=ye();Q(()=>U(ht,a(H).name)),o(kt,ht)},$$slots:{default:!0}})}),o(ve,st)};be(Ae,ve=>{a(H).annotation_task_id&&ve(Be)})}o(Ie,ue)}),o(he,te)},$$slots:{default:!0}})}),o(oe,W)},$$slots:{default:!0}})}),o(z,ne)},$$slots:{default:!0}})}),o(D,V)}});var fe=v(ke,2);At(fe,{label:"Tag (Optional)",children:(D,ce)=>{var V=F(),L=x(V);M(L,()=>Nt,(Z,j)=>{j(Z,{type:"single",name:"tagId",get value(){return a(u)},set value(z){A(u,pe(z))},children:(z,ge)=>{var ne=mr(),Y=x(ne);M(Y,()=>Ft,(me,ee)=>{ee(me,{class:"w-full",children:(oe,We)=>{ae();var W=ye();Q(G=>U(W,G),[()=>{var G;return((G=d().find(I=>I.tag_id===a(u)))==null?void 0:G.name)||"Select tag (optional)"}]),o(oe,W)},$$slots:{default:!0}})});var Le=v(Y,2);M(Le,()=>Mt,(me,ee)=>{ee(me,{children:(oe,We)=>{var W=F(),G=x(W);M(G,()=>Ot,(I,ie)=>{ie(I,{children:(he,He)=>{var te=hr(),Ee=x(te);M(Ee,()=>ja,(H,ue)=>{ue(H,{children:(Ae,Be)=>{ae();var ve=ye("Sample tags");o(Ae,ve)},$$slots:{default:!0}})});var Ie=v(Ee,2);ot(Ie,1,()=>d().filter(H=>H.kind==="sample"),_t,(H,ue)=>{var Ae=F(),Be=x(Ae);M(Be,()=>zt,(ve,st)=>{st(ve,{get value(){return a(ue).tag_id},get label(){return a(ue).name},children:(gt,pt)=>{ae();var lt=ye();Q(()=>U(lt,a(ue).name)),o(gt,lt)},$$slots:{default:!0}})}),o(H,Ae)}),o(he,te)},$$slots:{default:!0}})}),o(oe,W)},$$slots:{default:!0}})}),o(z,ne)},$$slots:{default:!0}})}),o(D,V)}});var Te=v(fe,2);{var Re=D=>{var ce=pr(),V=f(ce,!0);c(ce),Q(()=>U(V,a(k))),o(D,ce)};be(Te,D=>{a(k)&&D(Re)})}var S=v(Te,2),O=f(S);Xe(O,{variant:"outline",class:"flex-1",onclick:T,get disabled(){return a($)},children:(D,ce)=>{ae();var V=ye("Reset");o(D,V)},$$slots:{default:!0}});var se=v(O,2);const Ce=C(()=>!a(_)||!a(P)||a($));Xe(se,{variant:"default",class:"flex-1",onclick:N,get disabled(){return a(Ce)},children:(D,ce)=>{var V=xr(),L=x(V);{var Z=j=>{var z=_r();o(j,z)};be(L,j=>{a($)&&j(Z)})}ae(),o(D,V)},$$slots:{default:!0}}),c(S),c(de),o(re,de)},Oe=re=>{var de=wr(),Pe=f(de),ke=v(f(Pe),2),fe=f(ke),Te=v(f(fe),2),Re=f(Te);c(Te),c(fe);var S=v(fe,2),O=v(f(S),2),se=f(O);c(O),c(S);var Ce=v(S,2),D=v(f(Ce),2),ce=f(D);c(D),c(Ce),c(ke),c(Pe);var V=v(Pe,2);{var L=j=>{var z=br(),ge=v(f(z),2);ot(ge,21,()=>Object.entries(a(p).map_per_class).sort(([ne],[Y])=>ne<Y?-1:ne>Y?1:0),_t,(ne,Y)=>{let Le=()=>a(Y)[0],me=()=>a(Y)[1];var ee=yr(),oe=f(ee),We=f(oe);c(oe);var W=v(oe,2),G=f(W);c(W),c(ee),Q(I=>{U(We,`${Le()??""}:`),U(G,`${I??""}%`)},[()=>(me()*100).toFixed(2)]),o(ne,ee)}),c(ge),c(z),o(j,z)};be(V,j=>{a(p).map_per_class&&j(L)})}var Z=v(V,2);Xe(Z,{variant:"outline",class:"mt-4 w-full",onclick:()=>A(p,null),children:(j,z)=>{ae();var ge=ye("Back to Form");o(j,ge)},$$slots:{default:!0}}),c(de),Q((j,z,ge)=>{U(Re,`${j??""}%`),U(se,`${z??""}%`),U(ce,`${ge??""}%`)},[()=>(a(p).map*100).toFixed(2),()=>(a(p).map_50*100).toFixed(2),()=>(a(p).map_75*100).toFixed(2)]),o(re,de)};be(Ve,re=>{a(p)?re(Oe,!1):re(Ge)})}c(Se),c(X),o(q,X)},K=q=>{var X=Pr();o(q,X)};be(Fe,q=>{n()&&i()?q(xe):q(K,!1)})}o(r,R),J(),s()}var Tr=y('<div class="w-300 flex space-x-4 text-diffuse-foreground"><!> <!> <!></div>');function Cr(r,e){B(e,!0);const t=we(e,"min",3,100),s=we(e,"max",3,1500),n=ga.throttle(b=>{e.onChange(b[0])},100);var i=Tr(),l=f(i);lr(l,{class:"h-6 w-6"});var d=v(l,2);const m=C(()=>[e.width]);Dt(d,{class:"w-full flex-1",get value(){return a(m)},get min(){return t()},get max(){return s()},step:1,onValueChange:n});var h=v(d,2);oa(h,{class:"h-6 w-6"}),c(i),o(r,i),J()}var Er=y('<div class="h-3 w-3 cursor-pointer rounded-sm border"></div>'),Ir=y('<div class="color-picker-container"><!></div> <p class="flex-1 truncate text-base font-normal"> </p> <span class="text-sm text-diffuse-foreground"> </span>',1),Ar=y('<div class="width-full flex items-center space-x-2"><!> <!></div>'),Fr=y('<div class="width-full space-y-2 overflow-hidden"></div>');function Mr(r,e){B(e,!0);const[t,s]=ft(),n=()=>le(b,"$customLabelColorsStore",t),i=()=>le(l(),"$annotationFilters",t);let l=we(e,"annotationFilters",19,()=>[]);const{setCustomColor:d,getCustomColor:m,hasCustomColor:h,customLabelColorsStore:b}=Fa();function g(u,p,$){d(u,p,$)}function E(u){if(h(u)){const $=m(u);return($==null?void 0:$.color)||"#ff0000"}const p=xt(u,1).color;try{const $=p.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if($){const k=parseInt($[1]),N=parseInt($[2]),T=parseInt($[3]);return`#${((1<<24)+(k<<16)+(N<<8)+T).toString(16).slice(1)}`}}catch($){console.error("Error converting rgba to hex",$)}return"#ff0000"}function _(u){if(h(u)){const p=m(u);return(p==null?void 0:p.alpha)||1}return .4}const P=C(()=>{const u=n(),p={};for(const $ of Object.keys(u)){const k=u[$];p[$]={borderColor:k.color,backgroundColor:xt($,.4).color}}return p});Pt(r,{title:"Labels",children:(u,p)=>{var $=Fr();ot($,5,i,({label_name:k,current_count:N,total_count:T,selected:R})=>k,(k,N)=>{let T=()=>a(N).label_name,R=()=>a(N).current_count,Fe=()=>a(N).total_count,xe=()=>a(N).selected;var K=Ar(),q=f(K);const X=C(()=>`${T()}-label`);ha(q,{get id(){return T()},get checked(){return xe()},get"aria-labelledby"(){return a(X)},onCheckedChange:()=>e.onToggleAnnotationFilter(T())});var Me=v(q,2);const Se=C(()=>`${T()}-label`);Va(Me,{get id(){return a(Se)},get for(){return T()},class:"flex min-w-0 flex-1 cursor-pointer items-center space-x-2 text-nowrap peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:(Ve,Ge)=>{var Oe=Ir(),re=x(Oe),de=f(re);const Pe=C(()=>E(T())),ke=C(()=>_(T()));ma(de,{get initialColor(){return a(Pe)},get initialAlpha(){return a(ke)},onChange:(O,se)=>g(T(),O,se),children:(O,se)=>{var Ce=Er();Q(D=>pa(Ce,D),[()=>{var D,ce;return`
                                    border-color: ${((D=a(P)[T()])==null?void 0:D.borderColor)??xt(T()).color};
                                    background-color: ${((ce=a(P)[T()])==null?void 0:ce.backgroundColor)??xt(T(),xe()?1:.4).color};
                                `}]),o(O,Ce)},$$slots:{default:!0}}),c(re);var fe=v(re,2),Te=f(fe,!0);c(fe);var Re=v(fe,2),S=f(Re);c(Re),Q((O,se)=>{U(Te,T()),U(S,`${O??""} of ${se??""}`)},[()=>ct(R()),()=>ct(Fe())]),o(Ve,Oe)},$$slots:{default:!0}}),c(K),Q(()=>_a(K,"title",T())),o(k,K)}),c($),o(u,$)},$$slots:{default:!0}}),J(),s()}function Or(r,e){B(e,!0);let t=we(e,"ref",15,null),s=_e(e,["$$slots","$$events","$$legacy","ref","class"]);var n=F(),i=x(n);const l=C(()=>Ke("text-lg font-semibold leading-none tracking-tight",e.class));M(i,()=>Ka,(d,m)=>{m(d,De({get class(){return a(l)}},()=>s,{get ref(){return t()},set ref(h){t(h)}}))}),o(r,n),J()}var zr=y("<div><!></div>");function Nr(r,e){B(e,!0);let t=we(e,"ref",15,null),s=_e(e,["$$slots","$$events","$$legacy","ref","class","children"]);var n=zr();let i;var l=f(n);Ne(l,()=>e.children??qe),c(n),yt(n,d=>t(d),()=>t()),Q(d=>i=mt(n,i,{class:d,...s}),[()=>Ke("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e.class)]),o(r,n),J()}var Dr=y("<div><!></div>");function Lr(r,e){B(e,!0);let t=we(e,"ref",15,null),s=_e(e,["$$slots","$$events","$$legacy","ref","class","children"]);var n=Dr();let i;var l=f(n);Ne(l,()=>e.children??qe),c(n),yt(n,d=>t(d),()=>t()),Q(d=>i=mt(n,i,{class:d,...s}),[()=>Ke("flex flex-col space-y-1.5 text-center sm:text-left",e.class)]),o(r,n),J()}function jr(r,e){B(e,!0);let t=we(e,"ref",15,null),s=_e(e,["$$slots","$$events","$$legacy","ref","class"]);var n=F(),i=x(n);const l=C(()=>Ke("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0  fixed inset-0 z-50 bg-black/80",e.class));M(i,()=>xa,(d,m)=>{m(d,De({get class(){return a(l)}},()=>s,{get ref(){return t()},set ref(h){t(h)}}))}),o(r,n),J()}var Kr=y('<!> <span class="sr-only">Close</span>',1),qr=y("<!> <!>",1),Gr=y("<!> <!>",1);function Rr(r,e){B(e,!0);let t=we(e,"ref",15,null),s=_e(e,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var n=F(),i=x(n);M(i,()=>Jr,(l,d)=>{d(l,De(()=>e.portalProps,{children:(m,h)=>{var b=Gr(),g=x(b);M(g,()=>jr,(P,u)=>{u(P,{})});var E=v(g,2);const _=C(()=>Ke("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] bg-background fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 sm:rounded-lg",e.class));M(E,()=>$a,(P,u)=>{u(P,De({get class(){return a(_)}},()=>s,{get ref(){return t()},set ref(p){t(p)},children:(p,$)=>{var k=qr(),N=x(k);Ne(N,()=>e.children??qe);var T=v(N,2);M(T,()=>ya,(R,Fe)=>{Fe(R,{class:"ring-offset-background focus:ring-ring absolute right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none",children:(xe,K)=>{var q=Kr(),X=x(q);ba(X,{class:"size-4"}),ae(2),o(xe,q)},$$slots:{default:!0}})}),o(p,k)},$$slots:{default:!0}}))}),o(m,b)},$$slots:{default:!0}}))}),o(r,n),J()}function Hr(r,e){B(e,!0);let t=we(e,"ref",15,null),s=_e(e,["$$slots","$$events","$$legacy","ref","class"]);var n=F(),i=x(n);const l=C(()=>Ke("text-muted-foreground text-sm",e.class));M(i,()=>er,(d,m)=>{m(d,De({get class(){return a(l)}},()=>s,{get ref(){return t()},set ref(h){t(h)}}))}),o(r,n),J()}const Br=qa,Jr=wa,Vr=async({dataset_id:r,tag_id:e,annotationIdsBody:t})=>{const s={data:void 0,error:void 0};try{const n=await Ze.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/annotations",{params:{path:{dataset_id:r,tag_id:e}},body:t});if(n.error)throw new Error(JSON.stringify(n.error,null,2));if(!n.data)throw new Error("No data");s.data=n.data}catch(n){s.error="Error assigning annotationIds to a tag: "+String(n)}return s};var Wr=y("<input>"),Ur=y("<input>");function la(r,e){B(e,!0);let t=we(e,"ref",15,null),s=we(e,"value",15),n=we(e,"files",15),i=_e(e,["$$slots","$$events","$$legacy","ref","value","type","files","class"]);var l=F(),d=x(l);{var m=b=>{var g=Wr();Ht(g);let E;yt(g,_=>t(_),()=>t()),Q(_=>E=mt(g,E,{class:_,type:"file",...i}),[()=>Ke("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Sa(g,n),Bt(g,s),o(b,g)},h=b=>{var g=Ur();Ht(g);let E;yt(g,_=>t(_),()=>t()),Q(_=>E=mt(g,E,{class:_,type:e.type,...i}),[()=>Ke("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Bt(g,s),o(b,g)};be(d,b=>{e.type==="file"?b(m):b(h,!1)})}o(r,l),J()}const Qr=async({dataset_id:r,tag_id:e,sampleIdsBody:t})=>{const s={data:void 0,error:void 0};try{const n=await Ze.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/samples",{params:{path:{dataset_id:r,tag_id:e}},body:t});if(n.error)throw new Error(JSON.stringify(n.error,null,2));if(!n.data)throw new Error("No data");s.data=n.data}catch(n){s.error="Error assigning sampleIds to tag: "+String(n)}return s},Xr=async({dataset_id:r,tagInputBody:e})=>{const t={data:void 0,error:void 0};try{const s=await Ze.POST("/api/datasets/{dataset_id}/tags",{params:{path:{dataset_id:r}},body:e});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No data");t.data=s.data}catch(s){t.error="Error creating tag: "+String(s)}return t};var Yr=y("<!> Create new Tags",1),Zr=y("<!> <!>",1),es=y('<div class="flex space-x-2 py-1"><!></div>'),ts=y('<!> <!> <div class="grid gap-4"><!></div> <div><!> <!></div> <!>',1),as=y('<div class="flex space-x-1"><!> <!></div> <!>',1);function rs(r,e){B(e,!0);const[t,s]=ft(),n=()=>le(E,"$selectedSampleIds",t),i=()=>le(_,"$selectedSampleAnnotationCropIds",t),l=()=>le(a(g),"$tags",t),d=()=>le(a($),"$itemsSelected",t),m=()=>le(Ve,"$submitTagAndMutate",t);let h=C(()=>e.gridType==="samples"?"sample":"annotation");const b=C(()=>qt({dataset_id:e.datasetId,kind:[a(h)]})),g=C(()=>a(b).tags),{selectedSampleIds:E,selectedSampleAnnotationCropIds:_,clearSelectedSampleAnnotationCrops:P,clearSelectedSamples:u}=Zt(),p=C(()=>e.gridType==="samples"?u:P),$=C(()=>e.gridType==="samples"?E:_);let k=ze(!1);const N=C(()=>n().size>0&&e.gridType==="samples"||i().size>0&&e.gridType==="annotations");let T=ze(""),R=ze(pe([])),Fe=()=>{a(R).push(a(T)),K.add(a(T)),A(T,"")};const xe=C(()=>[...a(R).map(S=>({tag_id:S,name:S,kind:a(h)})),...l()].filter(S=>S.name.includes(a(T))));let K=pe(new jt);const q=S=>{K.has(S)?(K.delete(S),a(R).splice(a(R).indexOf(S),1)):K.add(S)};let X=ze(null);const Me=async()=>{await Promise.all([...a(R)].map(async S=>{var se;const O=await Xr({dataset_id:e.datasetId,tagInputBody:{name:S,description:`${S} description`,kind:a(h)}});if(O.error)throw O.error;return(se=O.data)!=null&&se.tag_id&&(K.delete(S),K.add(O.data.tag_id)),O})),await Promise.all([...K].map(async S=>{const O=a(h)==="sample"?await Qr({dataset_id:e.datasetId,tag_id:S,sampleIdsBody:{sample_ids:[...d()]}}):await Vr({dataset_id:e.datasetId,tag_id:S,annotationIdsBody:{annotation_ids:[...d()]}});if(O.error)throw O.error;return O}))},Se=sa(),Ve=Ua({mutationFn:async()=>{await Me()},onError:S=>{A(X,pe(S))},onSuccess:()=>{Se.invalidateQueries({queryKey:Ja({dataset_id:e.datasetId})}),a(p)(),Ge(!1)}}),Ge=S=>{A(k,pe(S)),A(X,null),A(T,""),A(R,pe([])),K.clear()},Oe=C(()=>K.size>0||a(R).length>0);var re=as(),de=x(re),Pe=f(de);const ke=C(()=>!a(N));Xe(Pe,{variant:"outline",get disabled(){return a(ke)},class:"flex-1",onclick:()=>A(k,!0),children:(S,O)=>{var se=Yr(),Ce=x(se);dr(Ce,{}),ae(),o(S,se)},$$slots:{default:!0}});var fe=v(Pe,2);const Te=C(()=>!a(N));Xe(fe,{variant:"outline",get disabled(){return a(Te)},size:"icon",title:"Clear selection",get onclick(){return a(p)},children:(S,O)=>{ir(S,{})},$$slots:{default:!0}}),c(de);var Re=v(de,2);M(Re,()=>Br,(S,O)=>{O(S,{onOpenChange:Ge,get open(){return a(k)},children:(se,Ce)=>{var D=F(),ce=x(D);M(ce,()=>Rr,(V,L)=>{L(V,{class:"sm:max-w-[425px]",children:(Z,j)=>{var z=ts(),ge=x(z);M(ge,()=>Lr,(I,ie)=>{ie(I,{children:(he,He)=>{var te=Zr(),Ee=x(te);M(Ee,()=>Or,(H,ue)=>{ue(H,{children:(Ae,Be)=>{ae();var ve=ye();Q(()=>U(ve,`Add the selected ${a(h)??""} to a tag`)),o(Ae,ve)},$$slots:{default:!0}})});var Ie=v(Ee,2);M(Ie,()=>Hr,(H,ue)=>{ue(H,{children:(Ae,Be)=>{ae();var ve=ye();Q(()=>U(ve,`Add the selected ${d().size??""}
                ${a(h)??""} to an new or existing tag. Tags can later be exported.`)),o(Ae,ve)},$$slots:{default:!0}})}),o(he,te)},$$slots:{default:!0}})});var ne=v(ge,2);{var Y=I=>{Oa(I,{title:"Error occured",children:(ie,he)=>{ae();var He=ye();Q(()=>U(He,a(X))),o(ie,He)}})};be(ne,I=>{a(X)&&I(Y)})}var Le=v(ne,2),me=f(Le);la(me,{type:"text",placeholder:"Create or search tags",autofocus:!0,get value(){return a(T)},set value(I){A(T,pe(I))}}),c(Le);var ee=v(Le,2),oe=f(ee);ot(oe,17,()=>a(xe),I=>I.tag_id,(I,ie)=>{var he=es(),He=f(he);const te=C(()=>`tagCreateDialog-tag-${a(ie).tag_id}`),Ee=C(()=>K.has(a(ie).tag_id));na(He,{get name(){return a(te)},get isChecked(){return a(Ee)},get label(){return a(ie).name},onCheckedChange:()=>q(a(ie).tag_id)}),c(he),o(I,he)});var We=v(oe,2);{var W=I=>{const ie=C(()=>Ke("",...Pa({variant:"outline"})));Xe(I,{type:"button",variant:"outline",get class(){return a(ie)},onclick:Fe,children:(he,He)=>{ae();var te=ye();Q(()=>U(te,`Create tag "${a(T)??""}"`)),o(he,te)},$$slots:{default:!0}})};be(We,I=>{a(T)&&I(W)})}c(ee);var G=v(ee,2);M(G,()=>Nr,(I,ie)=>{ie(I,{children:(he,He)=>{var te=F(),Ee=x(te);{var Ie=H=>{Xe(H,{type:"submit",onclick:()=>m().mutate(),children:(ue,Ae)=>{ae();var Be=ye("Save changes");o(ue,Be)},$$slots:{default:!0}})};be(Ee,H=>{a(Oe)&&H(Ie)})}o(he,te)},$$slots:{default:!0}})}),o(Z,z)},$$slots:{default:!0}})}),o(se,D)},$$slots:{default:!0}})}),o(r,re),J(),s()}var ss=y('<div class="flex items-center space-x-2 py-1"><!></div>'),ns=y("<p>No tag, create a tag</p>"),os=y('<div class="mb-3 w-full space-y-2"></div>');function is(r,e){B(e,!0);const[t,s]=ft(),n=()=>le(a(d),"$tags",t),i=()=>le(a(m),"$tagsSelected",t),l=C(()=>qt({dataset_id:e.dataset_id,kind:[e.gridType==="annotations"?"annotation":"sample"]})),d=C(()=>a(l).tags),m=C(()=>a(l).tagsSelected),h=C(()=>a(l).tagSelectionToggle);Pt(r,{title:"Tags",icon:za,children:(b,g)=>{var E=os();ot(E,5,n,_=>_.tag_id,(_,P)=>{var u=ss(),p=f(u);const $=C(()=>i().has(a(P).tag_id));na(p,{get name(){return a(P).tag_id},get isChecked(){return a($)},get label(){return a(P).name},onCheckedChange:()=>a(h)(a(P).tag_id)}),c(u),o(_,u)},_=>{var P=ns();o(_,P)}),c(E),o(b,E)}}),J(),s()}function ls(){const r=et({width:200,height:200});return{sampleSize:r,updateWidth:t=>{r.set({width:t,height:t})}}}const Ut=async({dataset_id:r,filtered_labels:e,dimensions:t})=>{const s={data:[],error:void 0};try{const n=await Ze.GET("/api/annotations/count",{params:{query:{dataset_id:r,...e&&{filtered_labels:e},...(t==null?void 0:t.min_width)&&{min_width:t.min_width},...(t==null?void 0:t.max_width)&&{max_width:t.max_width},...(t==null?void 0:t.min_height)&&{min_height:t.min_height},...(t==null?void 0:t.max_height)&&{max_height:t.max_height}}}});if(n.error)throw new Error(JSON.stringify(n.error,null,2));if(!n.data)throw new Error("No annotation counts found");s.data=n.data.map(i=>({label_name:i.label_name,total_count:i.total_count,current_count:i.current_count}))}catch(n){s.error="Error loading annotation counts: "+String(n)}return s},ds=async()=>{const r={data:[],error:void 0};try{const e=await Ze.GET("/api/annotation_labels");e.data&&(r.data=e.data)}catch(e){r.error="Error loading annotation labels: "+String(e)}return r},cs=async({dataset_id:r,annotation_labels:e})=>{const t={data:void 0,error:void 0};try{const s=await Ze.GET("/api/samples/dimensions",{params:{query:{dataset_id:r,annotation_labels:e}}});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No dimension bounds data");t.data=s.data}catch(s){t.error="Error loading dimension bounds: "+String(s)}return t},Qt=(r,e)=>r.map(t=>({...t,selected:e.includes(t.label_name)})),Xt=r=>e=>e.includes(r)?e.filter(t=>t!==r):[...e,r],us=async({params:{dataset_id:r}})=>{const{data:e,error:t}=await Ia(r);if(t||!e)throw Aa(307,vt.toHome());const s=et({min_width:0,max_width:0,min_height:0,max_height:0}),{selectedAnnotationFilterIds:n}=Zt(),i=Array.from(Qe(n)),l=et([]),d=et(i),m=et([]),h=et(void 0),b=u=>{h.set(u)},[g]=await Promise.all([ds().then(u=>{const p=u.data.reduce((k,N)=>({...k,[N.annotation_label_name]:N.annotation_label_id}),{}),$=Object.entries(p).filter(([,k])=>i.includes(k)).map(([k])=>k);return l.set($),p}),cs({dataset_id:r}).then(({data:u})=>{u&&s.set(u)}),Ut({dataset_id:r}).then(({data:u})=>{if(u){const p=Qe(l);m.set(Qt(u,p))}})]),E=async()=>{try{const u=Qe(l),{data:p}=await Ut({dataset_id:r,filtered_labels:u.length>0?u:void 0,dimensions:Qe(s)});p&&m.update(()=>Qt(p||[],u))}catch(u){h.set(`Failed to load annotations: ${String(u)}`)}},_=u=>{u&&(s.set(u),E())};return{datasetId:r,annotationFilters:m,toggleAnnotationFilterSelection:u=>{l.update(Xt(u));const p=g[u];n.update($=>($.has(p)?$.delete(p):$.add(p),$)),d.update(Xt(p)),E()},annotationFilterLabels:g,selectedAnnotationFilter:l,selectedAnnotationFilterIds:d,dimensions:ea(s),updateDimensions:_,error:Qe(h),setError:b,sampleSize:ls()}},zs=Object.freeze(Object.defineProperty({__proto__:null,load:us},Symbol.toStringTag,{value:"Module"})),vs=()=>{const r=et([]),e=et(null);return Ze.GET("/api/features").then(t=>{t.data&&r.set(t.data)}).catch(t=>{e.set(t)}),{error:e,featureFlags:ea(r)}},fs=r=>{const{getKeyboardShortcuts:e}=ka(),t=new Set,s=i=>{if(i.target instanceof HTMLInputElement||i.target instanceof HTMLTextAreaElement||i.target instanceof HTMLSelectElement)return;t.add(i.key);const l=Qe(bt).url.pathname,d={hideAnnotations:e.hide_annotations||"v",goBack:e.go_back||"Escape"};Object.entries(r).forEach(([m,h])=>{const b=d[m]||h.key;if(i.key===b){if(h.requiredPath){if(typeof h.requiredPath=="function"){if(!h.requiredPath(l))return}else if(!h.requiredPath.test(l))return}h.action(i)}})},n=i=>{t.delete(i.key)};return ta(()=>{window.addEventListener("keydown",s),window.addEventListener("keyup",n)}),aa(()=>{window.removeEventListener("keydown",s),window.removeEventListener("keyup",n)}),{isKeyPressed:i=>t.has(i)}},gs={goBack:{key:"Escape",description:"Go back from detail view to grid view",isConfigurable:!0,requiredPath:r=>/\/datasets\/[^/]+\/(samples|annotations)\/[^/]+/.test(r)||/\/samples\/[^/]+/.test(r),action:()=>{const r=Qe(bt).url.pathname,e=Qe(bt).params.dataset_id;if(/\/samples\/[^/]+/.test(r)&&!e){It("/");return}e&&(r.includes("/samples/")?It(vt.toSamples(e)):r.includes("/annotations/")&&It(vt.toAnnotations(e)))}}},hs=async({query_text:r="",model_id:e=""})=>{const t={data:[],error:void 0};try{const s=await Ze.GET("/api/text_embedding/embed_text",{params:{query:{query_text:r,model_id:e}}});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No data");t.data=s.data}catch(s){t.error="Error creating text embedding: "+String(s)}return t};var ms=y('<div class="space-y-2"><!> <!></div>'),ps=y('<div class="relative"><!> <!></div>'),_s=y('<div class="flex h-full w-full space-x-4 px-4 pb-4"><div class="flex w-80 flex-col space-y-6 rounded-[1vw] bg-card py-4"><div class="px-4"><!></div> <div class="min-h-0 flex-1 space-y-2 overflow-y-auto px-4 dark:[color-scheme:dark]"><div><!> <!></div> <!></div></div> <div class="flex1 flex flex-grow flex-col space-y-4 rounded-[1vw] bg-card p-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><!></div> <div class="w-4/12"><!></div></div> <!> <div class="flex min-h-0 flex-1"><!></div></div> <!></div>');function Ns(r,e){B(e,!0);const[t,s]=ft(),n=()=>le(bt,"$page",t),i=()=>le(p,"$textEmbedding",t),l=()=>le(K,"$featureFlags",t),d=()=>le(T,"$bonndedSampleSize",t);let m=n().params.dataset_id;const{dimensions:h,updateDimensions:b,annotationFilters:g,toggleAnnotationFilterSelection:E,sampleSize:_,setError:P,globalStorage:{setTextEmbedding:u,textEmbedding:p,setLastGridType:$}}=e.data,{handleKeyEvent:k}=Ma();ta(()=>{window.addEventListener("keydown",k),window.addEventListener("keyup",k)}),aa(()=>{window.removeEventListener("keydown",k),window.removeEventListener("keyup",k)}),fs({goBack:gs.goBack});let N=ze("samples");Ea(()=>{A(N,pe(n().url.pathname===vt.toAnnotations(m)?"annotations":"samples")),$(a(N))});const T=_.sampleSize;let R=ze(pe(i()?i().queryText:""));async function Fe(){if(a(R).trim()!=="")try{return(await hs({query_text:a(R),model_id:void 0})).data}catch(L){P(L.message),console.error("Error during API call:",L)}}async function xe(L){if(L.key==="Enter"){const Z=await Fe();Z&&u({queryText:a(R),embedding:Z})}}const{featureFlags:K}=vs(),q=C(()=>l().some(L=>L==="embeddingSearchEnabled"));var X=_s(),Me=f(X),Se=f(Me),Ve=f(Se);sr(Ve,{datasetId:m,get gridType(){return a(N)}}),c(Se);var Ge=v(Se,2),Oe=f(Ge),re=f(Oe);is(re,{dataset_id:m,get gridType(){return a(N)}});var de=v(re,2);rs(de,{datasetId:m,get gridType(){return a(N)}}),c(Oe);var Pe=v(Oe,2);Pt(Pe,{title:"Filters",icon:ur,children:(L,Z)=>{var j=ms(),z=f(j);Mr(z,{annotationFilters:g,onToggleAnnotationFilter:E});var ge=v(z,2);{var ne=Y=>{or(Y,{dimensions:h,onChange:b})};be(ge,Y=>{h&&Y(ne)})}c(j),o(L,j)}}),c(Ge),c(Me);var ke=v(Me,2),fe=f(ke),Te=f(fe),Re=f(Te);{var S=L=>{var Z=ps(),j=f(Z);cr(j,{class:"absolute left-2 top-[50%] h-4 w-4 translate-y-[-50%] text-muted-foreground"});var z=v(j,2);la(z,{placeholder:"Search",class:"pl-8",onkeydown:xe,get value(){return a(R)},set value(ge){A(R,pe(ge))}}),c(Z),o(L,Z)};be(Re,L=>{a(N)==="samples"&&a(q)&&L(S)})}c(Te);var O=v(Te,2),se=f(O);Cr(se,{get width(){return d().width},get onChange(){return _.updateWidth}}),c(O),c(fe);var Ce=v(fe,2);Kt(Ce,{class:"mb-4 bg-border-hard"});var D=v(Ce,2),ce=f(D);Ta(ce,e,"default",{},null),c(D),c(ke);var V=v(ke,2);kr(V,{}),c(X),o(r,X),J(),s()}export{Ns as component,zs as universal};
