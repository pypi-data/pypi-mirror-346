import{P as ee,c as Yt}from"../chunks/BBLiiV7J.js";import{t as j,a as P,c as It,s as et,b as ne}from"../chunks/BHT-efq3.js";import{p as nt,c as S,r as y,t as tt,a as at,f as ct,n as Dt,y as Ft,v as Q,q as it,aF as ae,j as r,l as J,s as D,aG as _t,A as oe,e as Lt}from"../chunks/DEifp24C.js";import{s as Nt,r as Ct,a as ot,i as gt,d as mt,c as Xt,p as ie,b as Rt}from"../chunks/BlMvkeYU.js";import{s as pt,G as Ot,k as Gt,i as St,I as Ht,f as se,d as re,H as wt,J as Tt,K as le,M as ce,N as jt,T as Mt,O as At,e as ft,c as vt,u as ue,j as Zt,b as de,g as he}from"../chunks/BOHqcjUC.js";import{S as qt,f as yt,a as xt,T as me,A as fe}from"../chunks/Cvs2XJxr.js";import"../chunks/Bui4M3W6.js";import{p as dt}from"../chunks/oLIpPV73.js";import{r as lt}from"../chunks/Cbydd1_z.js";import{a as ve,g as ge}from"../chunks/ZzpsRLWH.js";import{S as pe}from"../chunks/Dqb7AYPd.js";import{a as _e}from"../chunks/Fy-2sBgm.js";import{a as Bt}from"../chunks/CwT5Mmo2.js";function ye(n){const t=new Map;return n.forEach(o=>{const l=o.annotation_label.annotation_label_name;l&&t.set(l,(t.get(l)||0)+1)}),t}var xe=j("<div><!></div>");function Kt(n,t){nt(t,!0);var o=xe(),l=S(o);pt(l,()=>t.children),y(o),tt(v=>St(o,1,v),[()=>Ot(Gt("rounded-lg border border-gray-800 bg-black",t.className))]),P(n,o),at()}var be=j("<div><!></div>");function Ut(n,t){nt(t,!0);var o=be(),l=S(o);pt(l,()=>t.children),y(o),tt(v=>St(o,1,v),[()=>Ot(Gt("p-4",t.className))]),P(n,o),at()}function we(n,t){nt(t,!0);let o=Ct(t,["$$slots","$$events","$$legacy"]);Ht(n,Nt({name:"move-left"},()=>o,{iconNode:[["path",{d:"M6 8L2 12L6 16"}],["path",{d:"M2 12H22"}]],children:(v,f)=>{var u=It(),b=ct(u);pt(b,()=>t.children??Dt),P(v,u)},$$slots:{default:!0}})),at()}function Se(n,t){nt(t,!0);let o=Ct(t,["$$slots","$$events","$$legacy"]);Ht(n,Nt({name:"zoom-in"},()=>o,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]],children:(v,f)=>{var u=It(),b=ct(u);pt(b,()=>t.children??Dt),P(v,u)},$$slots:{default:!0}})),at()}function ze(n,t){nt(t,!0);let o=Ct(t,["$$slots","$$events","$$legacy"]);Ht(n,Nt({name:"zoom-out"},()=>o,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]],children:(v,f)=>{var u=It(),b=ct(u);pt(b,()=>t.children??Dt),P(v,u)},$$slots:{default:!0}})),at()}var Me=j('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!></div></div>'),Ae=j('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center space-x-4"><!> <h2 data-testid="sample-filename" class="text-xl font-semibold tracking-tight"> </h2></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function ke(n,t){nt(t,!0);const[o,l]=Xt(),v=()=>mt(w,"$lastGridType",o),f=()=>mt(L,"$selectedSampleAnnotationCropIds",o),u=()=>mt(z,"$selectedSampleIds",o),b=()=>mt(Z,"$isHidden",o),x=J(()=>{const g=dt.data.annotationId;if(g)return t.sample.annotations.find(H=>H.annotation_id===g)}),{lastGridType:w,selectedSampleIds:z,toggleSampleSelection:F,toggleSampleAnnotationCropSelection:A,selectedSampleAnnotationCropIds:L,getDatasetVersion:B}=se(),{isHidden:Z,handleKeyEvent:I}=ve(),{getKeyboardShortcuts:d}=re();let k=it(""),T=it(!0);const V=()=>{var g;(g=t.sample)!=null&&g.dataset_id?_t(v()==="samples"?lt.toSamples(t.sample.dataset_id):lt.toAnnotations(t.sample.dataset_id)):_t("/")},C=g=>{switch(g.key){case d.go_back:V();break;case"ArrowRight":p();break;case"ArrowLeft":G();break}I(g)};Ft(async()=>{var g;(g=t.sample)!=null&&g.dataset_id&&Q(k,ot(await B(t.sample.dataset_id))),window.addEventListener("keydown",C),window.addEventListener("keyup",I)}),ae(()=>{window.removeEventListener("keydown",C),window.removeEventListener("keyup",I)});const O=()=>{Q(T,!r(T))},R=J(()=>!!r(x)),p=()=>{dt.data.sampleAdjacents.next&&_t(lt.toSample(dt.data.sampleAdjacents.next.sample_id))},G=()=>{dt.data.sampleAdjacents.previous&&_t(lt.toSample(dt.data.sampleAdjacents.previous.sample_id))};var M=Ae(),W=S(M),X=S(W);const N=J(()=>v()==="samples"?lt.toSamples(t.sample.dataset_id):lt.toAnnotations(t.sample.dataset_id));wt(X,{variant:"outline",get href(){return r(N)},children:(g,H)=>{we(g,{})},$$slots:{default:!0}});var e=D(X,2),i=S(e);y(e),y(W);var a=D(W,2);qt(a,{class:"mb-4 bg-border-hard"});var s=D(a,2),c=S(s),h=S(c);Kt(h,{className:"h-full",children:(g,H)=>{Ut(g,{className:"h-full",children:(E,U)=>{var q=Me(),Y=S(q),K=S(Y),ut=S(K);{var Jt=rt=>{const zt=J(()=>f().has(r(x).annotation_id));Bt(rt,{onSelect:()=>A(r(x).annotation_id),get isSelected(){return r(zt)}})},Qt=rt=>{const zt=J(()=>u().has(t.sample.sample_id));Bt(rt,{onSelect:()=>F(t.sample.sample_id),get isSelected(){return r(zt)}})};gt(ut,rt=>{r(R)&&r(x)?rt(Jt):rt(Qt,!1)})}y(K);var $t=D(K,2);const te=J(()=>`${ee+t.sample.file_path_abs}${r(k)?`?v=${r(k)}`:""}`);Xe($t,{get imageURL(){return r(te)},get annotations(){return t.sample.annotations},get imageWidth(){return t.sample.width},get imageHeight(){return t.sample.height},get showOnlySelectedAnnotation(){return r(T)},get selectedAnnotation(){return r(x)},get hideAnnotations(){return b()}}),y(Y),y(q),P(E,q)},$$slots:{default:!0}})},$$slots:{default:!0}}),y(c);var m=D(c,2),_=S(m);an(_,{get sample(){return t.sample},get selectedAnnotation(){return r(x)},get showOnlySelectedAnnotation(){return r(T)},toggleShowOnlySelectedAnnotation:O}),y(m),y(s),y(M),tt(()=>et(i,`Filename: "${t.sample.file_name??""}"`)),P(n,M),at(),l()}function $(n){return typeof n=="string"?new Tt([[document.querySelector(n)]],[document.documentElement]):new Tt([[n]],le)}function Te(n){let t;for(;t=n.sourceEvent;)n=t;return n}function st(n,t){if(n=Te(n),t===void 0&&(t=n.currentTarget),t){var o=t.ownerSVGElement||t;if(o.createSVGPoint){var l=o.createSVGPoint();return l.x=n.clientX,l.y=n.clientY,l=l.matrixTransform(t.getScreenCTM().inverse()),[l.x,l.y]}if(t.getBoundingClientRect){var v=t.getBoundingClientRect();return[n.clientX-v.left-t.clientLeft,n.clientY-v.top-t.clientTop]}}return[n.pageX,n.pageY]}function Ee(n){return new Tt([document.querySelectorAll(n)],[document.documentElement])}const Et={capture:!0,passive:!1};function Pt(n){n.preventDefault(),n.stopImmediatePropagation()}function Pe(n){var t=n.document.documentElement,o=$(n).on("dragstart.drag",Pt,Et);"onselectstart"in t?o.on("selectstart.drag",Pt,Et):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ie(n,t){var o=n.document.documentElement,l=$(n).on("dragstart.drag",null);t&&(l.on("click.drag",Pt,Et),setTimeout(function(){l.on("click.drag",null)},0)),"onselectstart"in o?l.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}var De=1e-12;function Vt(n){return((n=Math.exp(n))+1/n)/2}function Ne(n){return((n=Math.exp(n))-1/n)/2}function Ce(n){return((n=Math.exp(2*n))-1)/(n+1)}const Oe=function n(t,o,l){function v(f,u){var b=f[0],x=f[1],w=f[2],z=u[0],F=u[1],A=u[2],L=z-b,B=F-x,Z=L*L+B*B,I,d;if(Z<De)d=Math.log(A/w)/t,I=function(R){return[b+R*L,x+R*B,w*Math.exp(t*R*d)]};else{var k=Math.sqrt(Z),T=(A*A-w*w+l*Z)/(2*w*o*k),V=(A*A-w*w-l*Z)/(2*A*o*k),C=Math.log(Math.sqrt(T*T+1)-T),O=Math.log(Math.sqrt(V*V+1)-V);d=(O-C)/t,I=function(R){var p=R*d,G=Vt(C),M=w/(o*k)*(G*Ce(t*p+C)-Ne(C));return[b+M*L,x+M*B,w*G/Vt(t*p+C)]}}return I.duration=d*1e3*t/Math.SQRT2,I}return v.rho=function(f){var u=Math.max(.001,+f),b=u*u,x=b*b;return n(u,b,x)},v}(Math.SQRT2,2,4),bt=n=>()=>n;function Ge(n,{sourceEvent:t,target:o,transform:l,dispatch:v}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},transform:{value:l,enumerable:!0,configurable:!0},_:{value:v}})}function kt(n){n.stopImmediatePropagation()}function ht(n){n.preventDefault(),n.stopImmediatePropagation()}function He(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function je(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function Wt(){return this.__zoom||jt}function Le(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function Re(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ze(n,t,o){var l=n.invertX(t[0][0])-o[0][0],v=n.invertX(t[1][0])-o[1][0],f=n.invertY(t[0][1])-o[0][1],u=n.invertY(t[1][1])-o[1][1];return n.translate(v>l?(l+v)/2:Math.min(0,l)||Math.max(0,v),u>f?(f+u)/2:Math.min(0,f)||Math.max(0,u))}function Be(){var n=He,t=je,o=Ze,l=Le,v=Re,f=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],b=250,x=Oe,w=ce("start","zoom","end"),z,F,A,L=500,B=150,Z=0,I=10;function d(e){e.property("__zoom",Wt).on("wheel.zoom",p,{passive:!1}).on("mousedown.zoom",G).on("dblclick.zoom",M).filter(v).on("touchstart.zoom",W).on("touchmove.zoom",X).on("touchend.zoom touchcancel.zoom",N).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}d.transform=function(e,i,a,s){var c=e.selection?e.selection():e;c.property("__zoom",Wt),e!==c?C(e,i,a,s):c.interrupt().each(function(){O(this,arguments).event(s).start().zoom(null,typeof i=="function"?i.apply(this,arguments):i).end()})},d.scaleBy=function(e,i,a,s){d.scaleTo(e,function(){var c=this.__zoom.k,h=typeof i=="function"?i.apply(this,arguments):i;return c*h},a,s)},d.scaleTo=function(e,i,a,s){d.transform(e,function(){var c=t.apply(this,arguments),h=this.__zoom,m=a==null?V(c):typeof a=="function"?a.apply(this,arguments):a,_=h.invert(m),g=typeof i=="function"?i.apply(this,arguments):i;return o(T(k(h,g),m,_),c,u)},a,s)},d.translateBy=function(e,i,a,s){d.transform(e,function(){return o(this.__zoom.translate(typeof i=="function"?i.apply(this,arguments):i,typeof a=="function"?a.apply(this,arguments):a),t.apply(this,arguments),u)},null,s)},d.translateTo=function(e,i,a,s,c){d.transform(e,function(){var h=t.apply(this,arguments),m=this.__zoom,_=s==null?V(h):typeof s=="function"?s.apply(this,arguments):s;return o(jt.translate(_[0],_[1]).scale(m.k).translate(typeof i=="function"?-i.apply(this,arguments):-i,typeof a=="function"?-a.apply(this,arguments):-a),h,u)},s,c)};function k(e,i){return i=Math.max(f[0],Math.min(f[1],i)),i===e.k?e:new Mt(i,e.x,e.y)}function T(e,i,a){var s=i[0]-a[0]*e.k,c=i[1]-a[1]*e.k;return s===e.x&&c===e.y?e:new Mt(e.k,s,c)}function V(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function C(e,i,a,s){e.on("start.zoom",function(){O(this,arguments).event(s).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(s).end()}).tween("zoom",function(){var c=this,h=arguments,m=O(c,h).event(s),_=t.apply(c,h),g=a==null?V(_):typeof a=="function"?a.apply(c,h):a,H=Math.max(_[1][0]-_[0][0],_[1][1]-_[0][1]),E=c.__zoom,U=typeof i=="function"?i.apply(c,h):i,q=x(E.invert(g).concat(H/E.k),U.invert(g).concat(H/U.k));return function(Y){if(Y===1)Y=U;else{var K=q(Y),ut=H/K[2];Y=new Mt(ut,g[0]-K[0]*ut,g[1]-K[1]*ut)}m.zoom(null,Y)}})}function O(e,i,a){return!a&&e.__zooming||new R(e,i)}function R(e,i){this.that=e,this.args=i,this.active=0,this.sourceEvent=null,this.extent=t.apply(e,i),this.taps=0}R.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,i){return this.mouse&&e!=="mouse"&&(this.mouse[1]=i.invert(this.mouse[0])),this.touch0&&e!=="touch"&&(this.touch0[1]=i.invert(this.touch0[0])),this.touch1&&e!=="touch"&&(this.touch1[1]=i.invert(this.touch1[0])),this.that.__zoom=i,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var i=$(this.that).datum();w.call(e,this.that,new Ge(e,{sourceEvent:this.sourceEvent,target:d,transform:this.that.__zoom,dispatch:w}),i)}};function p(e,...i){if(!n.apply(this,arguments))return;var a=O(this,i).event(e),s=this.__zoom,c=Math.max(f[0],Math.min(f[1],s.k*Math.pow(2,l.apply(this,arguments)))),h=st(e);if(a.wheel)(a.mouse[0][0]!==h[0]||a.mouse[0][1]!==h[1])&&(a.mouse[1]=s.invert(a.mouse[0]=h)),clearTimeout(a.wheel);else{if(s.k===c)return;a.mouse=[h,s.invert(h)],At(this),a.start()}ht(e),a.wheel=setTimeout(m,B),a.zoom("mouse",o(T(k(s,c),a.mouse[0],a.mouse[1]),a.extent,u));function m(){a.wheel=null,a.end()}}function G(e,...i){if(A||!n.apply(this,arguments))return;var a=e.currentTarget,s=O(this,i,!0).event(e),c=$(e.view).on("mousemove.zoom",g,!0).on("mouseup.zoom",H,!0),h=st(e,a),m=e.clientX,_=e.clientY;Pe(e.view),kt(e),s.mouse=[h,this.__zoom.invert(h)],At(this),s.start();function g(E){if(ht(E),!s.moved){var U=E.clientX-m,q=E.clientY-_;s.moved=U*U+q*q>Z}s.event(E).zoom("mouse",o(T(s.that.__zoom,s.mouse[0]=st(E,a),s.mouse[1]),s.extent,u))}function H(E){c.on("mousemove.zoom mouseup.zoom",null),Ie(E.view,s.moved),ht(E),s.event(E).end()}}function M(e,...i){if(n.apply(this,arguments)){var a=this.__zoom,s=st(e.changedTouches?e.changedTouches[0]:e,this),c=a.invert(s),h=a.k*(e.shiftKey?.5:2),m=o(T(k(a,h),s,c),t.apply(this,i),u);ht(e),b>0?$(this).transition().duration(b).call(C,m,s,e):$(this).call(d.transform,m,s,e)}}function W(e,...i){if(n.apply(this,arguments)){var a=e.touches,s=a.length,c=O(this,i,e.changedTouches.length===s).event(e),h,m,_,g;for(kt(e),m=0;m<s;++m)_=a[m],g=st(_,this),g=[g,this.__zoom.invert(g),_.identifier],c.touch0?!c.touch1&&c.touch0[2]!==g[2]&&(c.touch1=g,c.taps=0):(c.touch0=g,h=!0,c.taps=1+!!z);z&&(z=clearTimeout(z)),h&&(c.taps<2&&(F=g[0],z=setTimeout(function(){z=null},L)),At(this),c.start())}}function X(e,...i){if(this.__zooming){var a=O(this,i).event(e),s=e.changedTouches,c=s.length,h,m,_,g;for(ht(e),h=0;h<c;++h)m=s[h],_=st(m,this),a.touch0&&a.touch0[2]===m.identifier?a.touch0[0]=_:a.touch1&&a.touch1[2]===m.identifier&&(a.touch1[0]=_);if(m=a.that.__zoom,a.touch1){var H=a.touch0[0],E=a.touch0[1],U=a.touch1[0],q=a.touch1[1],Y=(Y=U[0]-H[0])*Y+(Y=U[1]-H[1])*Y,K=(K=q[0]-E[0])*K+(K=q[1]-E[1])*K;m=k(m,Math.sqrt(Y/K)),_=[(H[0]+U[0])/2,(H[1]+U[1])/2],g=[(E[0]+q[0])/2,(E[1]+q[1])/2]}else if(a.touch0)_=a.touch0[0],g=a.touch0[1];else return;a.zoom("touch",o(T(m,_,g),a.extent,u))}}function N(e,...i){if(this.__zooming){var a=O(this,i).event(e),s=e.changedTouches,c=s.length,h,m;for(kt(e),A&&clearTimeout(A),A=setTimeout(function(){A=null},L),h=0;h<c;++h)m=s[h],a.touch0&&a.touch0[2]===m.identifier?delete a.touch0:a.touch1&&a.touch1[2]===m.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),a.taps===2&&(m=st(m,this),Math.hypot(F[0]-m[0],F[1]-m[1])<I)){var _=$(this).on("dblclick.zoom");_&&_.apply(this,arguments)}}}return d.wheelDelta=function(e){return arguments.length?(l=typeof e=="function"?e:bt(+e),d):l},d.filter=function(e){return arguments.length?(n=typeof e=="function"?e:bt(!!e),d):n},d.touchable=function(e){return arguments.length?(v=typeof e=="function"?e:bt(!!e),d):v},d.extent=function(e){return arguments.length?(t=typeof e=="function"?e:bt([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),d):t},d.scaleExtent=function(e){return arguments.length?(f[0]=+e[0],f[1]=+e[1],d):[f[0],f[1]]},d.translateExtent=function(e){return arguments.length?(u[0][0]=+e[0][0],u[1][0]=+e[1][0],u[0][1]=+e[0][1],u[1][1]=+e[1][1],d):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},d.constrain=function(e){return arguments.length?(o=e,d):o},d.duration=function(e){return arguments.length?(b=+e,d):b},d.interpolate=function(e){return arguments.length?(x=e,d):x},d.on=function(){var e=w.on.apply(w,arguments);return e===w?d:e},d.clickDistance=function(e){return arguments.length?(Z=(e=+e)*e,d):Math.sqrt(Z)},d.tapDistance=function(e){return arguments.length?(I=+e,d):I},d}function Ve(n,t){let o=n.scaleIndependentXForm;o||(o=n.scaleIndependentXForm=t.createSVGTransform(),n.transform.baseVal.appendItem(o));const l=n.parentNode;if(l){const v=l.getScreenCTM();if(v){const f=v.inverse().multiply(t.getScreenCTM());f.e=f.f=0,o.setMatrix(f)}}}var We=j('<div class="pointer-events-auto absolute bottom-0 left-1 z-20 flex select-none items-center gap-1 rounded-lg bg-muted bg-opacity-80 shadow-md backdrop-blur-sm"><!> <div class="h-6 w-px bg-white bg-opacity-20"></div> <!> <div class="w-[32px] text-center text-sm text-muted-foreground" data-testid="zoom-level"> </div> <!></div>');function Ye(n,t){var o=We(),l=S(o);wt(l,{variant:"ghost","data-testid":"zoom-reset",size:"sm",get onclick(){return t.onZoomReset},get disabled(){return t.isResetDisabled},children:(x,w)=>{oe();var z=ne("Reset");P(x,z)},$$slots:{default:!0}});var v=D(l,4);wt(v,{title:"zoom out",variant:"ghost",size:"icon","data-testid":"zoom-out",get onclick(){return t.onZoomOut},get disabled(){return t.isZoominDisabled},children:(x,w)=>{ze(x,{class:"h-4 w-4"})},$$slots:{default:!0}});var f=D(v,2),u=S(f);y(f);var b=D(f,2);wt(b,{title:"zoom in",variant:"ghost",size:"icon","data-testid":"zoom-in",get onclick(){return t.onZoomIn},get disabled(){return t.isZoomoutDisabled},children:(x,w)=>{Se(x,{class:"h-4 w-4"})},$$slots:{default:!0}}),y(o),tt(x=>et(u,`${x??""}%`),[()=>Math.round(t.scale*100)]),P(n,o)}var Fe=j('<div class="relative flex h-full w-full select-none items-center justify-center"><!> <svg class="z-10 h-full w-full cursor-grab" preserveAspectRatio="xMidYMid meet"><g><image></image><g></g></g></svg> <svg class="pointer-events-none absolute inset-0" preserveAspectRatio="xMidYMid meet"></svg></div>');function Xe(n,t){nt(t,!0);let o=it(null),l=it(null);const v=ie(t,"hideAnnotations",3,!1);let f=it(800),u=it(600);Lt(()=>{if(!r(o))return;Q(f,ot(r(o).clientWidth)),Q(u,ot(r(o).clientHeight));const p=new ResizeObserver(()=>{r(o)&&(Q(f,ot(r(o).clientWidth)),Q(u,ot(r(o).clientHeight)))});return p.observe(r(o)),()=>p.disconnect()});const b=J(()=>t.selectedAnnotation&&t.showOnlySelectedAnnotation?[t.selectedAnnotation]:t.annotations),x=10,w=J(()=>{const p={x:0,y:0,width:t.imageWidth,height:t.imageHeight};if(t.selectedAnnotation){const{x:G,y:M,width:W,height:X}=t.selectedAnnotation;return{x:Math.round(Math.max(0,G-x)),y:Math.round(Math.max(0,M-x)),width:Math.round(Math.min(t.imageWidth-G,W+x*2)),height:Math.round(Math.min(t.imageHeight-M,X+x*2))}}return p});let z=it(ot({k:1,x:0,y:0}));const F=J(()=>{if(!r(o))return 1;const p=r(f)/t.imageWidth,G=r(u)/t.imageHeight,M=Math.min(p,G);return r(z).k*M});let A=it(null);const L=()=>{r(o)&&(Q(A,ot(Be().on("zoom",p=>{Q(z,ot(p.transform))}).filter(p=>(!p.ctrlKey||p.type==="wheel")&&!p.button&&!(p.type==="mousedown"&&p.button===2)).wheelDelta(p=>-p.deltaY*.002))),$(r(o)).call(r(A)).on("dblclick.zoom",null))},B=p=>{if(!r(o)||!r(A))return;const G=p?1.5:.75;$(r(o)).transition().duration(300).call(r(A).scaleBy,G)},Z=()=>{!r(o)||!r(A)||$(r(o)).transition().duration(300).call(r(A).transform,jt)};Ft(()=>{L()}),Lt(()=>{r(z).k,Ee(".unscaled").each(function(){Ve(this,r(l))})});var I=Fe(),d=S(I);Ye(d,{get scale(){return r(F)},onZoomIn:()=>B(!0),onZoomOut:()=>B(!1),onZoomReset:Z});var k=D(d,2),T=S(k),V=S(T),C=D(V);let O;ft(C,21,()=>r(b),p=>p.annotation_id,(p,G)=>{pe(p,{get annotation(){return r(G)},showLabel:!0,get imageWidth(){return t.imageWidth}})}),y(C),y(T),y(k),Rt(k,p=>Q(o,p),()=>r(o));var R=D(k,2);vt(R,"viewBox","0 0 1024 768"),Rt(R,p=>Q(l,p),()=>r(l)),y(I),tt(p=>{vt(k,"viewBox",`${r(w).x} ${r(w).y} ${r(w).width} ${r(w).height}`),vt(T,"transform",`translate(${r(z).x}, ${r(z).y}) scale(${r(z).k})`),vt(V,"href",t.imageURL),O=St(C,0,"svelte-10ogmpt",null,O,p)},[()=>({"annotations-hidden":v()})]),P(n,I),at()}var qe=j('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1),Ke=j('<div class="flex flex-col gap-4"><!> <div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div></div>'),Ue=j("<div> </div>"),Je=j('<div class="flex gap-1"></div>'),Qe=j('<div class="flex items-center justify-between gap-2 rounded-sm bg-card px-5 py-2"><div class="text-sm"> </div> <div class="text-sm"> </div></div>'),$e=j('<div class="flex flex-col gap-2"></div>'),tn=j('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1),en=j('<div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div>'),nn=j('<div class="flex-none"><div class="mb-2.5 text-lg font-semibold">Sample details</div> <!></div> <div class="flex h-full min-h-0 flex-col space-y-2 overflow-y-auto dark:[color-scheme:dark]"><!> <!> <!> <!></div>',1);function an(n,t){nt(t,!0);const[o,l]=Xt(),v=()=>mt(f,"$taskMap",o),{taskMap:f}=ue(),u=t.sample.tags,b=ye(t.sample.annotations),x=J(()=>t.selectedAnnotation&&t.selectedAnnotation.annotation_task_id&&v().has(t.selectedAnnotation.annotation_task_id)?v().get(t.selectedAnnotation.annotation_task_id).is_prediction:!1),w=[{label:"Height:",value:yt(t.sample.height)+"px"},{label:"Width:",value:yt(t.sample.width)+"px"},{label:"Filename:",value:t.sample.file_name},{label:"Filepath:",value:t.sample.file_path_abs}],z=J(()=>t.selectedAnnotation?[{label:"Height:",value:yt(Math.round(t.selectedAnnotation.height))+"px"},{label:"Width:",value:yt(Math.round(t.selectedAnnotation.width))+"px"},{label:"Annotation:",value:t.selectedAnnotation.annotation_label.annotation_label_name},{label:"Type:",value:"Bounding box"},{label:"Status:",value:r(x)?"Prediction":"Ground Truth"}]:[]);Kt(n,{className:"h-full",children:(F,A)=>{Ut(F,{className:"h-full flex flex-col",children:(L,B)=>{var Z=nn(),I=ct(Z),d=D(S(I),2);qt(d,{class:"mb-4 bg-border-hard"}),y(I);var k=D(I,2),T=S(k);{var V=M=>{xt(M,{title:"Selected annotation",children:(W,X)=>{var N=Ke(),e=S(N);_e(e,{name:"show-all",label:"Show only selected annotation",get isChecked(){return t.showOnlySelectedAnnotation},helperText:"Hides other annotations for clarity.",get onCheckedChange(){return t.toggleShowOnlySelectedAnnotation}});var i=D(e,2);ft(i,21,()=>r(z),({label:a,value:s})=>a,(a,s)=>{let c=()=>r(s).label,h=()=>r(s).value;var m=qe(),_=ct(m),g=S(_,!0);y(_);var H=D(_,2),E=S(H,!0);y(H),tt(()=>{et(g,c()),et(E,h())}),P(a,m)}),y(i),y(N),P(W,N)}})};gt(T,M=>{t.selectedAnnotation&&M(V)})}var C=D(T,2);{var O=M=>{xt(M,{title:"Tags",icon:me,children:(W,X)=>{var N=Je();ft(N,21,()=>u,Zt,(e,i)=>{var a=Ue(),s=S(a,!0);y(a),tt(c=>{St(a,1,c),et(s,r(i).name)},[()=>Ot(Gt("inline rounded-lg bg-card px-2 py-2 text-xs"))]),P(e,a)}),y(N),P(W,N)}})};gt(C,M=>{u.length>0&&M(O)})}var R=D(C,2);{var p=M=>{xt(M,{title:"Annotations",children:(W,X)=>{var N=$e();ft(N,21,()=>b,Zt,(e,i)=>{var a=Qe(),s=S(a),c=S(s,!0);y(s);var h=D(s,2),m=S(h);y(h),y(a),tt(_=>{et(c,r(i)[0]),de(h,`color: ${_??""};`),et(m,`(${r(i)[1]??""})`)},[()=>ge(r(i)[0]).color]),P(e,a)}),y(N),P(W,N)}})};gt(R,M=>{b.size>0&&M(p)})}var G=D(R,2);xt(G,{title:"Metadata",children:(M,W)=>{var X=en();ft(X,21,()=>w,({label:N,value:e})=>N,(N,e)=>{let i=()=>r(e).label,a=()=>r(e).value;var s=tn(),c=ct(s),h=S(c,!0);y(c);var m=D(c,2),_=S(m,!0);y(m),tt(()=>{et(h,i()),et(_,a())}),P(N,s)}),y(X),P(M,X)}}),y(k),P(L,Z)},$$slots:{default:!0}})},$$slots:{default:!0}}),at(),l()}const on=async({sample_id:n})=>{const t={data:void 0,error:void 0};try{const o=await Yt.GET("/api/samples/{sample_id}",{params:{path:{sample_id:n}}});if(o.error)throw new Error(JSON.stringify(o.error,null,2));if(!o.data)throw new Error("No data");t.data=o.data}catch(o){t.error="Error loading sample: "+String(o)}return t},sn=async({sample_id:n,body:t})=>{const o={data:void 0,error:void 0};try{const l=await Yt.POST("/api/samples/{sample_id}/adjacent",{params:{path:{sample_id:n}},body:t});if(l.error)throw new Error(JSON.stringify(l.error,null,2));if(!l.data)throw new Error("No data");o.data=l.data}catch(l){o.error="Error loading sample adjacents: "+String(l)}return o},rn=async({params:n,url:t})=>{const{sample_id:o}=n,{data:l,error:v}=await on({sample_id:o}),{data:f,error:u}=await sn({sample_id:o});return{sample:l,annotationId:t.searchParams.get("annotationId"),error:v||u,sampleAdjacents:f}},zn=Object.freeze(Object.defineProperty({__proto__:null,load:rn},Symbol.toStringTag,{value:"Module"}));var ln=j("<a>Go home</a>"),cn=j('<div class="flex h-full w-full space-x-4 px-4 pb-4"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function Mn(n,t){nt(t,!0);const o=he(),[l,v]=o;var f=cn(),u=S(f),b=S(u);{var x=z=>{ke(z,{get sample(){return t.data.sample}})},w=z=>{fe(z,{title:"Sample not found",children:(F,A)=>{var L=ln();tt(B=>vt(L,"href",B),[()=>l("/",void 0)]),P(F,L)}})};gt(b,z=>{t.data.sample?z(x):z(w,!1)})}y(u),y(f),P(n,f),at()}export{Mn as component,zn as universal};
