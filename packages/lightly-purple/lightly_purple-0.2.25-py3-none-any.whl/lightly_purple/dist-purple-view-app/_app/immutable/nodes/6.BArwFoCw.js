import{P as ne,r as pt,c as Ft}from"../chunks/CRLA7a-5.js";import{s as gt,M as It,l as Dt,j as wt,I as Nt,g as Ut,d as qt,N as bt,O as ae,Q as Tt,R as oe,U as ie,V as Ct,W as zt,X as Mt,e as mt,c as ft,u as se,k as Bt,b as re,m as le,f as ce,h as ue}from"../chunks/OyE1vH6U.js";import{p as ot,c as w,r as x,t as et,a as it,f as ut,e as Ot,A as Kt,k as J,i as nt,aD as de,g as r,d as K,s as P,aE as Gt,n as he,j as At,l as st}from"../chunks/Db_QKtB5.js";import{t as Z,a as I,c as Lt,s as at,b as me}from"../chunks/CCHOD-L1.js";import{s as Ht,r as Rt,a as $,i as vt,d as ct,c as Vt,p as fe,b as Wt}from"../chunks/BkOFT6Jj.js";import{S as Qt,a as _t,T as ve,f as yt,A as ge}from"../chunks/Mvxe7S3b.js";import{p as pe}from"../chunks/B48UUeh1.js";import{a as _e,g as ye}from"../chunks/BK6Q2Dkz.js";import{S as xe}from"../chunks/D2Zhl4bK.js";import{C as be}from"../chunks/DrHL3fc3.js";import{a as jt}from"../chunks/CpCXJ9mc.js";function we(n){const e=new Map;return n.forEach(o=>{const l=o.annotation_label.annotation_label_name;l&&e.set(l,(e.get(l)||0)+1)}),e}var Se=Z("<div><!></div>");function Jt(n,e){ot(e,!0);var o=Se(),l=w(o);gt(l,()=>e.children),x(o),et(g=>wt(o,1,g),[()=>It(Dt("rounded-lg border border-gray-800 bg-black",e.className))]),I(n,o),it()}var ze=Z("<div><!></div>");function $t(n,e){ot(e,!0);var o=ze(),l=w(o);gt(l,()=>e.children),x(o),et(g=>wt(o,1,g),[()=>It(Dt("p-4",e.className))]),I(n,o),it()}function Me(n,e){ot(e,!0);let o=Rt(e,["$$slots","$$events","$$legacy"]);Nt(n,Ht({name:"move-left"},()=>o,{iconNode:[["path",{d:"M6 8L2 12L6 16"}],["path",{d:"M2 12H22"}]],children:(g,p)=>{var h=Lt(),m=ut(h);gt(m,()=>e.children??Ot),I(g,h)},$$slots:{default:!0}})),it()}function Ae(n,e){ot(e,!0);let o=Rt(e,["$$slots","$$events","$$legacy"]);Nt(n,Ht({name:"zoom-in"},()=>o,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]],children:(g,p)=>{var h=Lt(),m=ut(h);gt(m,()=>e.children??Ot),I(g,h)},$$slots:{default:!0}})),it()}function ke(n,e){ot(e,!0);let o=Rt(e,["$$slots","$$events","$$legacy"]);Nt(n,Ht({name:"zoom-out"},()=>o,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]],children:(g,p)=>{var h=Lt(),m=ut(h);gt(m,()=>e.children??Ot),I(g,h)},$$slots:{default:!0}})),it()}var Te=Z('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),Ee=Z('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center space-x-4"><!> <h2 data-testid="sample-filename" class="text-xl font-semibold tracking-tight"> </h2></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function Pe(n,e){ot(e,!0);const[o,l]=Vt(),g=()=>ct(b,"$lastGridType",o),p=()=>ct(T,"$selectedSampleAnnotationCropIds",o),h=()=>ct(S,"$selectedSampleIds",o),m=()=>ct(A,"$isHidden",o),y=K(()=>{const c=pe.data.annotationId;if(c)return e.sample.annotations.find(_=>_.annotation_id===c)}),{lastGridType:b,selectedSampleIds:S,toggleSampleSelection:L,toggleSampleAnnotationCropSelection:D,selectedSampleAnnotationCropIds:T,getDatasetVersion:O}=Ut(),{isHidden:A,handleKeyEvent:E}=_e(),{getKeyboardShortcuts:u}=qt();let V=nt(""),N=nt(!0);const Y=()=>{var c;(c=e.sample)!=null&&c.dataset_id?Gt(g()==="samples"?pt.toSamples(e.sample.dataset_id):pt.toAnnotations(e.sample.dataset_id)):Gt("/")},H=c=>{switch(c.key){case u.go_back:Y();break;case" ":c.preventDefault(),r(C)&&r(y)?D(r(y).annotation_id):L(e.sample.sample_id);break}E(c)};Kt(async()=>{var c;(c=e.sample)!=null&&c.dataset_id&&J(V,$(await O(e.sample.dataset_id))),window.addEventListener("keydown",H),window.addEventListener("keyup",E)}),de(()=>{window.removeEventListener("keydown",H),window.removeEventListener("keyup",E)});const R=()=>{J(N,!r(N))},C=K(()=>!!r(y));var B=Ee(),X=w(B),z=w(X);const F=K(()=>g()==="samples"?pt.toSamples(e.sample.dataset_id):pt.toAnnotations(e.sample.dataset_id));bt(z,{variant:"outline",get href(){return r(F)},children:(c,_)=>{Me(c,{})},$$slots:{default:!0}});var G=P(z,2),f=w(G);x(G),x(X);var t=P(X,2);Qt(t,{class:"mb-4 bg-border-hard"});var i=P(t,2),a=w(i),s=w(a);Jt(s,{className:"h-full",children:(c,_)=>{$t(c,{className:"h-full",children:(M,W)=>{var k=Te(),j=w(k),U=w(j),q=w(U);{var Q=lt=>{const St=K(()=>p().has(r(y).annotation_id));jt(lt,{onSelect:()=>D(r(y).annotation_id),get isSelected(){return r(St)}})},dt=lt=>{const St=K(()=>h().has(e.sample.sample_id));jt(lt,{onSelect:()=>L(e.sample.sample_id),get isSelected(){return r(St)}})};vt(q,lt=>{r(C)&&r(y)?lt(Q):lt(dt,!1)})}x(U);var Zt=P(U,2);ae(Zt,{});var te=P(Zt,2);const ee=K(()=>`${ne+e.sample.file_path_abs}${r(V)?`?v=${r(V)}`:""}`);Ke(te,{get imageURL(){return r(ee)},get annotations(){return e.sample.annotations},get imageWidth(){return e.sample.width},get imageHeight(){return e.sample.height},get showOnlySelectedAnnotation(){return r(N)},get selectedAnnotation(){return r(y)},get hideAnnotations(){return m()}}),x(j),x(k),I(M,k)},$$slots:{default:!0}})},$$slots:{default:!0}}),x(a);var d=P(a,2),v=w(d);rn(v,{get sample(){return e.sample},get selectedAnnotation(){return r(y)},get showOnlySelectedAnnotation(){return r(N)},toggleShowOnlySelectedAnnotation:R}),x(d),x(i),x(B),et(()=>at(f,`Filename: "${e.sample.file_name??""}"`)),I(n,B),it(),l()}function tt(n){return typeof n=="string"?new Tt([[document.querySelector(n)]],[document.documentElement]):new Tt([[n]],oe)}function Ie(n){let e;for(;e=n.sourceEvent;)n=e;return n}function rt(n,e){if(n=Ie(n),e===void 0&&(e=n.currentTarget),e){var o=e.ownerSVGElement||e;if(o.createSVGPoint){var l=o.createSVGPoint();return l.x=n.clientX,l.y=n.clientY,l=l.matrixTransform(e.getScreenCTM().inverse()),[l.x,l.y]}if(e.getBoundingClientRect){var g=e.getBoundingClientRect();return[n.clientX-g.left-e.clientLeft,n.clientY-g.top-e.clientTop]}}return[n.pageX,n.pageY]}function De(n){return new Tt([document.querySelectorAll(n)],[document.documentElement])}const Et={capture:!0,passive:!1};function Pt(n){n.preventDefault(),n.stopImmediatePropagation()}function Ne(n){var e=n.document.documentElement,o=tt(n).on("dragstart.drag",Pt,Et);"onselectstart"in e?o.on("selectstart.drag",Pt,Et):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Ce(n,e){var o=n.document.documentElement,l=tt(n).on("dragstart.drag",null);e&&(l.on("click.drag",Pt,Et),setTimeout(function(){l.on("click.drag",null)},0)),"onselectstart"in o?l.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}var Oe=1e-12;function Yt(n){return((n=Math.exp(n))+1/n)/2}function Le(n){return((n=Math.exp(n))-1/n)/2}function He(n){return((n=Math.exp(2*n))-1)/(n+1)}const Re=function n(e,o,l){function g(p,h){var m=p[0],y=p[1],b=p[2],S=h[0],L=h[1],D=h[2],T=S-m,O=L-y,A=T*T+O*O,E,u;if(A<Oe)u=Math.log(D/b)/e,E=function(C){return[m+C*T,y+C*O,b*Math.exp(e*C*u)]};else{var V=Math.sqrt(A),N=(D*D-b*b+l*A)/(2*b*o*V),Y=(D*D-b*b-l*A)/(2*D*o*V),H=Math.log(Math.sqrt(N*N+1)-N),R=Math.log(Math.sqrt(Y*Y+1)-Y);u=(R-H)/e,E=function(C){var B=C*u,X=Yt(H),z=b/(o*V)*(X*He(e*B+H)-Le(H));return[m+z*T,y+z*O,b*X/Yt(e*B+H)]}}return E.duration=u*1e3*e/Math.SQRT2,E}return g.rho=function(p){var h=Math.max(.001,+p),m=h*h,y=m*m;return n(h,m,y)},g}(Math.SQRT2,2,4),xt=n=>()=>n;function Ve(n,{sourceEvent:e,target:o,transform:l,dispatch:g}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},transform:{value:l,enumerable:!0,configurable:!0},_:{value:g}})}function kt(n){n.stopImmediatePropagation()}function ht(n){n.preventDefault(),n.stopImmediatePropagation()}function Ze(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function Be(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function Xt(){return this.__zoom||Ct}function Ge(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function We(){return navigator.maxTouchPoints||"ontouchstart"in this}function je(n,e,o){var l=n.invertX(e[0][0])-o[0][0],g=n.invertX(e[1][0])-o[1][0],p=n.invertY(e[0][1])-o[0][1],h=n.invertY(e[1][1])-o[1][1];return n.translate(g>l?(l+g)/2:Math.min(0,l)||Math.max(0,g),h>p?(p+h)/2:Math.min(0,p)||Math.max(0,h))}function Ye(){var n=Ze,e=Be,o=je,l=Ge,g=We,p=[0,1/0],h=[[-1/0,-1/0],[1/0,1/0]],m=250,y=Re,b=ie("start","zoom","end"),S,L,D,T=500,O=150,A=0,E=10;function u(t){t.property("__zoom",Xt).on("wheel.zoom",B,{passive:!1}).on("mousedown.zoom",X).on("dblclick.zoom",z).filter(g).on("touchstart.zoom",F).on("touchmove.zoom",G).on("touchend.zoom touchcancel.zoom",f).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.transform=function(t,i,a,s){var d=t.selection?t.selection():t;d.property("__zoom",Xt),t!==d?H(t,i,a,s):d.interrupt().each(function(){R(this,arguments).event(s).start().zoom(null,typeof i=="function"?i.apply(this,arguments):i).end()})},u.scaleBy=function(t,i,a,s){u.scaleTo(t,function(){var d=this.__zoom.k,v=typeof i=="function"?i.apply(this,arguments):i;return d*v},a,s)},u.scaleTo=function(t,i,a,s){u.transform(t,function(){var d=e.apply(this,arguments),v=this.__zoom,c=a==null?Y(d):typeof a=="function"?a.apply(this,arguments):a,_=v.invert(c),M=typeof i=="function"?i.apply(this,arguments):i;return o(N(V(v,M),c,_),d,h)},a,s)},u.translateBy=function(t,i,a,s){u.transform(t,function(){return o(this.__zoom.translate(typeof i=="function"?i.apply(this,arguments):i,typeof a=="function"?a.apply(this,arguments):a),e.apply(this,arguments),h)},null,s)},u.translateTo=function(t,i,a,s,d){u.transform(t,function(){var v=e.apply(this,arguments),c=this.__zoom,_=s==null?Y(v):typeof s=="function"?s.apply(this,arguments):s;return o(Ct.translate(_[0],_[1]).scale(c.k).translate(typeof i=="function"?-i.apply(this,arguments):-i,typeof a=="function"?-a.apply(this,arguments):-a),v,h)},s,d)};function V(t,i){return i=Math.max(p[0],Math.min(p[1],i)),i===t.k?t:new zt(i,t.x,t.y)}function N(t,i,a){var s=i[0]-a[0]*t.k,d=i[1]-a[1]*t.k;return s===t.x&&d===t.y?t:new zt(t.k,s,d)}function Y(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function H(t,i,a,s){t.on("start.zoom",function(){R(this,arguments).event(s).start()}).on("interrupt.zoom end.zoom",function(){R(this,arguments).event(s).end()}).tween("zoom",function(){var d=this,v=arguments,c=R(d,v).event(s),_=e.apply(d,v),M=a==null?Y(_):typeof a=="function"?a.apply(d,v):a,W=Math.max(_[1][0]-_[0][0],_[1][1]-_[0][1]),k=d.__zoom,j=typeof i=="function"?i.apply(d,v):i,U=y(k.invert(M).concat(W/k.k),j.invert(M).concat(W/j.k));return function(q){if(q===1)q=j;else{var Q=U(q),dt=W/Q[2];q=new zt(dt,M[0]-Q[0]*dt,M[1]-Q[1]*dt)}c.zoom(null,q)}})}function R(t,i,a){return!a&&t.__zooming||new C(t,i)}function C(t,i){this.that=t,this.args=i,this.active=0,this.sourceEvent=null,this.extent=e.apply(t,i),this.taps=0}C.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,i){return this.mouse&&t!=="mouse"&&(this.mouse[1]=i.invert(this.mouse[0])),this.touch0&&t!=="touch"&&(this.touch0[1]=i.invert(this.touch0[0])),this.touch1&&t!=="touch"&&(this.touch1[1]=i.invert(this.touch1[0])),this.that.__zoom=i,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var i=tt(this.that).datum();b.call(t,this.that,new Ve(t,{sourceEvent:this.sourceEvent,target:u,transform:this.that.__zoom,dispatch:b}),i)}};function B(t,...i){if(!n.apply(this,arguments))return;var a=R(this,i).event(t),s=this.__zoom,d=Math.max(p[0],Math.min(p[1],s.k*Math.pow(2,l.apply(this,arguments)))),v=rt(t);if(a.wheel)(a.mouse[0][0]!==v[0]||a.mouse[0][1]!==v[1])&&(a.mouse[1]=s.invert(a.mouse[0]=v)),clearTimeout(a.wheel);else{if(s.k===d)return;a.mouse=[v,s.invert(v)],Mt(this),a.start()}ht(t),a.wheel=setTimeout(c,O),a.zoom("mouse",o(N(V(s,d),a.mouse[0],a.mouse[1]),a.extent,h));function c(){a.wheel=null,a.end()}}function X(t,...i){if(D||!n.apply(this,arguments))return;var a=t.currentTarget,s=R(this,i,!0).event(t),d=tt(t.view).on("mousemove.zoom",M,!0).on("mouseup.zoom",W,!0),v=rt(t,a),c=t.clientX,_=t.clientY;Ne(t.view),kt(t),s.mouse=[v,this.__zoom.invert(v)],Mt(this),s.start();function M(k){if(ht(k),!s.moved){var j=k.clientX-c,U=k.clientY-_;s.moved=j*j+U*U>A}s.event(k).zoom("mouse",o(N(s.that.__zoom,s.mouse[0]=rt(k,a),s.mouse[1]),s.extent,h))}function W(k){d.on("mousemove.zoom mouseup.zoom",null),Ce(k.view,s.moved),ht(k),s.event(k).end()}}function z(t,...i){if(n.apply(this,arguments)){var a=this.__zoom,s=rt(t.changedTouches?t.changedTouches[0]:t,this),d=a.invert(s),v=a.k*(t.shiftKey?.5:2),c=o(N(V(a,v),s,d),e.apply(this,i),h);ht(t),m>0?tt(this).transition().duration(m).call(H,c,s,t):tt(this).call(u.transform,c,s,t)}}function F(t,...i){if(n.apply(this,arguments)){var a=t.touches,s=a.length,d=R(this,i,t.changedTouches.length===s).event(t),v,c,_,M;for(kt(t),c=0;c<s;++c)_=a[c],M=rt(_,this),M=[M,this.__zoom.invert(M),_.identifier],d.touch0?!d.touch1&&d.touch0[2]!==M[2]&&(d.touch1=M,d.taps=0):(d.touch0=M,v=!0,d.taps=1+!!S);S&&(S=clearTimeout(S)),v&&(d.taps<2&&(L=M[0],S=setTimeout(function(){S=null},T)),Mt(this),d.start())}}function G(t,...i){if(this.__zooming){var a=R(this,i).event(t),s=t.changedTouches,d=s.length,v,c,_,M;for(ht(t),v=0;v<d;++v)c=s[v],_=rt(c,this),a.touch0&&a.touch0[2]===c.identifier?a.touch0[0]=_:a.touch1&&a.touch1[2]===c.identifier&&(a.touch1[0]=_);if(c=a.that.__zoom,a.touch1){var W=a.touch0[0],k=a.touch0[1],j=a.touch1[0],U=a.touch1[1],q=(q=j[0]-W[0])*q+(q=j[1]-W[1])*q,Q=(Q=U[0]-k[0])*Q+(Q=U[1]-k[1])*Q;c=V(c,Math.sqrt(q/Q)),_=[(W[0]+j[0])/2,(W[1]+j[1])/2],M=[(k[0]+U[0])/2,(k[1]+U[1])/2]}else if(a.touch0)_=a.touch0[0],M=a.touch0[1];else return;a.zoom("touch",o(N(c,_,M),a.extent,h))}}function f(t,...i){if(this.__zooming){var a=R(this,i).event(t),s=t.changedTouches,d=s.length,v,c;for(kt(t),D&&clearTimeout(D),D=setTimeout(function(){D=null},T),v=0;v<d;++v)c=s[v],a.touch0&&a.touch0[2]===c.identifier?delete a.touch0:a.touch1&&a.touch1[2]===c.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),a.taps===2&&(c=rt(c,this),Math.hypot(L[0]-c[0],L[1]-c[1])<E)){var _=tt(this).on("dblclick.zoom");_&&_.apply(this,arguments)}}}return u.wheelDelta=function(t){return arguments.length?(l=typeof t=="function"?t:xt(+t),u):l},u.filter=function(t){return arguments.length?(n=typeof t=="function"?t:xt(!!t),u):n},u.touchable=function(t){return arguments.length?(g=typeof t=="function"?t:xt(!!t),u):g},u.extent=function(t){return arguments.length?(e=typeof t=="function"?t:xt([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),u):e},u.scaleExtent=function(t){return arguments.length?(p[0]=+t[0],p[1]=+t[1],u):[p[0],p[1]]},u.translateExtent=function(t){return arguments.length?(h[0][0]=+t[0][0],h[1][0]=+t[1][0],h[0][1]=+t[0][1],h[1][1]=+t[1][1],u):[[h[0][0],h[0][1]],[h[1][0],h[1][1]]]},u.constrain=function(t){return arguments.length?(o=t,u):o},u.duration=function(t){return arguments.length?(m=+t,u):m},u.interpolate=function(t){return arguments.length?(y=t,u):y},u.on=function(){var t=b.on.apply(b,arguments);return t===b?u:t},u.clickDistance=function(t){return arguments.length?(A=(t=+t)*t,u):Math.sqrt(A)},u.tapDistance=function(t){return arguments.length?(E=+t,u):E},u}function Xe(n,e){let o=n.scaleIndependentXForm;o||(o=n.scaleIndependentXForm=e.createSVGTransform(),n.transform.baseVal.appendItem(o));const l=n.parentNode;if(l){const g=l.getScreenCTM();if(g){const p=g.inverse().multiply(e.getScreenCTM());p.e=p.f=0,o.setMatrix(p)}}}var Fe=Z('<div class="pointer-events-auto absolute bottom-0 left-1 z-20 flex select-none items-center gap-1 rounded-lg bg-muted bg-opacity-80 shadow-md backdrop-blur-sm"><!> <div class="h-6 w-px bg-white bg-opacity-20"></div> <!> <div class="w-[32px] text-center text-sm text-muted-foreground" data-testid="zoom-level"> </div> <!></div>');function Ue(n,e){var o=Fe(),l=w(o);bt(l,{variant:"ghost","data-testid":"zoom-reset",size:"sm",get onclick(){return e.onZoomReset},get disabled(){return e.isResetDisabled},children:(y,b)=>{he();var S=me("Reset");I(y,S)},$$slots:{default:!0}});var g=P(l,4);bt(g,{title:"zoom out",variant:"ghost",size:"icon","data-testid":"zoom-out",get onclick(){return e.onZoomOut},get disabled(){return e.isZoominDisabled},children:(y,b)=>{ke(y,{class:"h-4 w-4"})},$$slots:{default:!0}});var p=P(g,2),h=w(p);x(p);var m=P(p,2);bt(m,{title:"zoom in",variant:"ghost",size:"icon","data-testid":"zoom-in",get onclick(){return e.onZoomIn},get disabled(){return e.isZoomoutDisabled},children:(y,b)=>{Ae(y,{class:"h-4 w-4"})},$$slots:{default:!0}}),x(o),et(y=>at(h,`${y??""}%`),[()=>Math.round(e.scale*100)]),I(n,o)}var qe=Z('<div class="relative flex h-full w-full select-none items-center justify-center"><!> <svg class="z-10 h-full w-full cursor-grab" preserveAspectRatio="xMidYMid meet"><g><image></image><g></g></g></svg> <svg class="pointer-events-none absolute inset-0" preserveAspectRatio="xMidYMid meet"></svg></div>');function Ke(n,e){ot(e,!0);const[o,l]=Vt(),g=()=>ct(p,"$showAnnotationTextLabelsStore",o),{showAnnotationTextLabelsStore:p}=qt();let h=nt($(g()));At(()=>{J(h,$(g()))});let m=nt(null),y=nt(null);const b=fe(e,"hideAnnotations",3,!1);let S=nt(800),L=nt(600);At(()=>{if(!r(m))return;J(S,$(r(m).clientWidth)),J(L,$(r(m).clientHeight));const f=new ResizeObserver(()=>{r(m)&&(J(S,$(r(m).clientWidth)),J(L,$(r(m).clientHeight)))});return f.observe(r(m)),()=>f.disconnect()});const D=K(()=>e.selectedAnnotation&&e.showOnlySelectedAnnotation?[e.selectedAnnotation]:e.annotations),T=10,O=K(()=>{const f={x:0,y:0,width:e.imageWidth,height:e.imageHeight};if(e.selectedAnnotation){const{x:t,y:i,width:a,height:s}=e.selectedAnnotation;return{x:Math.round(Math.max(0,t-T)),y:Math.round(Math.max(0,i-T)),width:Math.round(Math.min(e.imageWidth-t,a+T*2)),height:Math.round(Math.min(e.imageHeight-i,s+T*2))}}return f});let A=nt($({k:1,x:0,y:0}));const E=K(()=>{if(!r(m))return 1;const f=r(S)/e.imageWidth,t=r(L)/e.imageHeight,i=Math.min(f,t);return r(A).k*i});let u=nt(null);const V=()=>{r(m)&&(J(u,$(Ye().on("zoom",f=>{J(A,$(f.transform))}).filter(f=>(!f.ctrlKey||f.type==="wheel")&&!f.button&&!(f.type==="mousedown"&&f.button===2)).wheelDelta(f=>-f.deltaY*.002))),tt(r(m)).call(r(u)).on("dblclick.zoom",null))},N=f=>{if(!r(m)||!r(u))return;const t=f?1.5:.75;tt(r(m)).transition().duration(300).call(r(u).scaleBy,t)},Y=()=>{!r(m)||!r(u)||tt(r(m)).transition().duration(300).call(r(u).transform,Ct)};Kt(()=>{V()}),At(()=>{r(A).k,De(".unscaled").each(function(){Xe(this,r(y))})});var H=qe(),R=w(H);Ue(R,{get scale(){return r(E)},onZoomIn:()=>N(!0),onZoomOut:()=>N(!1),onZoomReset:Y});var C=P(R,2),B=w(C),X=w(B),z=P(X);let F;mt(z,21,()=>r(D),f=>f.annotation_id,(f,t)=>{xe(f,{get annotation(){return r(t)},get showLabel(){return r(h)},get imageWidth(){return e.imageWidth}})}),x(z),x(B),x(C),Wt(C,f=>J(m,f),()=>r(m));var G=P(C,2);ft(G,"viewBox","0 0 1024 768"),Wt(G,f=>J(y,f),()=>r(y)),x(H),et(f=>{ft(C,"viewBox",`${r(O).x} ${r(O).y} ${r(O).width} ${r(O).height}`),ft(B,"transform",`translate(${r(A).x}, ${r(A).y}) scale(${r(A).k})`),ft(X,"href",e.imageURL),F=wt(z,0,"svelte-10ogmpt",null,F,f)},[()=>({"annotations-hidden":b()})]),I(n,H),it(),l()}var Qe=Z('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1),Je=Z('<div class="flex flex-col gap-4"><!> <div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div></div>'),$e=Z("<div> </div>"),tn=Z('<div class="flex gap-1"></div>'),en=Z('<div class="flex items-center justify-between gap-2 rounded-sm bg-card px-5 py-2"><div class="text-sm"> </div> <div class="text-sm"> </div></div>'),nn=Z('<div class="flex flex-col gap-2"></div>'),an=Z('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1),on=Z('<div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div>'),sn=Z('<div class="flex-none"><div class="mb-2.5 text-lg font-semibold">Sample details</div> <!></div> <div class="flex h-full min-h-0 flex-col space-y-2 overflow-y-auto dark:[color-scheme:dark]"><!> <!> <!> <!></div>',1);function rn(n,e){ot(e,!0);const[o,l]=Vt(),g=()=>ct(p,"$taskMap",o),{taskMap:p}=se(),h=e.sample.tags,m=K(()=>we(e.sample.annotations)),y=K(()=>e.selectedAnnotation&&e.selectedAnnotation.annotation_task_id&&g().has(e.selectedAnnotation.annotation_task_id)?g().get(e.selectedAnnotation.annotation_task_id).is_prediction:!1),b=K(()=>[{label:"Height:",value:yt(e.sample.height)+"px"},{label:"Width:",value:yt(e.sample.width)+"px"},{label:"Filename:",value:e.sample.file_name},{label:"Filepath:",value:e.sample.file_path_abs}]),S=K(()=>e.selectedAnnotation?[{label:"Height:",value:yt(Math.round(e.selectedAnnotation.height))+"px"},{label:"Width:",value:yt(Math.round(e.selectedAnnotation.width))+"px"},{label:"Annotation:",value:e.selectedAnnotation.annotation_label.annotation_label_name},{label:"Type:",value:"Bounding box"},{label:"Status:",value:r(y)?"Prediction":"Ground Truth"}]:[]);Jt(n,{className:"h-full",children:(L,D)=>{$t(L,{className:"h-full flex flex-col",children:(T,O)=>{var A=sn(),E=ut(A),u=P(w(E),2);Qt(u,{class:"mb-4 bg-border-hard"}),x(E);var V=P(E,2),N=w(V);{var Y=z=>{_t(z,{title:"Selected annotation",children:(F,G)=>{var f=Je(),t=w(f);be(t,{name:"show-all",label:"Show only selected annotation",get isChecked(){return e.showOnlySelectedAnnotation},helperText:"Hides other annotations for clarity.",get onCheckedChange(){return e.toggleShowOnlySelectedAnnotation}});var i=P(t,2);mt(i,21,()=>r(S),({label:a,value:s})=>a,(a,s)=>{let d=()=>r(s).label,v=()=>r(s).value;var c=Qe(),_=ut(c),M=w(_,!0);x(_);var W=P(_,2),k=w(W,!0);x(W),et(()=>{at(M,d()),at(k,v())}),I(a,c)}),x(i),x(f),I(F,f)}})};vt(N,z=>{e.selectedAnnotation&&z(Y)})}var H=P(N,2);{var R=z=>{_t(z,{title:"Tags",icon:ve,children:(F,G)=>{var f=tn();mt(f,21,()=>h,Bt,(t,i)=>{var a=$e(),s=w(a,!0);x(a),et(d=>{wt(a,1,d),at(s,r(i).name)},[()=>It(Dt("inline rounded-lg bg-card px-2 py-2 text-xs"))]),I(t,a)}),x(f),I(F,f)}})};vt(H,z=>{h.length>0&&z(R)})}var C=P(H,2);{var B=z=>{_t(z,{title:"Annotations",children:(F,G)=>{var f=nn();mt(f,21,()=>r(m),Bt,(t,i)=>{var a=en(),s=w(a),d=w(s,!0);x(s);var v=P(s,2),c=w(v);x(v),x(a),et(_=>{at(d,r(i)[0]),re(v,`color: ${_??""};`),at(c,`(${r(i)[1]??""})`)},[()=>ye(r(i)[0]).color]),I(t,a)}),x(f),I(F,f)}})};vt(C,z=>{r(m).size>0&&z(B)})}var X=P(C,2);_t(X,{title:"Metadata",children:(z,F)=>{var G=on();mt(G,21,()=>r(b),({label:f,value:t})=>f,(f,t)=>{let i=()=>r(t).label,a=()=>r(t).value;var s=an(),d=ut(s),v=w(d,!0);x(d);var c=P(d,2),_=w(c,!0);x(c),et(()=>{at(v,i()),at(_,a())}),I(f,s)}),x(G),I(z,G)}}),x(V),I(T,A)},$$slots:{default:!0}})},$$slots:{default:!0}}),it(),l()}const ln=async({sample_id:n})=>{const e={data:void 0,error:void 0};try{const o=await Ft.GET("/api/samples/{sample_id}",{params:{path:{sample_id:n}}});if(o.error)throw new Error(JSON.stringify(o.error,null,2));if(!o.data)throw new Error("No data");e.data=o.data}catch(o){e.error="Error loading sample: "+String(o)}return e},cn=async({sample_id:n,body:e})=>{const o={data:void 0,error:void 0};try{const l=await Ft.POST("/api/samples/{sample_id}/adjacent",{params:{path:{sample_id:n}},body:e});if(l.error)throw new Error(JSON.stringify(l.error,null,2));if(!l.data)throw new Error("No data");o.data=l.data}catch(l){o.error="Error loading sample adjacents: "+String(l)}return o},un=async({params:n,url:e})=>{var T,O,A,E;const{sample_id:o}=n,{data:l,error:g}=await ln({sample_id:o}),{selectedAnnotationFilterIds:p,textEmbedding:h}=Ut(),{dimensionsValues:m}=le(),{tagsSelected:y}=ce({dataset_id:l==null?void 0:l.dataset_id,kind:["sample"]}),b=st(h),{data:S,error:L}=await cn({sample_id:o,body:{filters:{annotation_labels_ids:Array.from(st(p)),tag_ids:Array.from(st(y)),width:{min:(T=st(m))==null?void 0:T.min_width,max:(O=st(m))==null?void 0:O.max_width},height:{min:(A=st(m))==null?void 0:A.min_height,max:(E=st(m))==null?void 0:E.max_height}},text_embedding:b==null?void 0:b.embedding}});return{sample:l,annotationId:e.searchParams.get("annotationId"),error:g||L,sampleAdjacents:S}},Mn=Object.freeze(Object.defineProperty({__proto__:null,load:un},Symbol.toStringTag,{value:"Module"}));var dn=Z("<a>Go home</a>"),hn=Z('<div class="flex h-full w-full space-x-4 px-4 pb-4"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function An(n,e){ot(e,!0);const o=ue(),[l,g]=o;var p=hn(),h=w(p),m=w(h);{var y=S=>{Pe(S,{get sample(){return e.data.sample}})},b=S=>{ge(S,{title:"Sample not found",children:(L,D)=>{var T=dn();et(O=>ft(T,"href",O),[()=>l("/",void 0)]),I(L,T)}})};vt(m,S=>{e.data.sample?S(y):S(b,!1)})}x(h),x(p),I(n,p),it()}export{An as component,Mn as universal};
