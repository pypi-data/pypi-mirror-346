import{n as ye,a as h,t as I,r as Fe,c as $}from"../chunks/CYqQTk2G.js";import{p as ie,d as y,c as B,r as He,a as j,i as ee,b as je}from"../chunks/ljGkMZWX.js";import{P as Ae,c as Ie}from"../chunks/BBLiiV7J.js";import{e as ze,k as Le,c as L,j as ke,g as ne,l as Ee,a as Me,d as We,f as Ge,h as Re,i as Oe,b as Pe}from"../chunks/BQEJVgPf.js";import"../chunks/DvURYSWS.js";import{p as N,c as k,j as t,r as A,t as C,a as D,y as oe,v as u,q as x,z as Te,e as te,f as ae,l as q,s as se}from"../chunks/Cj1lW-Gn.js";import{r as Ve}from"../chunks/Cbydd1_z.js";import{G as qe}from"../chunks/BTrFHCUX.js";import{a as Be}from"../chunks/eiVfNh6z.js";import{S as Ne}from"../chunks/D-YNTJ6i.js";import{a as Ce}from"../chunks/CD_eMhOw.js";var De=ye('<svg style="position: absolute; top: 0; left: 0;"><g></g></svg>');function Ue(v,e){N(e,!0);const[i,f]=B(),r=()=>y(m,"$isHidden",i),c=ie(e,"sampleImageObjectFit",3,"contain"),{isHidden:m}=Be();var a=De(),n=k(a);let l;ze(n,21,()=>e.sample.annotations,Le,(s,p)=>{Ne(s,{get annotation(){return t(p)},get showLabel(){return e.showLabel},get imageWidth(){return e.sample.width}})}),A(n),A(a),C(s=>{L(a,"viewBox",`0 0 ${e.sample.width} ${e.sample.height}`),L(a,"preserveAspectRatio",c()==="contain"?"xMidYMid meet":"xMidYMid slice"),L(a,"width",e.containerWidth),L(a,"height",e.containerHeight),l=ke(n,0,"svelte-10ogmpt",null,l,s)},[()=>({"annotations-hidden":r()})]),h(v,a),D(),f()}var Ye=I("<img>");function Je(v,e){N(e,!0);const i=ie(e,"objectFit",3,"contain"),f=He(e,["$$slots","$$events","$$legacy","sample","objectFit"]),{class:r,...c}=f,{getDatasetVersion:m}=ne();let a=x("");oe(async()=>{var s;(s=e.sample)!=null&&s.dataset_id&&u(a,j(await m(e.sample.dataset_id)))});var n=Ye();let l;C(s=>l=Me(n,l,{src:`${Ae}${e.sample.file_path_abs}${t(a)?`?v=${t(a)}`:""}`,alt:e.sample.file_path_abs,class:s,decoding:"async",style:`--object-fit: ${i()??""}`,loading:"lazy",...c},"svelte-1c6bz0a"),[()=>Ee("sample-image rounded-lg bg-black",r)]),Fe(n),h(v,n),D()}const Ke=async({dataset_id:v,offset:e=0,limit:i=10,annotationLabels:f,tagIds:r,min_width:c,max_width:m,min_height:a,max_height:n,textEmbedding:l=[]})=>{const s={data:[],error:void 0};try{const p=c!==void 0?{min_width:c,max_width:m,min_height:a,max_height:n}:{},H=await Ie.GET("/api/samples",{params:{query:{dataset_id:v,offset:e,limit:i,annotation_labels:f,tag_ids:r,text_embedding:l,...p}}});if(H.error)throw new Error(JSON.stringify(H.error,null,2));if(!H.data)throw new Error("No data");s.data=H.data}catch(p){s.error="Error loading samples: "+String(p)}return s};var Qe=I('<div class="relative"><div class="absolute right-7 top-1 z-10"><!></div> <a class="block"><!> <!></a></div>'),Xe=I('<div slot="noMore"></div>'),Ze=I('<div slot="noResults"></div>'),$e=I('<div class="viewport flex-1 svelte-gzepom"><!></div>'),et=I('<div class="flex h-full w-full items-center justify-center"><div>Loading...</div></div>');function tt(v,e){N(e,!0);const[i,f]=B(),r=()=>y(H,"$infiniteLoaderIdentifier",i),c=()=>y(e.dimensions,"$dimensions",i),m=()=>y(e.selectedAnnotationFilter,"$selectedAnnotationFilter",i),a=()=>y(p,"$tagsSelected",i),n=()=>y(e.textEmbedding,"$textEmbedding",i),l=()=>y(re,"$selectedSampleIds",i),{getGridViewSampleRendering:s}=We(),{tagsSelected:p}=Ge({dataset_id:e.dataset_id,kind:["sample"]});let H=Te([e.selectedAnnotationFilter,p,e.dimensions,e.textEmbedding],([o,d,b,S])=>o.join(",")+Array.from(d).join(",")+b.min_width+b.max_width+b.min_height+b.max_height+(S?S.queryText:"")),E=x(0);const W=100;let _=x(j([])),F=x(null),U=x(!0),Y=x(!1);const{selectedSampleIds:re,toggleSampleSelection:le,getDatasetVersion:de}=ne();let G=x("cover"),R=x(0);oe(async()=>{await de(e.dataset_id),u(G,j(s)),u(Y,!0)}),te(()=>{r(),u(_,j([])),u(E,0)}),te(()=>{if(!t(F))return;u(R,j(t(F).clientHeight));const o=new ResizeObserver(()=>{t(F)&&u(R,j(t(F).clientHeight))});return o.observe(t(F)),()=>{o.disconnect()}});async function ce({detail:{loaded:o,complete:d}}){const b=t(U)?void 0:c(),S=await Ke({dataset_id:e.dataset_id,limit:W,offset:t(E),annotationLabels:m().length>0?m():void 0,tagIds:a().size>0?Array.from(a()):void 0,textEmbedding:n()?n().embedding:void 0,...b});S.data.length?(u(E,t(E)+W),t(_).push(...S.data),u(U,!1),S.data.length<W?d():o()):d()}const J=16,me=Re(),[ge,at]=me;var K=$(),ue=ae(K);{var ve=o=>{var d=$e(),b=k(d);const S=q(()=>e.sampleHeight+J),_e=q(()=>e.sampleWidth+J);qe(b,{get itemCount(){return t(_).length},get itemHeight(){return t(S)},get itemWidth(){return t(_e)},get height(){return t(R)},class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${e.sampleWidth??""}px; --sample-height: ${e.sampleHeight??""}px;`},overScan:100,item:(O,g)=>{let w=()=>g==null?void 0:g().index,z=()=>g==null?void 0:g().style;var X=$(),he=ae(X);{var pe=P=>{var M=Qe(),T=k(M),be=k(T);const Se=q(()=>l().has(t(_)[w()].sample_id));Ce(be,{onSelect:()=>le(t(_)[w()].sample_id),get isSelected(){return t(Se)}}),A(T);var V=se(T,2),Z=k(V);Je(Z,{get sample(){return t(_)[w()]},get objectFit(){return t(G)}});var we=se(Z,2);Ue(we,{get sample(){return t(_)[w()]},get containerWidth(){return e.sampleWidth},get sampleImageObjectFit(){return t(G)},get containerHeight(){return e.sampleHeight}}),A(V),A(M),C(xe=>{Pe(M,z()),L(V,"href",xe)},[()=>ge(Ve.toSample(t(_)[w()].sample_id),void 0)]),h(P,M)};ee(he,P=>{t(_)[w()]&&P(pe)})}h(O,X)},footer:O=>{Oe(O,{get identifier(){return r()},$$events:{infinite:ce},$$slots:{noMore:(g,w)=>{var z=Xe();h(g,z)},noResults:(g,w)=>{var z=Ze();h(g,z)}}})},$$slots:{item:!0,footer:!0}}),A(d),je(d,Q=>u(F,Q),()=>t(F)),h(o,d)},fe=o=>{var d=et();h(o,d)};ee(ue,o=>{t(Y)?o(ve):o(fe,!1)})}h(v,K),D(),f()}function ft(v,e){const[i,f]=B(),r=()=>y(s,"$boundedSampleSize",i),{datasetId:c,sampleSize:m,dimensions:a,selectedAnnotationFilter:n,globalStorage:{textEmbedding:l}}=e.data,s=m.sampleSize;tt(v,{get sampleHeight(){return r().height},get sampleWidth(){return r().width},textEmbedding:l,dataset_id:c,selectedAnnotationFilter:n,dimensions:a}),f()}export{ft as component};
