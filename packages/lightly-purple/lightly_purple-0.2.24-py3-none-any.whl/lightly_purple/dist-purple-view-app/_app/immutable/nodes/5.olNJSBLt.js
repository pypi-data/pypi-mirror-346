import{n as Fe,a as h,t as I,r as He,c as ee}from"../chunks/CYNiB6_4.js";import{p as ie,d as p,c as N,r as Ae,a as H,i as te,b as je}from"../chunks/C1afDGGf.js";import{e as Ie,k as ke,c as L,j as Le,g as ne,l as ze,a as Ee,d as Re,f as Me,m as We,h as Oe,i as Pe,b as Ve}from"../chunks/D41Hqwbn.js";import{P as Ge,c as Te,r as Be}from"../chunks/CRLA7a-5.js";import"../chunks/CYcGrRWH.js";import{p as q,c as z,g as t,r as j,t as C,a as U,A as oe,k as f,i as A,m as De,j as B,f as ae,d as D,s as se}from"../chunks/DpVHSmmX.js";import{G as Ne}from"../chunks/DU3q3_UE.js";import{a as qe}from"../chunks/DRUjRZBg.js";import{S as Ce}from"../chunks/TBjp0rJk.js";import{a as Ue}from"../chunks/DvTsDW6x.js";var Ye=Fe('<svg style="position: absolute; top: 0; left: 0;"><g></g></svg>');function Je(g,e){q(e,!0);const[s,u]=N(),r=()=>p(v,"$isHidden",s),l=ie(e,"sampleImageObjectFit",3,"contain"),{isHidden:v}=qe();var a=Ye(),i=z(a);let c;Ie(i,21,()=>e.sample.annotations,ke,(n,x)=>{Ce(n,{get annotation(){return t(x)},get showLabel(){return e.showLabel},get imageWidth(){return e.sample.width}})}),j(i),j(a),C(n=>{L(a,"viewBox",`0 0 ${e.sample.width} ${e.sample.height}`),L(a,"preserveAspectRatio",l()==="contain"?"xMidYMid meet":"xMidYMid slice"),L(a,"width",e.containerWidth),L(a,"height",e.containerHeight),c=Le(i,0,"svelte-10ogmpt",null,c,n)},[()=>({"annotations-hidden":r()})]),h(g,a),U(),u()}var Ke=I("<img>");function Qe(g,e){q(e,!0);const s=ie(e,"objectFit",3,"contain"),u=Ae(e,["$$slots","$$events","$$legacy","sample","objectFit"]),{class:r,...l}=u,{getDatasetVersion:v}=ne();let a=A("");oe(async()=>{var n;(n=e.sample)!=null&&n.dataset_id&&f(a,H(await v(e.sample.dataset_id)))});var i=Ke();let c;C(n=>c=Ee(i,c,{src:`${Ge}${e.sample.file_path_abs}${t(a)?`?v=${t(a)}`:""}`,alt:e.sample.file_path_abs,class:n,decoding:"async",style:`--object-fit: ${s()??""}`,loading:"lazy",...l},"svelte-1c6bz0a"),[()=>ze("sample-image rounded-lg bg-black",r)]),He(i),h(g,i),U()}const Xe=async({dataset_id:g,offset:e=0,limit:s=10,annotationLabels:u,tagIds:r,min_width:l,max_width:v,min_height:a,max_height:i,textEmbedding:c=[]})=>{const n={data:[],error:void 0};try{const x=l!==void 0?{min_width:l,max_width:v,min_height:a,max_height:i}:{},y=await Te.POST("/api/samples/list",{params:{query:{dataset_id:g,offset:e,limit:s,annotation_labels:u,tag_ids:r,...x}},body:{text_embedding:c}});if(y.error)throw new Error(JSON.stringify(y.error,null,2));if(!y.data)throw new Error("No data");n.data=y.data}catch(x){n.error="Error loading samples: "+String(x)}return n};var Ze=I('<div class="relative"><div class="absolute right-7 top-1 z-10"><!></div> <a class="block"><!> <!></a></div>'),$e=I('<div slot="noMore"></div>'),et=I('<div slot="noResults"></div>'),tt=I('<div class="viewport flex-1 svelte-gzepom"><!></div>'),at=I('<div class="flex h-full w-full items-center justify-center"><div>Loading...</div></div>');function st(g,e){q(e,!0);const[s,u]=N(),r=()=>p(x,"$gridViewSampleRenderingStore",s),l=()=>p(re,"$infiniteLoaderIdentifier",s),v=()=>p(Y,"$dimensions",s),a=()=>p(e.selectedAnnotationFilter,"$selectedAnnotationFilter",s),i=()=>p(y,"$tagsSelected",s),c=()=>p(e.textEmbedding,"$textEmbedding",s),n=()=>p(le,"$selectedSampleIds",s),{gridViewSampleRenderingStore:x}=Re(),{tagsSelected:y}=Me({dataset_id:e.dataset_id,kind:["sample"]}),{dimensionsValues:Y}=We();let re=De([e.selectedAnnotationFilter,y,Y,e.textEmbedding],([o,d,b,S])=>o.join(",")+Array.from(d).join(",")+b.min_width+b.max_width+b.min_height+b.max_height+(S?S.queryText:"")),E=A(0);const M=100;let _=A(H([])),F=A(null),J=A(!1);const{selectedSampleIds:le,toggleSampleSelection:de,getDatasetVersion:ce}=ne();let W=A(H(r())),O=A(0);oe(async()=>{await ce(e.dataset_id),f(J,!0)}),B(()=>{f(W,H(r()))}),B(()=>{l(),f(_,H([])),f(E,0)}),B(()=>{if(!t(F))return;f(O,H(t(F).clientHeight));const o=new ResizeObserver(()=>{t(F)&&f(O,H(t(F).clientHeight))});return o.observe(t(F)),()=>{o.disconnect()}});async function me({detail:{loaded:o,complete:d}}){const b=v(),S=await Xe({dataset_id:e.dataset_id,limit:M,offset:t(E),annotationLabels:a().length>0?a():void 0,tagIds:i().size>0?Array.from(i()):void 0,textEmbedding:c()?c().embedding:void 0,...b});S.data.length?(f(E,t(E)+M),t(_).push(...S.data),S.data.length<M?d():o()):d()}const K=16,ge=Oe(),[ue,it]=ge;var Q=ee(),ve=ae(Q);{var _e=o=>{var d=tt(),b=z(d);const S=D(()=>e.sampleHeight+K),he=D(()=>e.sampleWidth+K);Ne(b,{get itemCount(){return t(_).length},get itemHeight(){return t(S)},get itemWidth(){return t(he)},get height(){return t(O)},class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${e.sampleWidth??""}px; --sample-height: ${e.sampleHeight??""}px;`},overScan:100,item:(P,m)=>{let w=()=>m==null?void 0:m().index,k=()=>m==null?void 0:m().style;var Z=ee(),pe=ae(Z);{var be=V=>{var R=Ze(),G=z(R),Se=z(G);const we=D(()=>n().has(t(_)[w()].sample_id));Ue(Se,{onSelect:()=>de(t(_)[w()].sample_id),get isSelected(){return t(we)}}),j(G);var T=se(G,2),$=z(T);Qe($,{get sample(){return t(_)[w()]},get objectFit(){return t(W)}});var xe=se($,2);Je(xe,{get sample(){return t(_)[w()]},get containerWidth(){return e.sampleWidth},get sampleImageObjectFit(){return t(W)},get containerHeight(){return e.sampleHeight}}),j(T),j(R),C(ye=>{Ve(R,k()),L(T,"href",ye)},[()=>ue(Be.toSample(t(_)[w()].sample_id),void 0)]),h(V,R)};te(pe,V=>{t(_)[w()]&&V(be)})}h(P,Z)},footer:P=>{Pe(P,{get identifier(){return l()},$$events:{infinite:me},$$slots:{noMore:(m,w)=>{var k=$e();h(m,k)},noResults:(m,w)=>{var k=et();h(m,k)}}})},$$slots:{item:!0,footer:!0}}),j(d),je(d,X=>f(F,X),()=>t(F)),h(o,d)},fe=o=>{var d=at();h(o,d)};te(ve,o=>{t(J)?o(_e):o(fe,!1)})}h(g,Q),U(),u()}function ft(g,e){const[s,u]=N(),r=()=>p(v,"$sampleSize",s),{datasetId:l,sampleSize:v,selectedAnnotationFilter:a,globalStorage:{textEmbedding:i}}=e.data;st(g,{get sampleHeight(){return r().height},get sampleWidth(){return r().width},textEmbedding:i,dataset_id:l,selectedAnnotationFilter:a}),u()}export{ft as component};
