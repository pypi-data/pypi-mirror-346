var Gt=r=>{throw TypeError(r)};var Tt=(r,e,t)=>e.has(r)||Gt("Cannot "+t);var S=(r,e,t)=>(Tt(r,e,"read from private field"),t?t.call(r):e.get(r)),Je=(r,e,t)=>e.has(r)?Gt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),dt=(r,e,t,n)=>(Tt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),st=(r,e,t)=>(Tt(r,e,"access private method"),t);import{I as it,s as Le,R as Ct,n as ca,U as ua,o as Rt,a as mt,p as va,J as Ye,l as Ge,V as Nt,f as Kt,u as fa,e as nt,k as _t,_ as ga,C as ha,W as ma,b as pa,c as _a,X as $a,Y as xa,Z as ya,$ as ba,a0 as wa,a1 as Bt,a2 as Sa,a3 as Ht,g as Zt,a4 as Pa,d as ka,a5 as Ta}from"../chunks/BQEJVgPf.js";import{p as R,a as B,f as $,n as Re,H as Et,j as a,v as I,l as k,c as f,r as c,t as W,s as v,A as Z,q as Ne,aE as Jt,x as Xe,z as Ca,w as ot,aF as ea,y as ta,aD as aa,aC as It,e as Ea}from"../chunks/Cj1lW-Gn.js";import{c as et,a as Ia}from"../chunks/BBLiiV7J.js";import{r as vt}from"../chunks/Cbydd1_z.js";import{r as Aa}from"../chunks/B90CZVMX.js";import{c as A,a as o,t as w,s as V,b as Ce}from"../chunks/CYqQTk2G.js";import{s as qe,r as be,p as Ie,i as Ee,d as ie,c as ft,e as M,a as ye,b as yt}from"../chunks/ljGkMZWX.js";import{p as bt}from"../chunks/342KIpWk.js";import{g as $t,u as Fa,a as Ma}from"../chunks/eiVfNh6z.js";import{S as jt,a as Pt,f as ct,A as Oa,T as za}from"../chunks/BeFiKZji.js";import"../chunks/DvURYSWS.js";import{p as Da}from"../chunks/OoM2i83e.js";import{u as Na,F as At,S as Ft,a as Mt,G as Ot,b as zt,R as Dt,c as La,D as qa,d as Ka,e as ja,s as Ga,h as Vt,g as Ra,n as ra,f as Ba}from"../chunks/D3o6BS6S.js";import{L as Ha,a as sa}from"../chunks/IZXhtOqv.js";function na(r,e){R(e,!0);let t=be(e,["$$slots","$$events","$$legacy"]);it(r,qe({name:"image"},()=>t,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(s,i)=>{var l=A(),d=$(l);Le(d,()=>e.children??Re),o(s,l)},$$slots:{default:!0}})),B()}function Ja(r,e){R(e,!0);let t=be(e,["$$slots","$$events","$$legacy"]);it(r,qe({name:"component"},()=>t,{iconNode:[["path",{d:"M15.536 11.293a1 1 0 0 0 0 1.414l2.376 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z"}],["path",{d:"M2.297 11.293a1 1 0 0 0 0 1.414l2.377 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414L6.088 8.916a1 1 0 0 0-1.414 0z"}],["path",{d:"M8.916 17.912a1 1 0 0 0 0 1.415l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.415l-2.377-2.376a1 1 0 0 0-1.414 0z"}],["path",{d:"M8.916 4.674a1 1 0 0 0 0 1.414l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z"}]],children:(s,i)=>{var l=A(),d=$(l);Le(d,()=>e.children??Re),o(s,l)},$$slots:{default:!0}})),B()}var Va=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Wa=["difference","intersection","symmetricDifference","union"],Wt=!1,ut,je,tt,wt,oa;const St=class St extends Set{constructor(t){super();Je(this,wt);Je(this,ut,new Map);Je(this,je,Et(0));Je(this,tt,Et(0));if(t){for(var n of t)super.add(n);S(this,tt).v=super.size}Wt||st(this,wt,oa).call(this)}has(t){var n=super.has(t),s=S(this,ut),i=s.get(t);if(i===void 0){if(!n)return a(S(this,je)),!1;i=Et(!0),s.set(t,i)}return a(i),n}add(t){return super.has(t)||(super.add(t),I(S(this,tt),super.size),Ct(S(this,je))),this}delete(t){var n=super.delete(t),s=S(this,ut),i=s.get(t);return i!==void 0&&(s.delete(t),I(i,!1)),n&&(I(S(this,tt),super.size),Ct(S(this,je))),n}clear(){if(super.size!==0){super.clear();var t=S(this,ut);for(var n of t.values())I(n,!1);t.clear(),I(S(this,tt),0),Ct(S(this,je))}}keys(){return this.values()}values(){return a(S(this,je)),super.values()}entries(){return a(S(this,je)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return a(S(this,tt))}};ut=new WeakMap,je=new WeakMap,tt=new WeakMap,wt=new WeakSet,oa=function(){Wt=!0;var t=St.prototype,n=Set.prototype;for(const s of Va)t[s]=function(...i){return a(S(this,je)),n[s].apply(this,i)};for(const s of Wa)t[s]=function(...i){a(S(this,je));var l=n[s].apply(this,i);return new St(l)}};let Lt=St;var Ua=w("<div><!></div>");function Qa(r,e){R(e,!0);let t=Ie(e,"id",19,ca),n=Ie(e,"ref",15,null),s=be(e,["$$slots","$$events","$$legacy","id","children","child","ref"]);const i=ua({id:Rt.with(()=>t()),ref:Rt.with(()=>n(),g=>n(g))}),l=k(()=>va(s,i.props));var d=A(),m=$(d);{var h=g=>{var C=A(),p=$(C);Le(p,()=>e.child,()=>({props:a(l)})),o(g,C)},y=g=>{var C=Ua();let p;var P=f(C);Le(P,()=>e.children??Re),c(C),W(()=>p=mt(C,p,{...a(l)})),o(g,C)};Ee(m,g=>{e.child?g(h):g(y,!1)})}o(r,d),B()}var Xa=w("<!> Samples",1),Ya=w("<!> Annotations",1),Za=w('<div class="mb-5 mt-2 text-lg font-semibold">Collections</div> <!> <div class="flex space-x-2"><!> <!></div>',1);function er(r,e){R(e,!0);var t=Za(),n=v($(t),2);jt(n,{class:"mb-4 bg-border-hard"});var s=v(n,2),i=f(s);const l=k(()=>Ge("flex-1","px-2",e.gridType=="samples"&&"inline-flex rounded-md bg-muted")),d=k(()=>vt.toSamples(e.datasetId));Ye(i,{variant:"ghost",get class(){return a(l)},get href(){return a(d)},"data-sveltekit-noscroll":!0,children:(g,C)=>{var p=Xa(),P=$(p);na(P,{class:"size-4"}),Z(),o(g,p)},$$slots:{default:!0}});var m=v(i,2);const h=k(()=>Ge("flex-1","px-2",e.gridType=="annotations"&&"inline-flex rounded-md bg-muted")),y=k(()=>vt.toAnnotations(e.datasetId));Ye(m,{get class(){return a(h)},variant:"ghost",get href(){return a(y)},"data-sveltekit-noscroll":!0,children:(g,C)=>{var p=Ya(),P=$(p);Ja(P,{class:"size-4"}),Z(),o(g,p)},$$slots:{default:!0}}),c(s),o(r,t),B()}var tr=w('<div class="space-y-4"><div class="space-y-1"><h2 class="text-md">Width Filter</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <div class="space-y-1"><h2 class="text-md">Height Filter</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div></div>');function ar(r,e){R(e,!0);const[t,n]=ft(),s=()=>ie(e.dimensions,"$dimensions",t),{min_width:i,max_width:l,min_height:d,max_height:m}=s(),h=g=>{e.onChange({min_width:g[0],max_width:g[1],min_height:d,max_height:m})},y=g=>{e.onChange({min_width:i,max_width:l,min_height:g[0],max_height:g[1]})};Pt(r,{title:"Metadata",children:(g,C)=>{var p=tr(),P=f(p),u=v(f(P),2),_=f(u),x=f(_);c(_);var T=v(_,2),O=f(T);c(T),c(u);var F=v(u,2),L=f(F);Nt(L,{type:"multiple",class:"filter-width",min:i,max:l,value:[i,l],onValueChange:h}),c(F),c(P);var ee=v(P,2),we=v(f(ee),2),pe=f(we),E=f(pe);c(pe);var te=v(pe,2),_e=f(te);c(te),c(we);var Ae=v(we,2),Ve=f(Ae);Nt(Ve,{type:"multiple",class:"filter-height",min:d,max:m,value:[d,m],onValueChange:y}),c(Ae),c(ee),c(p),W((We,Fe,le,ve)=>{V(x,`${We??""}px`),V(O,`${Fe??""}px`),V(E,`${le??""}px`),V(_e,`${ve??""}px`)},[()=>ct(s().min_width),()=>ct(s().max_width),()=>ct(s().min_height),()=>ct(s().max_height)]),o(g,p)},$$slots:{default:!0}}),B(),n()}function rr(r,e){R(e,!0);let t=be(e,["$$slots","$$events","$$legacy"]);it(r,qe({name:"eraser"},()=>t,{iconNode:[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]],children:(s,i)=>{var l=A(),d=$(l);Le(d,()=>e.children??Re),o(s,l)},$$slots:{default:!0}})),B()}function sr(r,e){R(e,!0);let t=be(e,["$$slots","$$events","$$legacy"]);it(r,qe({name:"grid-3x3"},()=>t,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M3 9h18"}],["path",{d:"M3 15h18"}],["path",{d:"M9 3v18"}],["path",{d:"M15 3v18"}]],children:(s,i)=>{var l=A(),d=$(l);Le(d,()=>e.children??Re),o(s,l)},$$slots:{default:!0}})),B()}function nr(r,e){R(e,!0);let t=be(e,["$$slots","$$events","$$legacy"]);it(r,qe({name:"plus"},()=>t,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(s,i)=>{var l=A(),d=$(l);Le(d,()=>e.children??Re),o(s,l)},$$slots:{default:!0}})),B()}function or(r,e){R(e,!0);let t=be(e,["$$slots","$$events","$$legacy"]);it(r,qe({name:"search"},()=>t,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(s,i)=>{var l=A(),d=$(l);Le(d,()=>e.children??Re),o(s,l)},$$slots:{default:!0}})),B()}function ir(r,e){R(e,!0);let t=be(e,["$$slots","$$events","$$legacy"]);it(r,qe({name:"sliders-horizontal"},()=>t,{iconNode:[["line",{x1:"21",x2:"14",y1:"4",y2:"4"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22"}]],children:(s,i)=>{var l=A(),d=$(l);Le(d,()=>e.children??Re),o(s,l)},$$slots:{default:!0}})),B()}const lr=async r=>{const e={data:{},error:void 0};try{const t=await et.POST("/api/metrics/compute/detection/map",{body:r});if(t.error)throw new Error(JSON.stringify(t.error,null,2));if(!t.data)throw new Error("No data returned from metrics calculation");e.data=t.data}catch(t){e.error="Error computing metrics: "+String(t)}return e};var dr=w("<!> <!>",1),cr=w("<!> <!>",1),ur=w("<!> <!>",1),vr=w("<!> <!>",1),fr=w('<div class="rounded-md bg-destructive/15 p-3 text-sm text-destructive"> </div>'),gr=w('<span class="mr-2 animate-spin">‚ü≥</span>'),hr=w("<!> Compute",1),mr=w('<div class="space-y-6"><!> <!> <!> <!> <div class="flex space-x-2"><!> <!></div></div>'),pr=w('<div class="flex justify-between"><span class="truncate"> </span> <span class="font-medium"> </span></div>'),_r=w('<div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP by Class</h4> <div class="max-h-60 space-y-1 overflow-y-auto text-sm"></div></div>'),$r=w('<div class="space-y-4"><div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP Results</h4> <div class="space-y-2 text-sm"><div class="flex justify-between"><span>mAP:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@50:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@75:</span> <span class="font-medium"> </span></div></div></div> <!> <!></div>'),xr=w('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 text-lg font-semibold">Metrics</div> <!> <div class="flex-1 space-y-6"><!></div></div>'),yr=w('<div class="hidden"></div>');function br(r,e){R(e,!0);const[t,n]=ft(),s=()=>ie(C,"$isMetricsPanelOpen",t),i=()=>ie(g,"$hasEnoughTasksForMetrics",t),l=()=>ie(y,"$annotationTasks",t),d=()=>ie(h,"$tags",t);let m=Da.params.dataset_id;const{tags:h}=Kt({dataset_id:m}),{annotationTasks:y,hasEnoughTasksForMetrics:g}=fa(),{isMetricsPanelOpen:C}=Na();let p=Ne(""),P=Ne(""),u=Ne(""),_=Ne(null),x=Ne(!1),T=Ne("");async function O(){if(!a(p)||!a(P)){I(T,"Please select both ground truth and prediction tasks");return}I(x,!0),I(T,"");try{const E=await lr({dataset_id:m,ground_truth_task_id:a(p),prediction_task_id:a(P),tag_id:a(u)||null});E.error?I(T,ye(E.error)):I(_,ye(E.data))}catch(E){I(T,ye(String(E)))}finally{I(x,!1)}}function F(){I(p,""),I(P,""),I(u,""),I(_,null),I(T,"")}var L=A(),ee=$(L);{var we=E=>{var te=xr(),_e=v(f(te),2);jt(_e,{class:"mb-4 bg-border-hard"});var Ae=v(_e,2),Ve=f(Ae);{var We=le=>{var ve=mr(),Se=f(ve);At(Se,{label:"Ground Truth Task",children:(z,re)=>{var H=A(),q=$(H);M(q,()=>Dt,(se,D)=>{D(se,{type:"single",name:"groundTruthTaskId",get value(){return a(p)},set value(N){I(p,ye(N))},children:(N,ge)=>{var ne=dr(),U=$(ne);M(U,()=>Ft,(de,ce)=>{ce(de,{class:"w-full",children:(Q,He)=>{Z();var J=Ce();W(j=>V(J,j),[()=>{var j;return((j=l().find($e=>$e.annotation_task_id===a(p)))==null?void 0:j.name)||"Select ground truth task"}]),o(Q,J)},$$slots:{default:!0}})});var Ue=v(U,2);M(Ue,()=>Mt,(de,ce)=>{ce(de,{children:(Q,He)=>{var J=A(),j=$(J);M(j,()=>Ot,($e,G)=>{G($e,{children:(oe,Oe)=>{var he=A(),ue=$(he);nt(ue,1,()=>l().filter(me=>!me.is_prediction),_t,(me,X)=>{var Y=A(),ke=$(Y);{var Ke=xe=>{var ze=A(),gt=$(ze);M(gt,()=>zt,(pt,lt)=>{lt(pt,{get value(){return a(X).annotation_task_id},get label(){return a(X).name},children:(kt,da)=>{Z();var ht=Ce();W(()=>V(ht,a(X).name)),o(kt,ht)},$$slots:{default:!0}})}),o(xe,ze)};Ee(ke,xe=>{a(X).annotation_task_id&&xe(Ke)})}o(me,Y)}),o(oe,he)},$$slots:{default:!0}})}),o(Q,J)},$$slots:{default:!0}})}),o(N,ne)},$$slots:{default:!0}})}),o(z,H)}});var Pe=v(Se,2);At(Pe,{label:"Prediction Task",children:(z,re)=>{var H=A(),q=$(H);M(q,()=>Dt,(se,D)=>{D(se,{type:"single",name:"predictionTaskId",get value(){return a(P)},set value(N){I(P,ye(N))},children:(N,ge)=>{var ne=cr(),U=$(ne);M(U,()=>Ft,(de,ce)=>{ce(de,{class:"w-full",children:(Q,He)=>{Z();var J=Ce();W(j=>V(J,j),[()=>{var j;return((j=l().find($e=>$e.annotation_task_id===a(P)))==null?void 0:j.name)||"Select prediction task"}]),o(Q,J)},$$slots:{default:!0}})});var Ue=v(U,2);M(Ue,()=>Mt,(de,ce)=>{ce(de,{children:(Q,He)=>{var J=A(),j=$(J);M(j,()=>Ot,($e,G)=>{G($e,{children:(oe,Oe)=>{var he=A(),ue=$(he);nt(ue,1,()=>l().filter(me=>me.is_prediction),_t,(me,X)=>{var Y=A(),ke=$(Y);{var Ke=xe=>{var ze=A(),gt=$(ze);M(gt,()=>zt,(pt,lt)=>{lt(pt,{get value(){return a(X).annotation_task_id},get label(){return a(X).name},children:(kt,da)=>{Z();var ht=Ce();W(()=>V(ht,a(X).name)),o(kt,ht)},$$slots:{default:!0}})}),o(xe,ze)};Ee(ke,xe=>{a(X).annotation_task_id&&xe(Ke)})}o(me,Y)}),o(oe,he)},$$slots:{default:!0}})}),o(Q,J)},$$slots:{default:!0}})}),o(N,ne)},$$slots:{default:!0}})}),o(z,H)}});var fe=v(Pe,2);At(fe,{label:"Tag (Optional)",children:(z,re)=>{var H=A(),q=$(H);M(q,()=>Dt,(se,D)=>{D(se,{type:"single",name:"tagId",get value(){return a(u)},set value(N){I(u,ye(N))},children:(N,ge)=>{var ne=vr(),U=$(ne);M(U,()=>Ft,(de,ce)=>{ce(de,{class:"w-full",children:(Q,He)=>{Z();var J=Ce();W(j=>V(J,j),[()=>{var j;return((j=d().find($e=>$e.tag_id===a(u)))==null?void 0:j.name)||"Select tag (optional)"}]),o(Q,J)},$$slots:{default:!0}})});var Ue=v(U,2);M(Ue,()=>Mt,(de,ce)=>{ce(de,{children:(Q,He)=>{var J=A(),j=$(J);M(j,()=>Ot,($e,G)=>{G($e,{children:(oe,Oe)=>{var he=ur(),ue=$(he);M(ue,()=>La,(X,Y)=>{Y(X,{children:(ke,Ke)=>{Z();var xe=Ce("Sample tags");o(ke,xe)},$$slots:{default:!0}})});var me=v(ue,2);nt(me,1,()=>d().filter(X=>X.kind==="sample"),_t,(X,Y)=>{var ke=A(),Ke=$(ke);M(Ke,()=>zt,(xe,ze)=>{ze(xe,{get value(){return a(Y).tag_id},get label(){return a(Y).name},children:(gt,pt)=>{Z();var lt=Ce();W(()=>V(lt,a(Y).name)),o(gt,lt)},$$slots:{default:!0}})}),o(X,ke)}),o(oe,he)},$$slots:{default:!0}})}),o(Q,J)},$$slots:{default:!0}})}),o(N,ne)},$$slots:{default:!0}})}),o(z,H)}});var Me=v(fe,2);{var Be=z=>{var re=fr(),H=f(re,!0);c(re),W(()=>V(H,a(T))),o(z,re)};Ee(Me,z=>{a(T)&&z(Be)})}var De=v(Me,2),b=f(De);Ye(b,{variant:"outline",class:"flex-1",onclick:F,get disabled(){return a(x)},children:(z,re)=>{Z();var H=Ce("Reset");o(z,H)},$$slots:{default:!0}});var K=v(b,2);const ae=k(()=>!a(p)||!a(P)||a(x));Ye(K,{variant:"default",class:"flex-1",onclick:O,get disabled(){return a(ae)},children:(z,re)=>{var H=hr(),q=$(H);{var se=D=>{var N=gr();o(D,N)};Ee(q,D=>{a(x)&&D(se)})}Z(),o(z,H)},$$slots:{default:!0}}),c(De),c(ve),o(le,ve)},Fe=le=>{var ve=$r(),Se=f(ve),Pe=v(f(Se),2),fe=f(Pe),Me=v(f(fe),2),Be=f(Me);c(Me),c(fe);var De=v(fe,2),b=v(f(De),2),K=f(b);c(b),c(De);var ae=v(De,2),z=v(f(ae),2),re=f(z);c(z),c(ae),c(Pe),c(Se);var H=v(Se,2);{var q=D=>{var N=_r(),ge=v(f(N),2);nt(ge,21,()=>Object.entries(a(_).map_per_class).sort(([ne],[U])=>ne<U?-1:ne>U?1:0),_t,(ne,U)=>{let Ue=()=>a(U)[0],de=()=>a(U)[1];var ce=pr(),Q=f(ce),He=f(Q);c(Q);var J=v(Q,2),j=f(J);c(J),c(ce),W($e=>{V(He,`${Ue()??""}:`),V(j,`${$e??""}%`)},[()=>(de()*100).toFixed(2)]),o(ne,ce)}),c(ge),c(N),o(D,N)};Ee(H,D=>{a(_).map_per_class&&D(q)})}var se=v(H,2);Ye(se,{variant:"outline",class:"mt-4 w-full",onclick:()=>I(_,null),children:(D,N)=>{Z();var ge=Ce("Back to Form");o(D,ge)},$$slots:{default:!0}}),c(ve),W((D,N,ge)=>{V(Be,`${D??""}%`),V(K,`${N??""}%`),V(re,`${ge??""}%`)},[()=>(a(_).map*100).toFixed(2),()=>(a(_).map_50*100).toFixed(2),()=>(a(_).map_75*100).toFixed(2)]),o(le,ve)};Ee(Ve,le=>{a(_)?le(Fe,!1):le(We)})}c(Ae),c(te),o(E,te)},pe=E=>{var te=yr();o(E,te)};Ee(ee,E=>{s()&&i()?E(we):E(pe,!1)})}o(r,L),B(),n()}var wr=w('<div class="w-300 flex space-x-4 text-diffuse-foreground"><!> <!> <!></div>');function Sr(r,e){R(e,!0);const t=Ie(e,"min",3,100),n=Ie(e,"max",3,1500),s=ga.throttle(y=>{e.onChange(y[0])},100);var i=wr(),l=f(i);sr(l,{class:"h-6 w-6"});var d=v(l,2);const m=k(()=>[e.width]);Nt(d,{class:"w-full flex-1",get value(){return a(m)},get min(){return t()},get max(){return n()},step:1,onValueChange:s});var h=v(d,2);na(h,{class:"h-6 w-6"}),c(i),o(r,i),B()}var Pr=w('<div class="h-3 w-3 cursor-pointer rounded-sm border"></div>'),kr=w('<div class="color-picker-container"><!></div> <p class="flex-1 truncate text-base font-normal"> </p> <span class="text-sm text-diffuse-foreground"> </span>',1),Tr=w('<div class="width-full flex items-center space-x-2"><!> <!></div>'),Cr=w('<div class="width-full space-y-2 overflow-hidden"></div>');function Er(r,e){R(e,!0);const[t,n]=ft(),s=()=>ie(y,"$customLabelColorsStore",t),i=()=>ie(l(),"$annotationFilters",t);let l=Ie(e,"annotationFilters",19,()=>[]);const{setCustomColor:d,getCustomColor:m,hasCustomColor:h,customLabelColorsStore:y}=Fa();function g(u,_,x){d(u,_,x)}function C(u){if(h(u)){const x=m(u);return(x==null?void 0:x.color)||"#ff0000"}const _=$t(u,1).color;try{const x=_.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(x){const T=parseInt(x[1]),O=parseInt(x[2]),F=parseInt(x[3]);return`#${((1<<24)+(T<<16)+(O<<8)+F).toString(16).slice(1)}`}}catch(x){console.error("Error converting rgba to hex",x)}return"#ff0000"}function p(u){if(h(u)){const _=m(u);return(_==null?void 0:_.alpha)||1}return .4}const P=k(()=>{const u=s(),_={};for(const x of Object.keys(u)){const T=u[x];_[x]={borderColor:T.color,backgroundColor:$t(x,.4).color}}return _});Pt(r,{title:"Labels",children:(u,_)=>{var x=Cr();nt(x,5,i,({label_name:T,current_count:O,total_count:F,selected:L})=>T,(T,O)=>{let F=()=>a(O).label_name,L=()=>a(O).current_count,ee=()=>a(O).total_count,we=()=>a(O).selected;var pe=Tr(),E=f(pe);const te=k(()=>`${F()}-label`);ha(E,{get id(){return F()},get checked(){return we()},get"aria-labelledby"(){return a(te)},onCheckedChange:()=>e.onToggleAnnotationFilter(F())});var _e=v(E,2);const Ae=k(()=>`${F()}-label`);Ha(_e,{get id(){return a(Ae)},get for(){return F()},class:"flex min-w-0 flex-1 cursor-pointer items-center space-x-2 text-nowrap peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:(Ve,We)=>{var Fe=kr(),le=$(Fe),ve=f(le);const Se=k(()=>C(F())),Pe=k(()=>p(F()));ma(ve,{get initialColor(){return a(Se)},get initialAlpha(){return a(Pe)},onChange:(b,K)=>g(F(),b,K),children:(b,K)=>{var ae=Pr();W(z=>pa(ae,z),[()=>{var z,re;return`
                                    border-color: ${((z=a(P)[F()])==null?void 0:z.borderColor)??$t(F()).color};
                                    background-color: ${((re=a(P)[F()])==null?void 0:re.backgroundColor)??$t(F(),we()?1:.4).color};
                                `}]),o(b,ae)},$$slots:{default:!0}}),c(le);var fe=v(le,2),Me=f(fe,!0);c(fe);var Be=v(fe,2),De=f(Be);c(Be),W((b,K)=>{V(Me,F()),V(De,`${b??""} of ${K??""}`)},[()=>ct(L()),()=>ct(ee())]),o(Ve,Fe)},$$slots:{default:!0}}),c(pe),W(()=>_a(pe,"title",F())),o(T,pe)}),c(x),o(u,x)},$$slots:{default:!0}}),B(),n()}function Ir(r,e){R(e,!0);let t=Ie(e,"ref",15,null),n=be(e,["$$slots","$$events","$$legacy","ref","class"]);var s=A(),i=$(s);const l=k(()=>Ge("text-lg font-semibold leading-none tracking-tight",e.class));M(i,()=>qa,(d,m)=>{m(d,qe({get class(){return a(l)}},()=>n,{get ref(){return t()},set ref(h){t(h)}}))}),o(r,s),B()}var Ar=w("<div><!></div>");function Fr(r,e){R(e,!0);let t=Ie(e,"ref",15,null),n=be(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=Ar();let i;var l=f(s);Le(l,()=>e.children??Re),c(s),yt(s,d=>t(d),()=>t()),W(d=>i=mt(s,i,{class:d,...n}),[()=>Ge("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e.class)]),o(r,s),B()}var Mr=w("<div><!></div>");function Or(r,e){R(e,!0);let t=Ie(e,"ref",15,null),n=be(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=Mr();let i;var l=f(s);Le(l,()=>e.children??Re),c(s),yt(s,d=>t(d),()=>t()),W(d=>i=mt(s,i,{class:d,...n}),[()=>Ge("flex flex-col space-y-1.5 text-center sm:text-left",e.class)]),o(r,s),B()}function zr(r,e){R(e,!0);let t=Ie(e,"ref",15,null),n=be(e,["$$slots","$$events","$$legacy","ref","class"]);var s=A(),i=$(s);const l=k(()=>Ge("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0  fixed inset-0 z-50 bg-black/80",e.class));M(i,()=>$a,(d,m)=>{m(d,qe({get class(){return a(l)}},()=>n,{get ref(){return t()},set ref(h){t(h)}}))}),o(r,s),B()}var Dr=w('<!> <span class="sr-only">Close</span>',1),Nr=w("<!> <!>",1),Lr=w("<!> <!>",1);function qr(r,e){R(e,!0);let t=Ie(e,"ref",15,null),n=be(e,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var s=A(),i=$(s);M(i,()=>Gr,(l,d)=>{d(l,qe(()=>e.portalProps,{children:(m,h)=>{var y=Lr(),g=$(y);M(g,()=>zr,(P,u)=>{u(P,{})});var C=v(g,2);const p=k(()=>Ge("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] bg-background fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 sm:rounded-lg",e.class));M(C,()=>xa,(P,u)=>{u(P,qe({get class(){return a(p)}},()=>n,{get ref(){return t()},set ref(_){t(_)},children:(_,x)=>{var T=Nr(),O=$(T);Le(O,()=>e.children??Re);var F=v(O,2);M(F,()=>ya,(L,ee)=>{ee(L,{class:"ring-offset-background focus:ring-ring absolute right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none",children:(we,pe)=>{var E=Dr(),te=$(E);ba(te,{class:"size-4"}),Z(2),o(we,E)},$$slots:{default:!0}})}),o(_,T)},$$slots:{default:!0}}))}),o(m,y)},$$slots:{default:!0}}))}),o(r,s),B()}function Kr(r,e){R(e,!0);let t=Ie(e,"ref",15,null),n=be(e,["$$slots","$$events","$$legacy","ref","class"]);var s=A(),i=$(s);const l=k(()=>Ge("text-muted-foreground text-sm",e.class));M(i,()=>Qa,(d,m)=>{m(d,qe({get class(){return a(l)}},()=>n,{get ref(){return t()},set ref(h){t(h)}}))}),o(r,s),B()}const jr=Ka,Gr=wa,Rr=async({dataset_id:r,tag_id:e,annotationIdsBody:t})=>{const n={data:void 0,error:void 0};try{const s=await et.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/annotations",{params:{path:{dataset_id:r,tag_id:e}},body:t});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No data");n.data=s.data}catch(s){n.error="Error assigning annotationIds to a tag: "+String(s)}return n};var at,rt,Te,Qe,Ze,xt,qt,Yt,Br=(Yt=class extends ja{constructor(e,t){super();Je(this,Ze);Je(this,at);Je(this,rt);Je(this,Te);Je(this,Qe);dt(this,at,e),this.setOptions(t),this.bindMethods(),st(this,Ze,xt).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var n;const t=this.options;this.options=S(this,at).defaultMutationOptions(e),Ga(this.options,t)||S(this,at).getMutationCache().notify({type:"observerOptionsUpdated",mutation:S(this,Te),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&Vt(t.mutationKey)!==Vt(this.options.mutationKey)?this.reset():((n=S(this,Te))==null?void 0:n.state.status)==="pending"&&S(this,Te).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=S(this,Te))==null||e.removeObserver(this)}onMutationUpdate(e){st(this,Ze,xt).call(this),st(this,Ze,qt).call(this,e)}getCurrentResult(){return S(this,rt)}reset(){var e;(e=S(this,Te))==null||e.removeObserver(this),dt(this,Te,void 0),st(this,Ze,xt).call(this),st(this,Ze,qt).call(this)}mutate(e,t){var n;return dt(this,Qe,t),(n=S(this,Te))==null||n.removeObserver(this),dt(this,Te,S(this,at).getMutationCache().build(S(this,at),this.options)),S(this,Te).addObserver(this),S(this,Te).execute(e)}},at=new WeakMap,rt=new WeakMap,Te=new WeakMap,Qe=new WeakMap,Ze=new WeakSet,xt=function(){var t;const e=((t=S(this,Te))==null?void 0:t.state)??Ra();dt(this,rt,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},qt=function(e){ra.batch(()=>{var t,n,s,i,l,d,m,h;if(S(this,Qe)&&this.hasListeners()){const y=S(this,rt).variables,g=S(this,rt).context;(e==null?void 0:e.type)==="success"?((n=(t=S(this,Qe)).onSuccess)==null||n.call(t,e.data,y,g),(i=(s=S(this,Qe)).onSettled)==null||i.call(s,e.data,null,y,g)):(e==null?void 0:e.type)==="error"&&((d=(l=S(this,Qe)).onError)==null||d.call(l,e.error,y,g),(h=(m=S(this,Qe)).onSettled)==null||h.call(m,void 0,e.error,y,g))}this.listeners.forEach(y=>{y(S(this,rt))})})},Yt);function ia(r){return Ba()}function Hr(r){return"subscribe"in r&&typeof r.subscribe=="function"}function Jr(){}function Vr(r,e){const t=ia(),n=Hr(r)?r:Jt(r),s=new Br(t,Xe(n));let i;n.subscribe(m=>{i=(h,y)=>{s.mutate(h,y).catch(Jr)},s.setOptions(m)});const l=Jt(s.getCurrentResult(),m=>s.subscribe(ra.batchCalls(h=>m(h)))),{subscribe:d}=Ca(l,m=>({...m,mutate:i,mutateAsync:m.mutate}));return{subscribe:d}}const Wr=r=>["/api/datasets/{dataset_id}/tags",r];var Ur=w("<input>"),Qr=w("<input>");function la(r,e){R(e,!0);let t=Ie(e,"ref",15,null),n=Ie(e,"value",15),s=Ie(e,"files",15),i=be(e,["$$slots","$$events","$$legacy","ref","value","type","files","class"]);var l=A(),d=$(l);{var m=y=>{var g=Ur();Bt(g);let C;yt(g,p=>t(p),()=>t()),W(p=>C=mt(g,C,{class:p,type:"file",...i}),[()=>Ge("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Sa(g,s),Ht(g,n),o(y,g)},h=y=>{var g=Qr();Bt(g);let C;yt(g,p=>t(p),()=>t()),W(p=>C=mt(g,C,{class:p,type:e.type,...i}),[()=>Ge("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e.class)]),Ht(g,n),o(y,g)};Ee(d,y=>{e.type==="file"?y(m):y(h,!1)})}o(r,l),B()}const Xr=async({dataset_id:r,tag_id:e,sampleIdsBody:t})=>{const n={data:void 0,error:void 0};try{const s=await et.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/samples",{params:{path:{dataset_id:r,tag_id:e}},body:t});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No data");n.data=s.data}catch(s){n.error="Error assigning sampleIds to tag: "+String(s)}return n},Yr=async({dataset_id:r,tagInputBody:e})=>{const t={data:void 0,error:void 0};try{const n=await et.POST("/api/datasets/{dataset_id}/tags",{params:{path:{dataset_id:r}},body:e});if(n.error)throw new Error(JSON.stringify(n.error,null,2));if(!n.data)throw new Error("No data");t.data=n.data}catch(n){t.error="Error creating tag: "+String(n)}return t};var Zr=w("<!> Create new Tags",1),es=w("<!> <!>",1),ts=w('<div class="flex space-x-2 py-1"><!></div>'),as=w('<!> <!> <div class="grid gap-4"><!></div> <div><!> <!></div> <!>',1),rs=w('<div class="flex space-x-1"><!> <!></div> <!>',1);function ss(r,e){R(e,!0);const[t,n]=ft(),s=()=>ie(p,"$selectedSampleIds",t),i=()=>ie(P,"$selectedSampleAnnotationCropIds",t),l=()=>ie(a(g),"$tags",t),d=()=>ie(a(T),"$itemsSelected",t),m=()=>ie(We,"$submitTagAndMutate",t);let h=k(()=>e.gridType==="samples"?"sample":"annotation");const y=k(()=>Kt({dataset_id:e.datasetId,kind:[a(h)]})),g=k(()=>a(y).tags),C=k(()=>a(y).loadTags),{selectedSampleIds:p,selectedSampleAnnotationCropIds:P,clearSelectedSampleAnnotationCrops:u,clearSelectedSamples:_}=Zt(),x=k(()=>e.gridType==="samples"?_:u),T=k(()=>e.gridType==="samples"?p:P);let O=Ne(!1);const F=k(()=>s().size>0&&e.gridType==="samples"||i().size>0&&e.gridType==="annotations");let L=Ne(""),ee=Ne(ye([])),we=()=>{a(ee).push(a(L)),E.add(a(L)),I(L,"")};const pe=k(()=>[...a(ee).map(b=>({tag_id:b,name:b,kind:a(h)})),...l()].filter(b=>b.name.includes(a(L))));let E=ye(new Lt);const te=b=>{E.has(b)?(E.delete(b),a(ee).splice(a(ee).indexOf(b),1)):E.add(b)};let _e=Ne(null);const Ae=async()=>{await Promise.all([...a(ee)].map(async b=>{var ae;const K=await Yr({dataset_id:e.datasetId,tagInputBody:{name:b,description:`${b} description`,kind:a(h)}});if(K.error)throw K.error;return(ae=K.data)!=null&&ae.tag_id&&(E.delete(b),E.add(K.data.tag_id)),K})),await Promise.all([...E].map(async b=>{const K=a(h)==="sample"?await Xr({dataset_id:e.datasetId,tag_id:b,sampleIdsBody:{sample_ids:[...d()]}}):await Rr({dataset_id:e.datasetId,tag_id:b,annotationIdsBody:{annotation_ids:[...d()]}});if(K.error)throw K.error;return K}))},Ve=ia(),We=Vr({mutationFn:async()=>{await Ae()},onError:b=>{I(_e,ye(b))},onSuccess:()=>{Ve.invalidateQueries({queryKey:Wr({dataset_id:e.datasetId})}),a(C)(),a(x)(),Fe(!1)}}),Fe=b=>{I(O,ye(b)),I(_e,null),I(L,""),I(ee,ye([])),E.clear()},le=k(()=>E.size>0||a(ee).length>0);var ve=rs(),Se=$(ve),Pe=f(Se);const fe=k(()=>!a(F));Ye(Pe,{variant:"outline",get disabled(){return a(fe)},class:"flex-1",onclick:()=>I(O,!0),children:(b,K)=>{var ae=Zr(),z=$(ae);nr(z,{}),Z(),o(b,ae)},$$slots:{default:!0}});var Me=v(Pe,2);const Be=k(()=>!a(F));Ye(Me,{variant:"outline",get disabled(){return a(Be)},size:"icon",title:"Clear selection",get onclick(){return a(x)},children:(b,K)=>{rr(b,{})},$$slots:{default:!0}}),c(Se);var De=v(Se,2);M(De,()=>jr,(b,K)=>{K(b,{onOpenChange:Fe,get open(){return a(O)},children:(ae,z)=>{var re=A(),H=$(re);M(H,()=>qr,(q,se)=>{se(q,{class:"sm:max-w-[425px]",children:(D,N)=>{var ge=as(),ne=$(ge);M(ne,()=>Or,(G,oe)=>{oe(G,{children:(Oe,he)=>{var ue=es(),me=$(ue);M(me,()=>Ir,(Y,ke)=>{ke(Y,{children:(Ke,xe)=>{Z();var ze=Ce();W(()=>V(ze,`Add the selected ${a(h)??""} to a tag`)),o(Ke,ze)},$$slots:{default:!0}})});var X=v(me,2);M(X,()=>Kr,(Y,ke)=>{ke(Y,{children:(Ke,xe)=>{Z();var ze=Ce();W(()=>V(ze,`Add the selected ${d().size??""}
                ${a(h)??""} to an new or existing tag. Tags can later be exported.`)),o(Ke,ze)},$$slots:{default:!0}})}),o(Oe,ue)},$$slots:{default:!0}})});var U=v(ne,2);{var Ue=G=>{Oa(G,{title:"Error occured",children:(oe,Oe)=>{Z();var he=Ce();W(()=>V(he,a(_e))),o(oe,he)}})};Ee(U,G=>{a(_e)&&G(Ue)})}var de=v(U,2),ce=f(de);la(ce,{type:"text",placeholder:"Create or search tags",autofocus:!0,get value(){return a(L)},set value(G){I(L,ye(G))}}),c(de);var Q=v(de,2),He=f(Q);nt(He,17,()=>a(pe),G=>G.tag_id,(G,oe)=>{var Oe=ts(),he=f(Oe);const ue=k(()=>`tagCreateDialog-tag-${a(oe).tag_id}`),me=k(()=>E.has(a(oe).tag_id));sa(he,{get name(){return a(ue)},get isChecked(){return a(me)},get label(){return a(oe).name},onCheckedChange:()=>te(a(oe).tag_id)}),c(Oe),o(G,Oe)});var J=v(He,2);{var j=G=>{const oe=k(()=>Ge("",...Pa({variant:"outline"})));Ye(G,{type:"button",variant:"outline",get class(){return a(oe)},onclick:we,children:(Oe,he)=>{Z();var ue=Ce();W(()=>V(ue,`Create tag "${a(L)??""}"`)),o(Oe,ue)},$$slots:{default:!0}})};Ee(J,G=>{a(L)&&G(j)})}c(Q);var $e=v(Q,2);M($e,()=>Fr,(G,oe)=>{oe(G,{children:(Oe,he)=>{var ue=A(),me=$(ue);{var X=Y=>{Ye(Y,{type:"submit",onclick:()=>m().mutate(),children:(ke,Ke)=>{Z();var xe=Ce("Save changes");o(ke,xe)},$$slots:{default:!0}})};Ee(me,Y=>{a(le)&&Y(X)})}o(Oe,ue)},$$slots:{default:!0}})}),o(D,ge)},$$slots:{default:!0}})}),o(ae,re)},$$slots:{default:!0}})}),o(r,ve),B(),n()}var ns=w('<div class="flex items-center space-x-2 py-1"><!></div>'),os=w("<p>No tag, create a tag</p>"),is=w('<div class="mb-3 w-full space-y-2"></div>');function ls(r,e){R(e,!0);const[t,n]=ft(),s=()=>ie(a(d),"$tags",t),i=()=>ie(a(m),"$tagsSelected",t),l=k(()=>Kt({dataset_id:e.dataset_id,kind:[e.gridType==="annotations"?"annotation":"sample"]})),d=k(()=>a(l).tags),m=k(()=>a(l).tagsSelected),h=k(()=>a(l).tagSelectionToggle);Pt(r,{title:"Tags",icon:za,children:(y,g)=>{var C=is();nt(C,5,s,p=>p.tag_id,(p,P)=>{var u=ns(),_=f(u);const x=k(()=>i().has(a(P).tag_id));sa(_,{get name(){return a(P).tag_id},get isChecked(){return a(x)},get label(){return a(P).name},onCheckedChange:()=>a(h)(a(P).tag_id)}),c(u),o(p,u)},p=>{var P=os();o(p,P)}),c(C),o(y,C)}}),B(),n()}function ds(){const r=ot({width:200,height:200});return{sampleSize:r,updateWidth:t=>{r.set({width:t,height:t})}}}const Ut=async({dataset_id:r,filtered_labels:e,dimensions:t})=>{const n={data:[],error:void 0};try{const s=await et.GET("/api/annotations/count",{params:{query:{dataset_id:r,...e&&{filtered_labels:e},...(t==null?void 0:t.min_width)&&{min_width:t.min_width},...(t==null?void 0:t.max_width)&&{max_width:t.max_width},...(t==null?void 0:t.min_height)&&{min_height:t.min_height},...(t==null?void 0:t.max_height)&&{max_height:t.max_height}}}});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No annotation counts found");n.data=s.data.map(i=>({label_name:i.label_name,total_count:i.total_count,current_count:i.current_count}))}catch(s){n.error="Error loading annotation counts: "+String(s)}return n},cs=async()=>{const r={data:[],error:void 0};try{const e=await et.GET("/api/annotation_labels");e.data&&(r.data=e.data)}catch(e){r.error="Error loading annotation labels: "+String(e)}return r},us=async({dataset_id:r,annotation_labels:e})=>{const t={data:void 0,error:void 0};try{const n=await et.GET("/api/samples/dimensions",{params:{query:{dataset_id:r,annotation_labels:e}}});if(n.error)throw new Error(JSON.stringify(n.error,null,2));if(!n.data)throw new Error("No dimension bounds data");t.data=n.data}catch(n){t.error="Error loading dimension bounds: "+String(n)}return t},Qt=(r,e)=>r.map(t=>({...t,selected:e.includes(t.label_name)})),Xt=r=>e=>e.includes(r)?e.filter(t=>t!==r):[...e,r],vs=async({params:{dataset_id:r}})=>{const{data:e,error:t}=await Ia(r);if(t||!e)throw Aa(307,vt.toHome());const{selectedAnnotationFilterIds:n,dimensions:s}=Zt(),i=Array.from(Xe(n)),l=ot([]),d=ot(i),m=ot([]),h=ot(void 0),y=u=>{h.set(u)},[g]=await Promise.all([cs().then(u=>{const _=u.data.reduce((T,O)=>({...T,[O.annotation_label_name]:O.annotation_label_id}),{}),x=Object.entries(_).filter(([,T])=>i.includes(T)).map(([T])=>T);return l.set(x),_}),us({dataset_id:r}).then(({data:u})=>{u&&s.set(u)}),Ut({dataset_id:r}).then(({data:u})=>{if(u){const _=Xe(l);m.set(Qt(u,_))}})]),C=async()=>{try{const u=Xe(l),{data:_}=await Ut({dataset_id:r,filtered_labels:u.length>0?u:void 0,dimensions:Xe(s)});_&&m.update(()=>Qt(_||[],u))}catch(u){h.set(`Failed to load annotations: ${String(u)}`)}},p=u=>{u&&(s.set(u),C())};return{datasetId:r,annotationFilters:m,toggleAnnotationFilterSelection:u=>{l.update(Xt(u));const _=g[u];n.update(x=>(x.has(_)?x.delete(_):x.add(_),x)),d.update(Xt(_)),C()},annotationFilterLabels:g,selectedAnnotationFilter:l,selectedAnnotationFilterIds:d,dimensions:ea(s),updateDimensions:p,error:Xe(h),setError:y,sampleSize:ds()}},zs=Object.freeze(Object.defineProperty({__proto__:null,load:vs},Symbol.toStringTag,{value:"Module"})),fs=()=>{const r=ot([]),e=ot(null);return et.GET("/api/features").then(t=>{t.data&&r.set(t.data)}).catch(t=>{e.set(t)}),{error:e,featureFlags:ea(r)}},gs=r=>{const{getKeyboardShortcuts:e}=ka(),t=new Set,n=i=>{if(i.target instanceof HTMLInputElement||i.target instanceof HTMLTextAreaElement||i.target instanceof HTMLSelectElement)return;t.add(i.key);const l=Xe(bt).url.pathname,d={hideAnnotations:e.hide_annotations||"v",goBack:e.go_back||"Escape"};Object.entries(r).forEach(([m,h])=>{const y=d[m]||h.key;if(i.key===y){if(h.requiredPath){if(typeof h.requiredPath=="function"){if(!h.requiredPath(l))return}else if(!h.requiredPath.test(l))return}h.action(i)}})},s=i=>{t.delete(i.key)};return ta(()=>{window.addEventListener("keydown",n),window.addEventListener("keyup",s)}),aa(()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",s)}),{isKeyPressed:i=>t.has(i)}},hs={goBack:{key:"Escape",description:"Go back from detail view to grid view",isConfigurable:!0,requiredPath:r=>/\/datasets\/[^/]+\/(samples|annotations)\/[^/]+/.test(r)||/\/samples\/[^/]+/.test(r),action:()=>{const r=Xe(bt).url.pathname,e=Xe(bt).params.dataset_id;if(/\/samples\/[^/]+/.test(r)&&!e){It("/");return}e&&(r.includes("/samples/")?It(vt.toSamples(e)):r.includes("/annotations/")&&It(vt.toAnnotations(e)))}}},ms=async({query_text:r="",model_id:e=""})=>{const t={data:[],error:void 0};try{const n=await et.GET("/api/text_embedding/embed_text",{params:{query:{query_text:r,model_id:e}}});if(n.error)throw new Error(JSON.stringify(n.error,null,2));if(!n.data)throw new Error("No data");t.data=n.data}catch(n){t.error="Error creating text embedding: "+String(n)}return t};var ps=w('<div class="space-y-2"><!> <!></div>'),_s=w('<div class="relative"><!> <!></div>'),$s=w('<div class="flex h-full w-full space-x-4 px-4 pb-4"><div class="flex w-80 flex-col space-y-6 rounded-[1vw] bg-card py-4"><div class="px-4"><!></div> <div class="min-h-0 flex-1 space-y-2 overflow-y-auto px-4 dark:[color-scheme:dark]"><div><!> <!></div> <!></div></div> <div class="flex1 flex flex-grow flex-col space-y-4 rounded-[1vw] bg-card p-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><!></div> <div class="w-4/12"><!></div></div> <!> <div class="flex min-h-0 flex-1"><!></div></div> <!></div>');function Ds(r,e){R(e,!0);const[t,n]=ft(),s=()=>ie(bt,"$page",t),i=()=>ie(_,"$textEmbedding",t),l=()=>ie(pe,"$featureFlags",t),d=()=>ie(F,"$bonndedSampleSize",t);let m=s().params.dataset_id;const{dimensions:h,updateDimensions:y,annotationFilters:g,toggleAnnotationFilterSelection:C,sampleSize:p,setError:P,globalStorage:{setTextEmbedding:u,textEmbedding:_,setLastGridType:x}}=e.data,{handleKeyEvent:T}=Ma();ta(()=>{window.addEventListener("keydown",T),window.addEventListener("keyup",T)}),aa(()=>{window.removeEventListener("keydown",T),window.removeEventListener("keyup",T)}),gs({goBack:hs.goBack});let O=Ne("samples");Ea(()=>{I(O,ye(s().url.pathname===vt.toAnnotations(m)?"annotations":"samples")),x(a(O))});const F=p.sampleSize;let L=Ne(ye(i()?i().queryText:""));async function ee(){if(a(L).trim()!=="")try{return(await ms({query_text:a(L),model_id:void 0})).data}catch(q){P(q.message),console.error("Error during API call:",q)}}async function we(q){if(q.key==="Enter"){const se=await ee();u({queryText:a(L),embedding:se})}}const{featureFlags:pe}=fs(),E=k(()=>l().some(q=>q==="embeddingSearchEnabled"));var te=$s(),_e=f(te),Ae=f(_e),Ve=f(Ae);er(Ve,{datasetId:m,get gridType(){return a(O)}}),c(Ae);var We=v(Ae,2),Fe=f(We),le=f(Fe);ls(le,{dataset_id:m,get gridType(){return a(O)}});var ve=v(le,2);ss(ve,{datasetId:m,get gridType(){return a(O)}}),c(Fe);var Se=v(Fe,2);Pt(Se,{title:"Filters",icon:ir,children:(q,se)=>{var D=ps(),N=f(D);Er(N,{annotationFilters:g,onToggleAnnotationFilter:C});var ge=v(N,2);{var ne=U=>{ar(U,{dimensions:h,onChange:y})};Ee(ge,U=>{h&&U(ne)})}c(D),o(q,D)}}),c(We),c(_e);var Pe=v(_e,2),fe=f(Pe),Me=f(fe),Be=f(Me);{var De=q=>{var se=_s(),D=f(se);or(D,{class:"absolute left-2 top-[50%] h-4 w-4 translate-y-[-50%] text-muted-foreground"});var N=v(D,2);la(N,{placeholder:"Search",class:"pl-8",onkeydown:we,get value(){return a(L)},set value(ge){I(L,ye(ge))}}),c(se),o(q,se)};Ee(Be,q=>{a(O)==="samples"&&a(E)&&q(De)})}c(Me);var b=v(Me,2),K=f(b);Sr(K,{get width(){return d().width},get onChange(){return p.updateWidth}}),c(b),c(fe);var ae=v(fe,2);jt(ae,{class:"mb-4 bg-border-hard"});var z=v(ae,2),re=f(z);Ta(re,e,"default",{},null),c(z),c(Pe);var H=v(Pe,2);br(H,{}),c(te),o(r,te),B(),n()}export{Ds as component,zs as universal};
