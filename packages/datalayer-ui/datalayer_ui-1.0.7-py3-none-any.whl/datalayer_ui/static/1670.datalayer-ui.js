"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[1670],{21670:(e,t,n)=>{n.r(t),n.d(t,{NotebookEdit:()=>tt,default:()=>nt});var s=n(9387),a=n(20568),r=n(97789),i=n(16950),o=n(3345),l=n(7856),c=n(98754),d=n(99180),u=n(93054),m=n(48453),p=n(64315),h=n(24860),g=n(92243),f=n(3556),x=n(80006),v=n(38621),b=n(42389),j=n(16476),y=n(2159),C=n(5700),k=n(2606),w=n(72217),A=n(9403),S=n(18683);const _=e=>{const{data:t,fileName:n,variant:s,extension:a}=e;return(0,S.jsx)(d.Q,{variant:s,leadingVisual:v.s3U,onClick:e=>(0,A.xD)(t,n,a),children:"Download"})};_.defaultProps={variant:"default",name:"data",extension:"json"};var I=n(154),N=n(88106),R=n(59179),T=n(5279),D=n(9175),E=n(65047),P=n(3316),$=n(63948),M=n(43),U=n(50787),L=n(51857),z=function(e){return e[e.None=0]="None",e[e.New=1]="New",e[e.Transfer=2]="Transfer",e}(z||{});function V(e){const{assignKernel:t,sessionConnection:n}=e,{remoteKernels:a,multiServiceManager:r,jupyterLabAdapter:i}=(0,L.xb)(),[o,l]=(0,s.useState)(),[u,m]=(0,s.useState)({}),[p,h]=(0,s.useState)(z.None),[g,f]=(0,s.useState)("");(0,s.useEffect)((()=>{if(n){function e(e){f(`Runtime ${e.kernel?.connectionStatus} - Status: ${e.kernel?.status}`)}return e(n),n?.statusChanged.connect(e),n?.connectionStatusChanged.connect(e),()=>{n?.statusChanged.disconnect(e),n?.connectionStatusChanged.disconnect(e)}}f("No kernel")}),[n]);const x=(0,s.useCallback)((async()=>{r?.remote?.kernels&&await r.remote.kernels.refresh()}),[r?.remote?.kernels]),b=(0,s.useCallback)((()=>{h(z.New)}),[]),j=(0,s.useCallback)((e=>{if(e)switch(p){case z.New:x().then((()=>{l("remote"),t({runtimeDesc:e,kernelModel:r?.remote?.kernels.get().find((t=>t.id===e.id))})}));break;case z.Transfer:l("remote"),t({runtimeDesc:e,transferState:!0})}h(z.None)}),[x,r?.remote,p]);return(0,s.useEffect)((()=>{i?Promise.all([i.jupyterLab.resolveOptionalService(T.co),i.jupyterLab.resolveOptionalService(R.zG)]).then((e=>{m({[T.co.name]:e[0],[R.zG.name]:e[1]})})):m({})}),[i]),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(D.W,{children:[(0,S.jsx)(D.W.Button,{leadingVisual:()=>{switch(o){case"browser":return(0,S.jsx)($.A,{});case"remote":return(0,S.jsx)(v.hpF,{});case void 0:return(0,S.jsx)(v.bMW,{})}return(0,S.jsx)(I.Cx,{type:"runtime"})},trailingVisual:()=>n?(0,S.jsx)(c.A,{sx:{paddingTop:"5px"},children:(0,S.jsx)(N.T1,{kernel:n.kernel})}):(0,S.jsx)(S.Fragment,{}),size:"small",variant:"invisible",children:(0,S.jsx)(E.m,{text:g,direction:"s",children:(0,S.jsx)(d.Q,{variant:"invisible",size:"small",children:n?.kernel?.name??"Runtimes"})})}),(0,S.jsx)(D.W.Overlay,{width:"medium",children:(0,S.jsxs)(P.l,{selectionVariant:"single",showDividers:!0,children:[(0,S.jsxs)(P.l.Group,{children:[(0,S.jsxs)(P.l.Item,{selected:void 0===o&&void 0===n,onSelect:()=>{l(void 0),t({runtimeDesc:void 0})},children:[(0,S.jsx)(P.l.LeadingVisual,{children:(0,S.jsx)(v.bMW,{})}),"Viewer",(0,S.jsx)(P.l.Description,{variant:"block",children:"A simple Notebook Viewer without Runtime."})]}),(0,S.jsxs)(P.l.Item,{selected:"browser"===o,onSelect:()=>{l("browser"),t({runtimeDesc:{name:"pyodide",location:"browser",language:"python"}})},children:[(0,S.jsx)(P.l.LeadingVisual,{children:(0,S.jsx)($.A,{})}),"Browser Runtime",(0,S.jsx)(P.l.Description,{variant:"block",children:"A Browser Runtime based on Pyodide."})]})]}),a.length>0&&(0,S.jsxs)(P.l.Group,{children:[(0,S.jsx)(P.l.GroupHeading,{children:"Cloud Runtimes"}),a.map((e=>(0,S.jsxs)(P.l.Item,{selected:n?.kernel?.id===e.id,onSelect:()=>{l("remote"),t({runtimeDesc:{name:e.environment_name,language:"",location:"remote",displayName:e.kernel_given_name,id:e.id,burningRate:e.burning_rate,podName:e.jupyter_pod_name},kernelModel:e})},children:[(0,S.jsx)(P.l.LeadingVisual,{children:(0,S.jsx)(I.Cx,{type:"runtime"})}),e.kernel_given_name,(0,S.jsx)(P.l.Description,{variant:"block",children:e.environment_name})]},e.id)))]}),(0,S.jsx)(P.l.Divider,{}),(0,S.jsxs)(P.l.Group,{children:[(0,S.jsxs)(P.l.Item,{selected:!1,onSelect:b,children:[(0,S.jsx)(P.l.LeadingVisual,{children:(0,S.jsx)(M.A,{})}),"Launch a new Runtime…"]}),(0,S.jsxs)(P.l.Item,{disabled:"browser"!==o,selected:!1,onSelect:()=>{h(z.Transfer)},title:"Transfer the state of the current Runtime to a new Remote Runtime.",children:[(0,S.jsx)(P.l.LeadingVisual,{children:(0,S.jsx)(v.e0J,{})}),"Transfer state to a new Runtime…"]})]})]})})]}),r?.remote&&p>0&&(0,S.jsx)(U.s,{dialogTitle:p===z.Transfer?"Switch to a new Cloud Runtime":void 0,manager:r.remote,onSubmit:j,markdownParser:u[T.co.name],sanitizer:u[R.zG.name],startKernel:p===z.Transfer?"defer":p===z.New})]})}var O=n(59651),F=n(46343),W=n(11471),G=n(48370),K=n(10680),B=n(71623),Q=n(97734),H=n(24991),q=n(48003),J=n(61783);function X(e){const{children:t,connection:n,podName:a,multiServiceManager:r,disabled:i}=e,{addKernelSnapshot:o,jupyterRunUrl:l,kernelSnapshots:d,setKernelSnapshots:u}=(0,L.xb)(),{trackAsyncTask:m}=(0,Q.d)(),[h,g]=(0,s.useState)(!1),[f,x]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1),[j,y]=(0,s.useState)(d[0]?.id??""),[C,k]=(0,s.useState)();(0,s.useEffect)((()=>{(0,H.v2)().then((e=>{u(e),!j&&e.length>0&&y(e[0].id)})).catch((e=>{console.error(`Failed to fetch remote kernel snapshots; ${e}`)}))}),[l]);const w=(0,s.useCallback)((()=>{k(void 0),g(!0)}),[]),A=(0,s.useCallback)((e=>{y(e.target.value)}),[]),_=(0,s.useCallback)((async({id:e,connection:t,podName:n})=>{n?await(0,H.Wm)({id:n,from:e}):t&&await(0,q.M)({connection:t,id:e})}),[]),I=(0,s.useCallback)((async()=>{try{let e,t;b(!0);let s="",i="";if(a&&r?.remote)i=(0,J.m)("cloud"),t=r.remote.kernels.snapshot({podName:a,name:i,description:i,stop:!1}),s=a.split("-",2).reverse()[0],t.then((t=>{e=t}));else if(n&&r?.browser){const a=n.model;s=a.id,i=(0,J.m)("browser");let o=!0;t=(0,q._)({connection:r.browser.kernels.connectTo({model:a}),metadata:{filename:`${i}.data`},onUploadProgress:()=>{o&&(o=!1,(0,H.v2)().then((t=>{e=t.find((e=>e.name===i))})))}})}t&&(m(t,{error:{message:(e,t)=>"Empty snapshot"==e?`Runtime ${s} will not be snapshotted as it does not contain any serializable state.`:`Failed to pause runtime ${s} - ${e}`},pending:{message:`Taking a snapshot of runtime ${s}…`},success:{message:()=>`Runtime ${s} successfully snapshotted as ${i}.`}}),await t,e&&o(e))}finally{b(!1)}}),[n,a,r]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(D.W,{children:[(0,S.jsx)(D.W.Button,{leadingVisual:F.A,variant:"invisible",size:"small",disabled:f||v||i,children:t}),(0,S.jsx)(D.W.Overlay,{children:(0,S.jsxs)(P.l,{children:[(0,S.jsx)(P.l.Item,{onSelect:w,disabled:f||0==d.length,children:"Load a runtime snapshot…"}),(0,S.jsx)(P.l.Item,{onSelect:I,disabled:v,children:"Take a runtime snapshot"})]})})]}),h&&(0,S.jsx)(B.l,{title:"Choose a runtime snapshot to load",onClose:()=>{g(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:e=>{e.defaultPrevented||(e.preventDefault(),g(!1))}},{buttonType:"primary",content:f?(0,S.jsx)(W.A,{size:"small"}):"Load",disabled:f,onClick:async e=>{if(!e.defaultPrevented){e.preventDefault(),x(!0);try{k(void 0);const e=d.find((e=>e.id===j));e&&(n||a)?await _({connection:n,id:e.id,podName:a}):k("No runtime snapshot found.")}finally{x(!1),g(!1)}}},autoFocus:!0}],children:(0,S.jsxs)(c.A,{as:"form",children:[(0,S.jsxs)(p.A,{children:[(0,S.jsx)(p.A.Label,{children:"Snapshot"}),(0,S.jsx)(G.A,{name:"snapshot",value:j,onChange:A,block:!0,children:d.map((e=>(0,S.jsx)(G.A.Option,{value:e.id,children:e.name?`${e.name} (${e.id})`:e.id},e.id)))})]}),C&&(0,S.jsx)(K.A,{variant:"danger",children:C})]})})]})}X.defaultProps={disabled:!1};var Y=n(63711),Z=n(98238),ee=n(58875),te=n(51066),ne=n(29525),se=n(48461),ae=n(55285),re=n(2381);function ie(e,t){let n=e.map((e=>({...e,fileType:t?.getFileTypeForModel(e)})));return n=n.filter((e=>!e.name.startsWith("."))),n.sort(((e,t)=>"directory"===e.type&&"directory"!==t.type?-1:"directory"!==e.type&&"directory"===t.type?1:e.name.localeCompare(t.name))),n}function oe(e){const{item:t,contents:n,current:a,documentRegistry:r,onContextMenu:i,onSelect:o}=e,l=(0,s.useRef)(null),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),p=(0,s.useCallback)((()=>{m(!0),n.get(t.path).then((e=>{m(!1),d(ie(e.content,r))})).catch((()=>{m(!1)}))}),[n,t,r]),h=(0,s.useCallback)((async e=>{null===c&&e&&p()}),[c,t,n]);return(0,S.jsxs)(te.G.Item,{ref:l,id:`${t.type}-${t.name}`,onExpandedChange:h,onSelect:()=>{o(t,p)},current:t.path===a?.path,children:[(0,S.jsx)(te.G.LeadingVisual,{children:(0,S.jsx)(te.G.DirectoryIcon,{})}),(0,S.jsx)("span",{onContextMenu:e=>{e.preventDefault(),a?.path!==t.path&&o(t,p),i(l)},children:t.name}),(0,S.jsx)(te.G.SubTree,{state:u?"loading":(c?.length??-1)>=0?"done":"initial",children:c?.map((e=>"directory"===e.type?(0,S.jsx)(oe,{item:e,contents:n,current:a,documentRegistry:r,onContextMenu:i,onSelect:o},e.name):(0,S.jsx)(le,{item:e,current:e.path===a?.path,onSelect:e=>o(e,p),onContextMenu:i},e.name)))})]})}function le(e){const{item:t,current:n,onSelect:a,onContextMenu:r}=e,i=(0,s.useRef)(null),o=t.fileType?.icon;return(0,S.jsxs)(te.G.Item,{ref:i,id:`${t.type}-${t.name}`,current:n,onSelect:()=>{a(t)},children:[(0,S.jsx)(te.G.LeadingVisual,{children:o?(0,S.jsx)(o.react,{tag:"span"}):(0,S.jsx)(v.oSV,{})}),(0,S.jsx)("span",{onContextMenu:e=>{e.preventDefault(),n||a(t),r(i)},children:t.name})]},t.name)}const ce=1048576;function de(e){const{contents:t,localContents:n,documentRegistry:a}=e,r=(0,ae.aq)(),{trackAsyncTask:i}=(0,Q.d)(),[o,l]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),[m,p]=(0,s.useState)(null),[h,g]=(0,s.useState)(null),[x,v]=(0,s.useState)(!1),[b,j]=(0,s.useState)(!1),y=(0,s.useCallback)((()=>{t.get("").then((e=>{u(!1),l(ie(e.content,a))})).catch((e=>{u(!1),console.error(`Failed to fetch folder '' content for manager ${t.serverSettings.appUrl}.`,e)}))}),[t]);(0,s.useEffect)((()=>{y()}),[y]);const C=(0,s.useCallback)((async e=>{const n=()=>{if(!r())return Promise.reject(`Failed to upload ${e.name}; StorageBrowser component is unmounted.`)};n();const s=e.size>ce,a=m?"directory"===m.type?m.path:Y.PathExt.dirname(m.path):"",o=a?Y.PathExt.join(a,e.name):e.name,l=e.name,c=async(s,a)=>{n();const r=new FileReader;r.readAsDataURL(s),await new Promise(((t,n)=>{r.onload=t,r.onerror=t=>n(`Failed to upload "${e.name}":`+t)})),n();const i=r.result.split(",")[1],c={type:"file",format:"base64",name:l,chunk:a,content:i};return await t.save(o,c)},d={error:{message:t=>{const n=`Failed to upload ${e.name}.`;return console.error(n,t),n}},pending:{message:`Uploading ${e.name}…`},success:{message:()=>`${e.name} uploaded.`}};if(!s){const t=c(e);return i(t,d),t.then((()=>{m?m.refresh():y()})),t}{const t=new Z.PromiseDelegate;i(t.promise,d);try{let n;for(let s=0;!n;s+=ce){const a=s+ce,r=a>=e.size,i=r?-1:a/ce,o=await c(e.slice(s,a),i);r&&(n=o,t.resolve(n))}return m?m.refresh():y(),n}catch(e){throw t.reject(e),e}}}),[t,m,y]),k=(0,s.useCallback)((e=>{g(h===e?null:e)}),[h]),w=(0,s.useCallback)((()=>{v(!0)}),[]),A=(0,s.useCallback)((()=>{if(m){const e=t.delete(m.path);i(e,{success:{message:()=>`${m.path} deleted.`},pending:{message:`Deleting ${m.path}…`},error:{message:e=>{const t=`Failed to delete ${m.path}.`;return console.error(t,e),t}}}),e.finally((()=>{m.refresh()}))}v(!1)}),[t,m]),_=(0,s.useCallback)((()=>{j(!0)}),[]),I=(0,s.useCallback)((()=>{m&&n&&t.get(m.path).then((e=>{const t=n?.save(e.path,e);i(t,{success:{message:()=>`${m.path} copied to local.`},pending:{message:`Copying to local ${m.path}…`},error:{message:e=>{const t=`Failed to copy to local ${m.path}.`;return console.error(t,e),t}}}),t.finally((()=>{m.refresh()})),j(!1)}))}),[n,m]),N=(0,s.useCallback)(((e,t)=>{p(e.path===m?.path?null:{...e,refresh:t})}),[m]);return(0,S.jsxs)(c.A,{sx:{display:"grid",gridTemplateAreas:'"header" "content"'},children:[(0,S.jsxs)(c.A,{sx:{gridArea:"header",display:"flex",alignItems:"center"},children:[(0,S.jsx)(f.A,{as:"h4",sx:{fontSize:"var(--text-title-size-small)",lineHeight:"var(--text-title-lineHeight-medium)",fontWeight:"var(--text-title-weight-medium)",flex:"1 1 auto"},children:"Contents Browser"}),(0,S.jsxs)(c.A,{children:[(0,S.jsx)(ee.K,{variant:"invisible","aria-label":"Refresh contents browser.",title:"Refresh contents browser.",icon:se.A,onClick:y}),(0,S.jsx)(re.HF,{label:"Upload a file",multiple:!0,upload:C})]})]}),d?(0,S.jsx)(c.A,{sx:{gridArea:"content",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px",height:"100vh"},children:(0,S.jsx)(W.A,{})}):(0,S.jsx)(c.A,{sx:{gridArea:"content"},children:o?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(te.G,{children:o?.map((e=>(e.fileType,"directory"===e.type?(0,S.jsx)(oe,{item:e,contents:t,current:m,documentRegistry:a,onContextMenu:k,onSelect:N},e.name):(0,S.jsx)(le,{item:e,current:m?.path===e.path,onSelect:e=>{N(e,y)},onContextMenu:k},e.name))))}),(0,S.jsx)(D.W,{anchorRef:h??void 0,open:null!==h?.current,onOpenChange:()=>{g(null)},children:(0,S.jsx)(D.W.Overlay,{children:(0,S.jsxs)(P.l,{children:[(0,S.jsx)(P.l.Item,{title:"Delete the active item.",onSelect:w,children:"Delete…"}),n&&(0,S.jsx)(P.l.Item,{title:"Copy the active item to the local drive.",onSelect:_,children:"Copy to local drive…"})]})})}),x&&(0,S.jsx)(B.l,{title:"Confirm deletion",onClose:()=>{v(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:()=>{v(!1)}},{buttonType:"danger",content:"Delete",onClick:()=>{A()}}],children:`Are you sure you want to delete ${m?.path}?`}),b&&(0,S.jsx)(B.l,{title:"Confirm copy to local",onClose:()=>{j(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:()=>{j(!1)}},{buttonType:"danger",content:"Copy to local",onClick:()=>{I()}}],children:`Are you sure you want to copy to local ${m?.path}?`})]}):(0,S.jsx)(ne.A,{children:(0,S.jsx)(ne.A.Heading,{children:"No contents"})})})]})}var ue=n(46916),me=n(77108),pe=n(77606),he=n(10815),ge=n(68822);const fe=28,xe="DatalayerSpacer",ve=3e4;var be=function(e){return e.PROGRESS="var(--borderColor-accent-emphasis)",e.ERROR="var(--borderColor-danger-emphasis)",e.SUCCESS="var(--borderColor-success-emphasis)",e}(be||{});const je={"-1":be.ERROR,0:be.PROGRESS,1:be.SUCCESS};function ye({awareness:e,currentUserHandle:t}){const[n,a]=(0,s.useState)([]);return(0,s.useEffect)((()=>{const n=()=>{const n=e.getStates();a(Array.from(n.values()).filter((e=>e.user&&e.user?.name!==t&&!(e.user?.agent??"").startsWith(xe))).reduce(((e,t)=>{const n=t.user,s=!((t.notification?.timestamp??0)+ve<Date.now()),a=n.agent?{avatarUrl:"https://static.vecteezy.com/system/resources/previews/006/662/139/large_2x/artificial-intelligence-ai-processor-chip-icon-symbol-for-graphic-design-logo-web-site-social-media-mobile-app-ui-illustration-free-vector.jpg",color:n.color,displayName:n.agent,handle:"agent",initials:"AI",username:n.agent,notification:s?`${t.notification?.message} ${(0,he.g)(new Date(t.notification.timestamp))}`:void 0,notificationType:s&&void 0!==t.notification?.message_type?je[t.notification?.message_type.toString()]:void 0}:{avatarUrl:n.avatar_url,color:n.color,displayName:n.display_name,handle:n.name,initials:n.initials,username:n.username};return e.map((e=>e.username)).includes(a.username)||e.push(a),e}),[]))};n(),e.on("change",n);const s=setInterval(n,ve/3);return()=>{clearInterval(s),e.off("change",n)}}),[e,t]),(0,S.jsx)(me.A,{children:n.map((e=>{let t=`${e.displayName}\n${e.handle}`;return e.notification&&(t+=`\n${e.notification}`),(0,S.jsx)(pe.A,{sx:{border:e.notificationType?`var(--borderWidth-thick) solid ${e.notificationType}`:"none"},title:t,src:e.avatarUrl?(0,ge.$K)(e.avatarUrl):(n=e.color,s=e.initials,"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="12" fill="${n}" stroke="none" /><text x="12" y="12" fill="black">${s}</text></svg>`)),size:fe},e.displayName);var n,s}))})}var Ce=n(17810),ke=n(23530),we=n(81390),Ae=n(64991);var Se=n(48716),_e=n(54087),Ie=n(320),Ne=n(44536),Re=n(27199),Te=n(97283),De=n(7282);const Ee=(0,Te.y)(((e,t)=>({datasources:[],updateDatasources:t=>e((e=>({datasources:t})))})));function Pe(e){return(0,De.Pj)(Ee,e)}var $e=n(20614),Me=n(88037),Ue=n(41630);function Le(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ze extends Me._Q{constructor(e){super(),Le(this,"_rows",void 0),Le(this,"_mimeType",void 0),this._mimeType=e.mimeType,this._rows=[]}renderModel(e){const t=e.data[this._mimeType].split("\n").map((e=>e.split(";")));return this._rows=t,Promise.resolve()}render(){return 0===(this._rows.length>0?this._rows[0].length:0)?(0,S.jsx)("div",{children:"No data found!"}):(0,S.jsx)(Ue.NP,{children:this._rows.map((e=>(0,S.jsx)(c.A,{mt:3,children:e})))})}}const Ve={safe:!0,mimeTypes:["application/vnd.datalayer.csv"],createRenderer:e=>new ze(e)};var Oe=n(25344),Fe=n(14809),We=n(17310),Ge=n(16181);function Ke(e){const{createAIAgent:t}=(0,Ae.w)(),{aiAgents:n,addAIAgent:a}=(0,we.Ks)(),{cell:r,extensionProps:i}=e,{notebookId:o}=i,[l,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(),[f,x]=(0,s.useState)({prompt:""}),[b,j]=(0,s.useState)({prompt:void 0});(0,s.useEffect)((()=>{const e=(e,t)=>{if("datalayer"==t.key&&m)for(const e of r.model.sharedModel.getMetadata("datalayer")?.ai?.messages??[])if(e.parent_id===m){h(void 0);break}};return r.model.sharedModel.metadataChanged.connect(e),()=>{r.model?.sharedModel.metadataChanged.disconnect(e)}}),[r,m]),(0,s.useEffect)((()=>{m||u(!1)}),[m]),(0,s.useEffect)((()=>{j({...b,prompt:void 0===f.prompt?void 0:f.prompt.length>0})}),[f]);const y=(0,s.useCallback)((async()=>{const e=i.panel.context.sessionContext.session?.kernel,s=e?.serverSettings,l=e?.id;n.find((e=>e.documentId==o&&e.runtimeId==l))||(await t(o,"notebook_persist",s?.baseUrl,s?.token,l),a({documentId:o,runtimeId:l}));const c=(0,Ge.f)();!function(e,t,n){const s=e.model.getMetadata("datalayer")??{},a=s.ai??{prompts:[],messages:[]},r=a.prompts??[];r.push({id:t,prompt:n,username:void 0,timestamp:Date.now()}),a.prompts=r,s.ai=a,e.model.setMetadata("datalayer",s),console.log("---",s)}(r,c,f.prompt),h(c)}),[n,r,i.panel.context.sessionContext.session?.kernel,f.prompt,o,t]),C=(0,s.useCallback)((e=>{e.ctrlKey&&"Enter"===e.key&&y()}),[y]);return(0,S.jsx)(Ue.NP,{children:(0,S.jsx)(c.A,{display:"flex",style:{justifyContent:"right"},children:(0,S.jsx)(c.A,{className:"dla-cell-ai-agent-button",children:(0,S.jsxs)(D.W,{open:l,onOpenChange:e=>u(e),children:[(0,S.jsx)(D.W.Anchor,{id:"custom-anchor-id",children:(0,S.jsx)(ee.K,{icon:v.SD8,variant:"invisible","aria-label":"AI Agents menu"})}),(0,S.jsx)(D.W.Overlay,{width:"large",children:(0,S.jsxs)(c.A,{as:"form",m:3,children:[(0,S.jsxs)(p.A,{children:[(0,S.jsx)(p.A.Label,{visuallyHidden:!0}),(0,S.jsx)(g.Ay,{block:!0,value:f.prompt,onChange:e=>{x((t=>({...t,prompt:e.target.value})))},disabled:!!m,onKeyDown:C})]}),(0,S.jsxs)(c.A,{sx:{display:"flex",width:"100%",gap:"2px",marginTop:"var(--stack-gap-normal)"},children:[(0,S.jsx)(c.A,{flexGrow:1}),(0,S.jsx)(d.Q,{onClick:e=>u(!1),variant:"default",children:"Cancel"}),(0,S.jsx)(d.Q,{leadingVisual:We.A,onClick:y,disabled:!b.prompt||!!m,variant:"primary",children:m?(0,S.jsx)(W.A,{size:"small"}):"Ask AI"})]})]})})]})})})})}var Be=n(94247);const Qe=e=>{const{cell:t}=e,{datasources:n}=Pe(),[a,r]=(0,s.useState)();(0,s.useEffect)((()=>{const e=(e,t)=>{if("datalayer"==(t?.key??"datalayer")){const t=(e=>{const t=e.getMetadata("datalayer");if(t){const e=t.datasource;if(e)return e.id}})(e);if(t)for(const e of n)if(t===e.id){r(t);break}}};return e(t.model),t.model.metadataChanged.connect(e),()=>{t.model?.metadataChanged.disconnect(e)}}),[t,n]);const i=e=>{const n=t.model.getMetadata("datalayer");e?(t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{id:e.id,variant:e.variant,name:e.name,description:e.description,database:e.database,outputBucket:e.outputBucket,destinationVar:"df"}}),r(e.id),t.editor.model.mimeType=Be.bd):(t.model.setMetadata("datalayer",{...n,sql:!1,datasource:{}}),r(void 0),t.editor.model.mimeType=Be.dC)};return(0,S.jsx)(Ue.NP,{children:(0,S.jsx)(c.A,{display:"flex",style:{justifyContent:"right"},children:(0,S.jsx)(c.A,{className:"dla-cell-datasource-button",children:(0,S.jsxs)(D.W,{children:[(0,S.jsx)(D.W.Anchor,{id:"custom-anchor-id",children:(0,S.jsx)(ee.K,{icon:v.bN0,variant:"invisible","aria-label":"Open Datasources menu"})}),(0,S.jsx)(D.W.Overlay,{width:"medium",children:(0,S.jsx)(P.l,{selectionVariant:"single",showDividers:!0,children:(0,S.jsxs)(P.l.Group,{children:[(0,S.jsx)(P.l.GroupHeading,{children:"Datasources"}),0===n.length&&(0,S.jsxs)(P.l.Item,{onSelect:()=>{},children:["No Datasource available",(0,S.jsx)(P.l.Description,{variant:"block",children:"Create a new Datasource to connect your cell."})]}),n.map((e=>(0,S.jsxs)(P.l.Item,{onSelect:()=>i(e),selected:e.id===a,children:[e.name,(0,S.jsx)(P.l.Description,{variant:"block",children:e.description})]},e.id))),(0,S.jsx)(P.l.Divider,{}),(0,S.jsx)(P.l.Item,{children:(0,S.jsxs)(p.A,{children:[(0,S.jsx)(p.A.Label,{children:"Output Dataframe"}),(0,S.jsx)(h.A,{size:"small",value:"df",disabled:!0})]})}),(0,S.jsx)(P.l.Divider,{}),(0,S.jsx)(P.l.Item,{variant:"danger",onSelect:()=>i(void 0),children:"None"})]})})})]})})})})};function He(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const qe="dla-CellToolbar-Container";class Je extends Me._Q{constructor(e,t){super(),He(this,"_cell",void 0),He(this,"_props",void 0),this._cell=e,this._props=t,this.addClass(qe)}render(){return(0,S.jsxs)(c.A,{display:"flex",children:[(0,S.jsx)(c.A,{flexGrow:1}),(0,S.jsxs)(a.fS,{initialEntries:["/"],children:[(0,S.jsx)(a.BV,{children:(0,S.jsx)(a.qh,{path:"*",element:(0,S.jsx)(Ke,{cell:this._cell,extensionProps:this._props})})}),(0,S.jsx)(Qe,{cell:this._cell,extensionProps:this._props})]})]})}}function Xe(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ye extends Fe.x0{constructor(e,t){super(),Xe(this,"_panel",void 0),Xe(this,"_props",void 0),this._panel=e,this._props=t,this.updateConnectedCell=this.updateConnectedCell.bind(this);const n=()=>{const e=this._panel.content.model?.cells;if(e){e.changed.connect(this.updateConnectedCell);for(let t=0;t<e.length;++t)this._registerCellChanges(e.get(t))}};n(),this._panel.content.modelChanged.connect((()=>{n()}))}updateConnectedCell(e,t){t.oldValues.forEach(this._deregisterCellChanges.bind(this)),t.newValues.forEach(this._registerCellChanges.bind(this))}_deregisterCellChanges(e){}_registerCellChanges(e){const t=this._getCodeCell(e);t?(t.displayChanged.connect((()=>{this._updateCodeCell(t)})),t.inViewportChanged.connect((()=>{this._updateCodeCell(t)})),this._updateCodeCell(t)):"code"===e.type&&console.error(`Could not find code cell for model: ${e}`)}_getCodeCell(e){return"code"===e.type?this._panel.content.widgets.find((t=>t.model===e)):null}_updateCodeCell(e){if(e.inputArea){const t=e.layout;if(t){const n=t;n.widgets[1].hasClass(qe)||n.insertWidget(1,new Je(e,this._props))}}}}class Ze{constructor(){var e,t,n;e=this,n=void 0,(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t="_props"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}init(e){this._props=e}createNew(e,t){new Ye(e,this._props)}get component(){return null}}const et=new b.Od;function tt(){const{notebookId:e}=(0,a.g)();if(!e)return(0,S.jsx)(S.Fragment,{});const t=(0,Ce.J)(),b=(0,o.S)(),A=(0,ke.Z)(),N=function(e){const{getAIAgent:t}=(0,Ae.w)(),{aiAgents:n,addAIAgent:a,deleteAIAgent:r,updateAIAgent:i}=(0,we.Ks)();return(0,s.useEffect)((()=>{let s;const o=setInterval((async()=>{s=new AbortController;try{const o=await t(e,{signal:s.signal});if(!o.success)return void r(e);const l=n.find((t=>t.documentId==e)),c=o.agent.runtime?.id;l?l.runtimeId!==c&&i(e,c):a({documentId:e,runtimeId:c})}catch(t){r(e)}}),6e4);return()=>{s?.abort("Component unmounted"),clearInterval(o)}}),[n,e]),n.find((t=>t.documentId===e))}(e),{checkIsPlatformFeaturesPreviewer:R}=(0,Se.x)(),T=R(t),{configuration:D}=(0,Ie._O)(),{credits:E,token:P}=(0,Ne.Y)(),{configuration:$,multiServiceManager:M,jupyterLabAdapter:U,remoteKernels:z}=(0,L.xb)(),[F,W]=(0,s.useState)(et),[G,K]=(0,s.useState)(void 0),[B,J]=(0,s.useState)(),[Y,Z]=(0,s.useState)(!1),[ee,te]=(0,s.useState)(),[ne,se]=(0,s.useState)(!1),[ae,re]=(0,s.useState)(!0),[ie,oe]=(0,s.useState)(""),[le,ce]=(0,s.useState)(null),[me,pe]=(0,s.useState)(),[he,ge]=(0,s.useState)(),[fe,xe]=(0,s.useState)(null),[ve,be]=(0,s.useState)({name:"",nameConfirm:"",description:""}),[je,Te]=(0,s.useState)({name:void 0,nameConfirm:void 0,description:void 0}),{enqueueToast:De,trackAsyncTask:Ee}=(0,Q.d)(),{selectNotebookModel:Me,reset:Ue}=(0,j.Gx)(),{hideBackdrop:Le,screenCapture:ze,setItem:Fe,setScreenCapture:We,showBackdrop:Ge,showScreenshot:Ke,space:Be,triggerItemsRefresh:Qe}=(0,Re.l5)(),{cloneNotebook:He,deleteItem:qe,getDatasources:Je,getNotebook:Xe,refreshDatasources:Ye,refreshNotebook:tt,updateNotebook:nt,updateNotebookModel:st}=(0,_e.E)(),{updateDatasources:at}=Pe(),{updateAIAgent:rt}=(0,we.Ks)(),{patchAIAgent:it}=(0,Ae.w)(),ot=(0,s.useMemo)((()=>({baseURL:D.spacerRunUrl,token:P,roomName:e,type:"datalayer"})),[D.spacerRunUrl,e,P]),lt=(0,s.useMemo)((()=>[new Ze,new y._({factory:C.N})]),[]),ct=(0,s.useMemo)((()=>new i.J),[]),dt=(0,s.useMemo)((()=>[Ve]),[]),ut=(0,s.useMemo)((()=>(0,$e.Kp)()),[]);(0,s.useEffect)((()=>{if(z&&z.length>0&&!ee){const e=z[0];pt({runtimeDesc:{name:e.environment_name,language:"",location:"remote",displayName:e.kernel_given_name,id:e.id,burningRate:e.burning_rate,podName:e.jupyter_pod_name},kernelModel:e})}}),[z]),(0,s.useEffect)((()=>{le&&le.sharedModel.awareness.setLocalStateField("user",{username:t.id,name:t.handle,display_name:t.displayName,initials:`${t.firstName[0]?.toLocaleUpperCase()??"?"}${t.lastName[0]?.toLocaleUpperCase()||"?"}`,color:ut,avatar_url:t.avatarUrl})}),[le,t,ut]),(0,s.useEffect)((()=>(Ge(),tt(e).then((t=>{if(Le(),t.success){const t=Xe(e);t?(pe(t),ge(t.nbformat),Fe(t),be({name:t.name,nameConfirm:"",description:t.description})):A("/")}else De(t.message,{variant:"error"})})).finally((()=>{Le()})),()=>{F.dispose(),pe(void 0),Ue(),Fe(void 0)})),[e]),(0,s.useEffect)((()=>{Ye().then((e=>{if(e.success){const e=Je();at(e)}}))}),[e]),(0,s.useEffect)((()=>{N&&ie&&N.runtimeId!==G&&(it(e,F.serverSettings.baseUrl,F.serverSettings.token,G),rt(e,G))}),[N,G,e,ie,F]),(0,s.useEffect)((()=>{Te({...je,name:void 0===ve.name?void 0:ve.name.length>2,nameConfirm:ve.nameConfirm===me?.name,description:void 0===ve.description?void 0:ve.description.length>2})}),[ve]);const mt=(0,s.useCallback)((async()=>{Ge(),nt(e,ve.name,ve.description).then((e=>{e.success&&(De("The notebook is successfully updated.",{variant:"success"}),Qe(),pe({...me,name:ve.name,description:ve.description}))})).finally((()=>{Le()}))}),[e,ve.name,ve.description,me]),pt=(0,s.useCallback)((async({runtimeDesc:s,kernelModel:a,transferState:i})=>{const o=Me(e);o?.model&&ge(o.model.toJSON()),J(s);const l=s?.location;switch(oe(""),l){case void 0:K(void 0),re(!0),Z(!1),W(et);break;case"browser":if(M?.browser){if(U){if(!U.jupyterLab.hasPlugin("@jupyterlite/pyodide-kernel-extension:kernel")){const e=await Promise.all([n.e(484),n.e(5378)]).then(n.bind(n,28924));U.jupyterLab.registerPluginModule(e)}U.jupyterLab.isPluginActivated("@jupyterlite/pyodide-kernel-extension:kernel")||await U.jupyterLab.activatePlugin("@jupyterlite/pyodide-kernel-extension:kernel")}K(void 0),re(!1),Z(!0),W(M.browser)}else console.error("Unable to use browser kernel. No service manager for it.");break;case"remote":{if(!M?.remote){console.error("Unable to use a remote kernel. No service manager for it.");break}let e;if(i&&F&&F===M?.browser&&ee?.kernel)try{Ge();let t=!0;const n=ee.kernel.id,s=`pyodide-${n}`,a=(0,q._)({connection:ee.kernel,metadata:{filename:`${s}.data`},onUploadProgress:()=>{t&&(t=!1,(0,H.v2)().then((t=>{e=t.find((e=>e.name===s))})))}});if(Ee(a,{error:{message:e=>`Failed to save the browser kernel state. ${e}`},pending:{message:"Saving the browser kernel state…"},success:{message:()=>"Browser kernel state saved."}}),await a,!e)throw Error("Unable to find snapshot for pyodide state.");await M.browser.kernels.shutdown(n)}finally{Le()}if(!a){const{name:n,displayName:r,params:i}=s,o=await(M?.remote?.kernels.startNew({name:n,kernelType:"notebook",givenName:r,creditsLimit:i?.creditsLimit??(E?.available??0)/Math.max($.maxCellKernels-z.filter((e=>"cell"!==e.kernel_type)).length,1),capabilities:i?.capabilities,snapshot:e?.id},{username:t?.handle,handleComms:!0}));a=await M.remote.kernels.findById(o.id),o.dispose()}Z(!1),K(a.id),re(!1);const n=M.remote.kernels.getServices(a.jupyter_pod_name);oe(a.jupyter_pod_name);const o=new r.ServiceManager({contents:n?.contents,kernels:n?.kernels,kernelspecs:n?.kernelspecs,serverSettings:n?.serverSettings,sessions:n?.sessions,events:{dispose:()=>{}},terminals:{connectionFailure:{connect:()=>{}},dispose:()=>{},isAvailable:()=>!1}});W(o),xe("storage");break}}ft(void 0)}),[$,E,U,e,M,z,F,ee]),ht=(0,s.useCallback)((async t=>{b({title:"Are you sure?",content:"Please confirm you want to clone this notebook in your private library."}).then((t=>{t&&(Ge(),He(e).then((e=>{Le(),e.success&&(De(e.message,{variant:"success"}),Qe(),A("/my-library"))})))}))}),[b,me]),gt=(0,s.useCallback)((e=>{ce(e)}),[]),ft=(0,s.useCallback)((e=>{te(e||void 0)}),[]),xt=(0,s.useCallback)((()=>{if(!ae&&le?.cells){Ge("Saving the notebook...");const t=le.toJSON();st(e,t).then((n=>{n.success&&(De("The notebook is successfully updated.",{variant:"success"}),pe({...me,id:e,nbformat:t}))})).finally((()=>{Le()}))}}),[e,le,ae]),vt=(0,s.useCallback)((()=>{xe("storage"!==fe&&F&&F!==et?"storage":null)}),[fe,F]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(l.z,{"aria-label":"Notebook Editor",children:[(0,S.jsx)(l.z.TitleArea,{variant:"subtitle",children:(0,S.jsx)(l.z.Title,{children:"Notebook Editor"})}),(0,S.jsx)(l.z.Actions,{children:me&&Be&&(0,S.jsxs)(c.A,{sx:{flex:"0 0 auto",display:"flex",alignItems:"center"},children:[M?.remote&&ee&&ee.kernel&&(0,S.jsx)(O.m,{kernelId:ee.kernel.id,serviceManager:M.remote,onClick:()=>{A("/runtimes")}},"credits-indicator"),(0,S.jsx)(V,{assignKernel:pt,sessionConnection:ee},"kernel-picker"),(0,S.jsx)(X,{connection:ee?.kernel??void 0,multiServiceManager:M,podName:ie,disabled:void 0===B?.location,children:"Snapshots"}),(0,S.jsx)(d.Q,{title:"Browse content on the Remote Runtime",variant:"invisible",size:"small",disabled:!F||F===et,leadingVisual:()=>(0,S.jsx)(I.Cx,{type:"content"}),onClick:vt,children:"Storage"},"content"),(0,S.jsx)(ue.E,{commandRegistry:ct,runtimeDesc:B,save:xt,sessionConnection:ee},"toolbar"),(0,S.jsx)(d.Q,{variant:"invisible",size:"small",leadingVisual:v.Nc$,onClick:ht,children:"Duplicate"},"clone"),T&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(d.Q,{title:"Capture screen",variant:"invisible",size:"small",leadingVisual:()=>(0,S.jsx)(v.rVi,{}),onClick:()=>{Ke()},children:"Capture"},"capture-screen"),(0,S.jsx)(d.Q,{title:"Share",variant:"invisible",size:"small",leadingVisual:()=>(0,S.jsx)(I.Cx,{type:"share"}),onClick:e=>se(!ne),children:"Share"},"share"),(0,S.jsx)(d.Q,{variant:"invisible",size:"small",leadingVisual:()=>(0,S.jsx)(I.Cx,{type:"page"}),onClick:t=>A(`/new/page/notebook/${e}`),children:"Publish"},"public")]}),(0,S.jsx)(d.Q,{variant:"invisible",size:"small",leadingVisual:v.L64,onClick:e=>{xe("properties"===fe?null:"properties")},children:"Properties"},"properties"),"datalayer"===ot.type&&le&&(0,S.jsx)(ye,{awareness:le.sharedModel.awareness,currentUserHandle:t.handle},"peers")]})})]}),(0,S.jsxs)(u.O7,{children:[(0,S.jsxs)(u.O7.Content,{"aria-label":"Notebook Editor",width:"full",padding:"none",children:[ze&&(0,S.jsx)(c.A,{mt:3,children:(0,S.jsxs)(c.A,{display:"flex",children:[(0,S.jsx)(c.A,{children:(0,S.jsx)("img",{src:ze})}),(0,S.jsx)(c.A,{children:(0,S.jsx)(m.A,{href:"javascript: return false;",onClick:e=>We(void 0),children:(0,S.jsx)(v.uv5,{})})})]})}),ne&&(0,S.jsx)(c.A,{sx:{flexGrow:1},children:(0,S.jsx)(Oe.a,{})}),he&&(void 0===B?.location?(0,S.jsx)(c.A,{sx:{"& .jp-Cell":{marginTop:30}},children:(0,S.jsx)(k.j,{nbformat:he,outputs:!0})}):(0,S.jsx)(c.A,{sx:{"& .jp-WindowedPanel":{margin:0},"& .jp-WindowedPanel-viewport":{padding:0},"& .dla-CellSidebar-Container":{position:"relative",marginLeft:"auto"},"& .jp-Cell .dla-CellSidebar-Container":{display:"none"},"& .jp-Cell.jp-mod-active .dla-CellSidebar-Container":{display:"block"}},children:(0,S.jsx)(w.k,{commands:ct,extensions:lt,id:e,collaborationServer:ot,nbformat:he,readonly:ae,renderers:dt,kernelId:G,serviceManager:F,startDefaultKernel:Y,height:"calc(100vh - 150px)",maxHeight:"calc(100vh - 150px)",cellSidebarMargin:32,onNotebookModelChanged:gt,onSessionConnection:ft})}))]}),null!==fe&&(0,S.jsx)(u.O7.Pane,{"aria-label":"storage"===fe?"Remote Runtime Storage":"Notebook Properties",position:"start",width:"large",children:"storage"===fe&&F.contents?(0,S.jsx)(de,{contents:F.contents,documentRegistry:U?.jupyterLab.docRegistry}):"properties"===fe?(0,S.jsxs)(c.A,{as:"form",sx:{label:{marginTop:2}},children:[(0,S.jsxs)(p.A,{children:[(0,S.jsx)(p.A.Label,{children:"Name"}),(0,S.jsx)(h.A,{block:!0,value:ve.name,onChange:e=>{be((t=>({...t,name:e.target.value})))}}),!1===je.name&&(0,S.jsx)(p.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,S.jsxs)(p.A,{children:[(0,S.jsx)(p.A.Label,{children:"Description"}),(0,S.jsx)(g.Ay,{block:!0,value:ve.description,onChange:e=>{be((t=>({...t,description:e.target.value})))}}),!1===je.description&&(0,S.jsx)(p.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,S.jsx)(p.A,{children:(0,S.jsx)(d.Q,{variant:"primary",disabled:!je.name||!je.description,sx:{marginTop:2},onClick:mt,children:"Update Notebook Properties"})}),(0,S.jsx)(c.A,{mt:3}),(0,S.jsx)(_,{variant:"default",data:he,fileName:`notebook-${e}`,extension:"ipynb"}),(0,S.jsxs)(c.A,{sx:{marginTop:3},children:[(0,S.jsx)(f.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",color:"danger.fg",mb:2},children:"Danger zone"}),(0,S.jsxs)(c.A,{sx:{border:"1px solid",borderColor:"danger.emphasis",borderRadius:2,p:3,alignItems:"center",justifyContent:"space-between",gap:3},children:[(0,S.jsxs)(c.A,{sx:{display:"grid",gap:1},children:[(0,S.jsx)(x.A,{sx:{fontSize:1,fontWeight:"bold",color:"danger.fg"},children:"Confirm the notebook name to delete"}),(0,S.jsx)(p.A,{children:(0,S.jsx)(h.A,{block:!0,value:ve.nameConfirm,onChange:e=>{be((t=>({...t,nameConfirm:e.target.value})))}})}),(0,S.jsx)(x.A,{sx:{fontSize:1,color:"fg.muted"},children:"This operation is not reversible."})]}),(0,S.jsx)(d.Q,{variant:"danger",disabled:!je.nameConfirm,onClick:async()=>{Ge("Deleting the notebook..."),qe(me.id).then((e=>{e.success&&(De("The notebook is successfully deleted.",{variant:"success"}),A("/my-library"))})).finally((()=>{Le()}))},children:"Delete notebook"})]})]})]}):(0,S.jsx)(S.Fragment,{})})]})]})}const nt=tt},46916:(e,t,n)=>{n.d(t,{E:()=>l});var s=n(71791),a=n(99180),r=n(38621),i=n(9387),o=n(18683);function l(e){const{commandRegistry:t,runtimeDesc:n,save:l,sessionConnection:c}=e,[d,u]=(0,i.useState)();return(0,i.useEffect)((()=>{const e=()=>{u(c?.kernel?.status)};return e(),c?.statusChanged.connect(e),c?.connectionStatusChanged.connect(e),()=>{c?.statusChanged.disconnect(e),c?.connectionStatusChanged.disconnect(e)}}),[c]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.Q,{variant:"invisible",size:"small",leadingVisual:r.udU,disabled:!n?.location||"busy"===d,onClick:e=>t?.execute(s.nx.runAll),children:"Run all"}),(0,o.jsx)(a.Q,{variant:"invisible",size:"small",leadingVisual:r.wFz,disabled:!n?.location||"busy"!==d,onClick:e=>t?.execute(s.nx.interrupt),children:"Interrupt"})]})}},64991:(e,t,n)=>{n.d(t,{w:()=>i});var s=n(49370),a=n(320),r=n(63711);const i=(e="api/ai-agents/v1")=>{const{configuration:t}=(0,a._O)(),{requestRun:n}=(0,s.X)({notifyOnError:!1});return{createAIAgent:(s,a,i,o,l,{signal:c,baseUrl:d=e}={})=>n({url:r.URLExt.join(t.aiagentsRunUrl,d,"agents"),method:"POST",body:{room_id:s,room_type:a,runtime:{ingress:i,token:o,kernel_id:l}},signal:c}),getAIAgents:({signal:s,baseUrl:a=e}={})=>n({url:r.URLExt.join(t.aiagentsRunUrl,a,"agents"),method:"GET",signal:s}),deleteAIAgent:(s,{signal:a,baseUrl:i=e}={})=>n({url:r.URLExt.join(t.aiagentsRunUrl,i,"agents",s),method:"DELETE",signal:a}),getAIAgent:(s,{signal:a,baseUrl:i=e}={})=>n({url:r.URLExt.join(t.aiagentsRunUrl,i,"agents",s),method:"GET",signal:a}),patchAIAgent:(s,a,i,o,{signal:l,baseUrl:c=e}={})=>n({url:r.URLExt.join(t.aiagentsRunUrl,c,"agents",s),method:"PATCH",body:{runtime:a&&i&&o?{ingress:a,token:i,kernel_id:o}:null},signal:l})}}},81390:(e,t,n)=>{n.d(t,{Ks:()=>i});var s=n(97283),a=n(7282);const r=(0,s.y)((e=>({aiAgents:[],addAIAgent:t=>{e((e=>e.aiAgents.includes(t)?{}:{aiAgents:e.aiAgents.concat([t])}))},deleteAIAgent:t=>{e((e=>({aiAgents:e.aiAgents.filter((e=>e.documentId===t))})))},updateAIAgent:(t,n)=>{e((e=>{const s=e.aiAgents.findIndex((e=>e.documentId===t));return s>=0?(e.aiAgents[s].runtimeId=n,{aiAgents:[...e.aiAgents]}):{}}))}})));function i(e){return(0,a.Pj)(r,e)}}}]);