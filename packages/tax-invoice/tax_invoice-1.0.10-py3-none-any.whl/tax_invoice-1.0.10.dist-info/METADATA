Metadata-Version: 2.4
Name: tax-invoice
Version: 1.0.10
Summary: å‘ç¥¨SDK Python ç”µå­å‘ç¥¨/æ•°ç”µå‘ç¥¨/å…¨ç”µå‘ç¥¨/æ•°ç”µç¥¨/å¼€ç¥¨
Home-page: https://github.com/fapiaoapi/invoice-python-sdk
Author: yuejianghe
Author-email: yuejianghe@qq.com
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.6
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: requests>=2.25.0
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# ç”µå­å‘ç¥¨/æ•°ç”µå‘ç¥¨ Python SDK | å¼€ç¥¨ã€éªŒçœŸã€çº¢å†²ä¸€ç«™å¼é›†æˆ

[![PyPI version](https://img.shields.io/pypi/v/tax-invoice.svg)](https://pypi.org/project/tax-invoice/)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://github.com/fapiaoapi/invoice-sdk-python/blob/master/LICENSE)
[![Python 3.7+](https://img.shields.io/badge/Python-3.7%2B-blue.svg)](https://www.python.org/downloads/)

**å‘ç¥¨ Python SDK** ä¸“ä¸ºç”µå­å‘ç¥¨ã€æ•°ç”µå‘ç¥¨ï¼ˆå…¨ç”µå‘ç¥¨ï¼‰åœºæ™¯è®¾è®¡ï¼Œæ”¯æŒ**å¼€ç¥¨ã€çº¢å†²ã€ç‰ˆå¼æ–‡ä»¶ä¸‹è½½**ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿«é€Ÿå¯¹æ¥ç¨åŠ¡å¹³å°APIã€‚

**å…³é”®è¯**: ç”µå­å‘ç¥¨SDK,æ•°ç”µç¥¨Python,å¼€ç¥¨æ¥å£,å‘ç¥¨api,å‘ç¥¨å¼€å…·,å‘ç¥¨çº¢å†²,å…¨ç”µå‘ç¥¨é›†æˆ

---

## ğŸ“– æ ¸å¿ƒåŠŸèƒ½

### åŸºç¡€è®¤è¯
- âœ… **è·å–æˆæƒ** - å¿«é€Ÿæ¥å…¥ç¨åŠ¡å¹³å°èº«ä»½è®¤è¯
- âœ… **äººè„¸äºŒç»´ç ç™»å½•** - æ”¯æŒæ•°ç”µå‘ç¥¨å¹³å°æ‰«ç ç™»å½•
- âœ… **è®¤è¯çŠ¶æ€æŸ¥è¯¢** - å®æ—¶è·å–çº³ç¨äººèº«ä»½çŠ¶æ€

### å‘ç¥¨å¼€å…·
- ğŸŸ¦ **æ•°ç”µè“ç¥¨å¼€å…·** - æ”¯æŒå¢å€¼ç¨æ™®é€š/ä¸“ç”¨ç”µå­å‘ç¥¨
- ğŸ“„ **ç‰ˆå¼æ–‡ä»¶ä¸‹è½½** - è‡ªåŠ¨è·å–é”€é¡¹å‘ç¥¨PDF/OFD/XMLæ–‡ä»¶

### å‘ç¥¨çº¢å†²
- ğŸ” **çº¢å†²å‰è“ç¥¨æŸ¥è¯¢** - ç²¾ç¡®æ£€ç´¢å¾…çº¢å†²çš„ç”µå­å‘ç¥¨
- ğŸ›‘ **çº¢å­—ä¿¡æ¯è¡¨ç”³è¯·** - ç”Ÿæˆçº¢å†²å‡­è¯
- ğŸ”„ **è´Ÿæ•°å‘ç¥¨å¼€å…·** - è‡ªåŠ¨åŒ–çº¢å†²æµç¨‹

---

## ğŸš€ å¿«é€Ÿå®‰è£…

```bash
pip install tax-invoice
```

[ğŸ“¦ æŸ¥çœ‹pypiåœ°å€](https://pypi.org/project/tax-invoice/ "å‘ç¥¨sdk")

---



[ğŸ“š æŸ¥çœ‹å®Œæ•´ä¸­æ–‡æ–‡æ¡£](https://fa-piao.com/doc.html) | [ğŸ’¡ æ›´å¤šç¤ºä¾‹ä»£ç ](https://github.com/fapiaoapi/invoice-sdk-python/tree/master/examples)

---

## ğŸ” ä¸ºä»€ä¹ˆé€‰æ‹©æ­¤SDKï¼Ÿ
- **ç²¾å‡†è¦†ç›–ä¸­å›½æ•°ç”µå‘ç¥¨æ ‡å‡†** - ä¸¥æ ¼éµå¾ªå›½å®¶æœ€æ–°æ¥å£è§„èŒƒ
- **å¼€ç®±å³ç”¨** - æ— éœ€å¤„ç†XML/ç­¾åç­‰åº•å±‚ç»†èŠ‚ï¼Œä¸“æ³¨ä¸šåŠ¡é€»è¾‘
- **ä¼ä¸šçº§éªŒè¯** - å·²åœ¨ç”Ÿäº§ç¯å¢ƒå¤„ç†è¶…100ä¸‡å¼ ç”µå­å‘ç¥¨

---

## ğŸ“Š æ”¯æŒçš„å¼€ç¥¨ç±»å‹
| å‘ç¥¨ç±»å‹       | çŠ¶æ€   |
|----------------|--------|
| æ•°ç”µå‘ç¥¨ï¼ˆæ™®é€šå‘ç¥¨ï¼‰ | âœ… æ”¯æŒ |
| æ•°ç”µå‘ç¥¨ï¼ˆå¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ï¼‰ | âœ… æ”¯æŒ |
| æ•°ç”µå‘ç¥¨ï¼ˆé“è·¯ç”µå­å®¢ç¥¨ï¼‰  | âœ… æ”¯æŒ |
| æ•°ç”µå‘ç¥¨ï¼ˆèˆªç©ºè¿è¾“ç”µå­å®¢ç¥¨è¡Œç¨‹å•ï¼‰ | âœ… æ”¯æŒ  |
| æ•°ç”µç¥¨ï¼ˆäºŒæ‰‹è½¦é”€å”®ç»Ÿä¸€å‘ç¥¨ï¼‰ | âœ… æ”¯æŒ  |
| æ•°ç”µçº¸è´¨å‘ç¥¨ï¼ˆå¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ï¼‰ | âœ… æ”¯æŒ  |
| æ•°ç”µçº¸è´¨å‘ç¥¨ï¼ˆæ™®é€šå‘ç¥¨ï¼‰ | âœ… æ”¯æŒ  |
| æ•°ç”µçº¸è´¨å‘ç¥¨ï¼ˆæœºåŠ¨è½¦å‘ç¥¨ï¼‰ | âœ… æ”¯æŒ  |
| æ•°ç”µçº¸è´¨å‘ç¥¨ï¼ˆäºŒæ‰‹è½¦å‘ç¥¨ï¼‰ | âœ… æ”¯æŒ  |

---

## ğŸ¤ è´¡çŒ®ä¸æ”¯æŒ
- æäº¤Issue: [é—®é¢˜åé¦ˆ](https://github.com/fapiaoapi/invoice-sdk-python/issues)
- å•†åŠ¡åˆä½œ: yuejianghe@qq.com
```bash
from tax.invoice import InvoiceClient
from tax.invoice.utils.other import calculate_tax
import time
import traceback  # æ–°å¢å¯¼å…¥

# é…ç½®ä¿¡æ¯
appKey = "YOUR_APP_KEY"""
appSecret = "YOUR_APP_SECRET"
nsrsbh = "91500112MADFAQ9xxx"  # ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç 
title = "é‡åº†æ‚¦æ±Ÿæ²³ç§‘æŠ€æœ‰é™å…¬å¸"  # åç§°ï¼ˆè¥ä¸šæ‰§ç…§ï¼‰
username = "1912284xxxx"  # æ‰‹æœºå·ç ï¼ˆç”µå­ç¨åŠ¡å±€ï¼‰
password = ""  # ä¸ªäººç”¨æˆ·å¯†ç ï¼ˆç”µå­ç¨åŠ¡å±€ï¼‰
sf = "01"  # èº«ä»½ï¼ˆç”µå­ç¨åŠ¡å±€ï¼‰
fphm = "24502000000045823936"
token = ""


# åˆå§‹åŒ–å®¢æˆ·ç«¯
client = InvoiceClient(
    app_key=appKey,
    app_secret=appSecret,
    base_url="https://api.fa-piao.com"
)



try:
    # è·å–æˆæƒ
    if token :
        client.auth.set_token(token)
    else:
        auth_response = client.auth.get_authorization(nsrsbh=nsrsbh)
        if auth_response.get("code") == 200:
            print(f"æˆæƒæˆåŠŸï¼ŒToken: {auth_response.get('data', {}).get('token')}")
            token = auth_response.get('data', {}).get('token')

    # è·å–è®¤è¯çŠ¶æ€
    status_response = client.auth.query_face_auth_state(nsrsbh=nsrsbh, username=username)
    status_code = status_response.get("code")

    if status_code == 200:
        print("è®¤è¯çŠ¶æ€: æ— éœ€è®¤è¯")
        
        # amount = 200
        # taxRate = 0.01
        # isIncludeTax = False # æ˜¯å¦å«ç¨
        # # ç¨é¢è®¡ç®—
        # se =  float(calculate_tax(amount,taxRate,isIncludeTax))  # å¼ºåˆ¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°
        # print("ä»·ç¨åˆè®¡ï¼š" + str(amount))
        # print("ç¨ç‡ï¼š" + str(taxRate))
        # print("åˆè®¡é‡‘é¢ï¼š" + str(amount - se))
        # print(("å«ç¨" if isIncludeTax else "ä¸å«ç¨") + " åˆè®¡ç¨é¢ï¼š" + str(se))

        # å¼€å…·è“ç¥¨ç¤ºä¾‹
        invoice_params = {
            "fpqqlsh": appKey + str(int(time.time() * 1000)),
            "fplxdm": "82",
            "kplx": "0",
            "xhdwsbh": nsrsbh,
            "xhdwmc": title,
            "xhdwdzdh": "é‡åº†å¸‚æ¸åŒ—åŒºä»™æ¡ƒè¡—é“æ±‡ä¸šè¡—1å·17-2 19122840xxxx",
            "xhdwyhzh": "ä¸­å›½å·¥å•†é“¶è¡Œ 310008670920023xxxx",
            "ghdwmc": "ä¸ªäºº",
            "zsfs": "0",
            
            # æ·»åŠ å•†å“æ˜ç»†
            "fyxm": [
                {
                    "fphxz": "0",
                    "spmc": "*ä¿¡æ¯æŠ€æœ¯æœåŠ¡*è½¯ä»¶å¼€å‘æœåŠ¡",
                    "je": "10",
                    "sl": "0.01",
                    "se": "0.1",
                    "hsbz": "1",
                    "spbm": "3040201010000000000"
                }
            ],
            
            # åˆè®¡é‡‘é¢
            "hjje": "9.9",
            "hjse": "0.1",
            "jshj": "10"
        }
        
        invoice_response = client.invoice.issue_blue_invoice(**invoice_params)
        print(f"{invoice_response.get('code')} å¼€ç¥¨ç»“æœ: {invoice_response.get('msg')}")
        
        if invoice_response.get("code") == 200:
            print(f"å‘ç¥¨å·ç : {invoice_response.get('data', {}).get('Fphm')}")
            print(f"å¼€ç¥¨æ—¥æœŸ: {invoice_response.get('data', {}).get('Kprq')}")
            fphm = invoice_response.get('data', {}).get('Fphm')
            time.sleep(10)  # ç­‰å¾…10ç§’
        
        # ä¸‹è½½å‘ç¥¨
        pdf_params = {
            "downflag": "4",
            "nsrsbh": nsrsbh,
            "username": username,
            "fphm": fphm
        }
        
        pdf_response = client.invoice.get_pdf_ofd_xml(**pdf_params)
        if pdf_response.get("code") == 200:
            print(pdf_response.get("data"))

    elif status_code == 420:
        print("ç™»å½•(çŸ­ä¿¡è®¤è¯)")
        # ç™»å½•æ•°ç”µå‘ç¥¨å¹³å° çŸ­ä¿¡
        
        # # 1 å‘çŸ­ä¿¡éªŒè¯ç 
        # sms_code = ""
        # login_response = client.auth.login_dppt(nsrsbh=nsrsbh, username=username, password=password, sms_code=None)
        # if login_response.get("code") == 200:
        #     print(login_response.get("msg"))
        #     print(f"è¯·{username}æ¥æ”¶éªŒè¯ç ")
        #     time.sleep(60)  # æ¨¡æ‹Ÿç­‰å¾…60ç§’
        
        # # 2 è¾“å…¥éªŒè¯ç 
        # print("è¯·è¾“å…¥éªŒè¯ç ")
        # sms_code = input("éªŒè¯ç : ")  # è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè·å–éªŒè¯ç 
        # login_response2 = client.auth.login_dppt(nsrsbh=nsrsbh, username=username, password=password, sms_code=sms_code)
        # if login_response2.get("code") == 200:
        #     print(login_response2.get("data"))
        #     print("éªŒè¯æˆåŠŸ")
    
    elif status_code == 430:
        print("äººè„¸è®¤è¯")
        # 1 è·å–äººè„¸äºŒç»´ç 
        qr_code_response = client.auth.get_face_img(nsrsbh=nsrsbh, username=username, type="1")
        print("äºŒç»´ç : " + str(qr_code_response.get("data")))
        
        ewmlyx = qr_code_response.get("data", {}).get("ewmlyx")
        if ewmlyx == "swj":
            print("è¯·ä½¿ç”¨ç¨åŠ¡å±€appæ‰«ç ")  # ewmè‡ªå·±ç”ŸæˆäºŒç»´ç 
        elif ewmlyx == "grsds":
            print("ä¸ªäººæ‰€å¾—ç¨appæ‰«ç ")  # ewmæ˜¯äºŒç»´ç çš„base64
        
        # 2 è®¤è¯å®Œæˆå è·å–äººè„¸äºŒç»´ç è®¤è¯çŠ¶æ€
        rzid = qr_code_response.get("data", {}).get("rzid")
        # rzid = "5c028e62f23e4b5ca57668bc74c0de98"
        face_status_response = client.auth.get_face_state(nsrsbh=nsrsbh, rzid=rzid, username=username, type="1")
        print("code: " + str(face_status_response.get("code")))
        print("data: " + str(face_status_response.get("data")))
        
        if face_status_response.get("data") is not None:
            slzt = face_status_response.get("data", {}).get("slzt")
            if slzt == "1":
                print("æœªè®¤è¯")
            elif slzt == "2":
                print("æˆåŠŸ")
            elif slzt == "3":
                print("äºŒç»´ç è¿‡æœŸ-->é‡æ–°è·å–äººè„¸äºŒç»´ç ")
    
    elif status_code == 401:
        # é‡æ–°æˆæƒ
        print(f"{status_response.get('code')}æˆæƒå¤±è´¥:{status_response.get('msg')}")
    
    else:
        print(f"{status_response.get('code')}  {status_response.get('msg')}")

except Exception as e:
    # æ‰“å°å®Œæ•´å †æ ˆä¿¡æ¯ï¼ˆåŒ…å«è¡Œå·ï¼‰
    traceback.print_exc()  # æ–°å¢å †æ ˆè·Ÿè¸ª
    
    # æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    print(f"\né”™è¯¯å‘ç”Ÿæ—¶å‚æ•°çŠ¶æ€ï¼š")
    print(f"å½“å‰æ—¶é—´æˆ³: {int(time.time())}")

```
[å‘ç¥¨çº¢å†²](examples\red_invoice_example.py "å‘ç¥¨çº¢å†²")
