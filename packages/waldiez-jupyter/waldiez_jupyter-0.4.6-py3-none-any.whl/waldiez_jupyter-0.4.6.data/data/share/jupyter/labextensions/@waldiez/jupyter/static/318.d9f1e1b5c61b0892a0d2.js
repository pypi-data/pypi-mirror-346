"use strict";(self.webpackChunk_waldiez_jupyter=self.webpackChunk_waldiez_jupyter||[]).push([[318],{318:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});const o="@waldiez/jupyter",r=`${o}:plugin`,i="Waldiez editor",s="waldiez";var a;!function(e){e.PLUGIN_DESCRIPTION="Waldiez JupyterLab extension.",e.WALDIEZ_FILE="Waldiez File",e.NEW_WALDIEZ_FILE="New Waldiez File",e.CAPTION="Create a new Waldiez file",e.TO_PYTHON="To python",e.TO_PYTHON_CAPTION="Export .waldiez to .py",e.TO_JUPYTER="To notebook",e.TO_JUPYTER_CAPTION="Export .waldiez to .ipynb",e.OPEN_WALDIEZ="Open Waldiez",e.ON_EMPTY_PROMPT="Enter your message to start the chat:",e.LOG_CONSOLE="Log Console",e.SHOW_LOGS="Show logs",e.CLEAR_LOGS="Clear Logs",e.HIDE_LOGS="Hide logs",e.RESTART_KERNEL="Restart kernel",e.INTERRUPT_KERNEL="Interrupt kernel",e.KERNEL_INTERRUPTED="Kernel interrupted",e.KERNEL_RESTARTED="Kernel restarted",e.SHUTDOWN_KERNEL="Shutdown kernel",e.CHANGE_KERNEL="Change kernel",e.RECONNECT_TO_KERNEL="Reconnect to kernel",e.LOGGER_INITIALIZED="Waldiez logger initialized",e.AFTER_INSTALL_NOTE="NOTE: If new packages were added and you are using Jupyter, you might need to restart the kernel.",e.NO_KERNEL="No kernel",e.NO_KERNEL_MESSAGE="Please start a kernel before running the workflow.",e.KERNEL_STATUS_CHANGED=e=>`Kernel status changed to ${e}`}(a||(a={}));var l=n(235),d=n(434);const c=new l.LabIcon({name:"waldiez:icon/logo",svgstr:d});var h=n(266),g=n(713);const u=async(e,t)=>{const n=[],o=e.tracker.currentWidget?.selectedItems();if(o)for(const e of o)e.name.endsWith(".waldiez")&&n.push(e.path);n.length>0&&await m(n,t)},m=async(e,t)=>{const n=g.ServerConnection.makeSettings(),o=h.URLExt.join(n.baseUrl,"waldiez","files");let r;try{r=await g.ServerConnection.makeRequest(o,{body:JSON.stringify({files:e,extension:t}),method:"POST"},n)}catch(e){throw new g.ServerConnection.NetworkError(e)}const i=await r.text();if(i.length>0)try{JSON.parse(i)}catch(e){console.log("Not a JSON response body.",r)}if(!r.ok)throw new g.ServerConnection.ResponseError(r,i.message||i)};var _,p=n(551);!function(e){e.createNew="waldiez:create-new",e.openWaldiez="waldiez:open-waldiez",e.clearLogs="waldiez:clear-logs",e.toggleLogsView="waldiez:toggle-logs-view",e.interruptKernel="waldiez:interrupt-kernel",e.reconnectToKernel="waldiez:reconnect-to-kernel",e.shutdownKernel="waldiez:shutdown-kernel",e.restartKernel="waldiez:restart-kernel",e.changeKernel="waldiez:change-kernel",e.exportToPython="waldiez:to-py",e.exportToJupyter="waldiez:to-ipynb"}(_||(_={}));const b=(e,t)=>null!==t.currentWidget&&t.currentWidget===e.shell.currentWidget;var w=n(73);class f{constructor(e){Object.defineProperty(this,"_commands",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_rendermime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_loggerRegistry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_logConsole",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_widget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_toggleConsoleViewButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_widgetIsVisible",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_toggleConsoleViewCommandId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_logConsoleClearCommandId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._id=e.editorId,this._commands=e.commands,this._rendermime=e.rendermime,this._logConsoleClearCommandId=`${_.clearLogs}-${this._id}`,this._toggleConsoleViewCommandId=`${_.toggleLogsView}-${this._id}`,this._loggerRegistry=new w.LoggerRegistry({defaultRendermime:this._rendermime,maxLength:1e3}),this._logConsole=new w.LogConsolePanel(this._loggerRegistry),this._logConsole.id=`waldiez-log-console-${this._id}`,this._logConsole.title.label=a.LOG_CONSOLE,this._logConsole.source=`Waldiez-${this._id}`,this._widgetIsVisible=!1,this._toggleConsoleViewButton=new l.CommandToolbarButton({commands:this._commands,id:this._toggleConsoleViewCommandId,icon:l.consoleIcon,label:()=>this._widgetIsVisible?` ${a.HIDE_LOGS}`:` ${a.SHOW_LOGS}`}),this._panel=e.panel,this._widget=this._getLogWidget(),this._getLogger().level="info"}get toggleConsoleViewButton(){return this._toggleConsoleViewButton}get isVisible(){return this._widgetIsVisible}get widget(){return this._widget}log(e){if("string"==typeof e&&this._logData({data:e,level:"info",type:"text"}),"level"in e)this._logData(e);else{if(!("object"!=typeof e||e&&"header"in e))return void this._logData({data:JSON.stringify(e),level:"info",type:"text"});"error"===e.header.msg_type?(this._logData({data:e.content.ename,level:"error",type:"text"}),this._logData({data:e.content.evalue,level:"error",type:"text"}),this._logData({data:e.content.traceback.join("\n"),level:"error",type:"text"})):"stream"===e.header.msg_type?this._logIOPub(e):"input_request"===e.header.msg_type?this._logStdin(e):"execute_reply"===e.header.msg_type?this._logReply(e):"execute_request"===e.header.msg_type&&this._logExecuteRequest(e)}this._scrollToBottom()}toggle(){this._widgetIsVisible?this._widget.hide():this._widget.show(),this._panel.contains(this._widget)||this._panel.addWidget(this._widget),this._panel.setRelativeSizes([4,1]),this._widgetIsVisible=!this._widgetIsVisible,this._toggleConsoleViewButton.update()}clear(){this._getLogger().clear()}dispose(){this._logConsole.dispose();for(const e of[this._toggleConsoleViewCommandId,this._logConsoleClearCommandId])this._commands.hasCommand(e)&&this._commands.notifyCommandChanged(e)}_scrollToBottom(e=0){const t=this._logConsole.node.querySelectorAll(".jp-OutputArea-child");if(!t)return e<5?void setTimeout((()=>this._scrollToBottom(e+1)),1e3):void 0;const n=t[t.length-1];n&&n.scrollIntoView()}_getLogWidget(){const e=new p.MainAreaWidget({content:this._logConsole});return e.toolbar.addItem("clear",new l.CommandToolbarButton({commands:this._commands,id:this._logConsoleClearCommandId})),this._commands.hasCommand(this._logConsoleClearCommandId)||this._commands.addCommand(this._logConsoleClearCommandId,{execute:()=>this._getLogger().clear(),isEnabled:()=>!!this._logConsole&&null!==this._logConsole.source,label:` ${a.CLEAR_LOGS}`,icon:l.clearIcon}),this._commands.hasCommand(this._toggleConsoleViewCommandId)||this._commands.addCommand(this._toggleConsoleViewCommandId,{execute:this.toggle.bind(this)}),e}_logIOPub(e){const t=e.content;if("stdout"===t.name||"stderr"===t.name){let e="info";const n=t.text,o=n.toLowerCase();"stderr"===t.name&&(!o.includes("warning")||o.includes("error")&&!o.includes("exception")||(e="warning"));const r={data:n,level:e,type:"text"};this._logData(r)}}_logStdin(e){const t={data:e.content.prompt,level:"warning",type:"text"};this._logData(t)}_logReply(e){const t={data:e.content.status,level:"info",type:"text"};this._logData(t)}_logExecuteRequest(e){const t={data:e.content.code,level:"info",type:"text"};this._logData(t)}_logData(e){this._getLogger().log(e)}_getLogger(){return this._loggerRegistry.getLogger(`Waldiez-${this._id}`)}}class y{constructor({logger:e,onStdin:t}){Object.defineProperty(this,"_running",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_future",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_onStdin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_logger",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._logger=e,this._onStdin=t}get running(){return this._running}run(e,t){if(this._running)return void console.warn("A waldiez file is already running");this._running=!0,this._messages=[];const n=(e=>`from pathlib import Path\nfrom waldiez import WaldiezRunner\n\nfile_path = Path(r"${e}").as_posix()\nrunner = WaldiezRunner.load(waldiez_file=file_path)\nrunner.run()`)(t);this._future=e.requestExecute({code:n,stop_on_error:!0},!1),this._onFuture()}reset(){this._running=!1,this._future=void 0,this._messages=[]}getPreviousMessages(e){let t=-1;for(let e=this._messages.length-1;e>=0;e--)if(this._messages[e].includes(a.AFTER_INSTALL_NOTE)){t=e;break}t>=0&&(this._messages=this._messages.slice(t+1));const n=this._messages.length-1;this._messages[n]===e&&(this._messages=this._messages.slice(0,n));const o=[];for(const t of this._messages)if(t!==e&&t!==e+"\n"){const e=t.split("\n");for(const t of e)o.push(this._remove_ansi(t))}return o}_remove_ansi(e){return e.replace(/\u001b\[[0-9;]*m/g,"")}_onFuture(){if(!this._future)return console.error("Failed to create a future for the waldiez file"),void this.reset();this._future.onStdin=e=>{const t=e,n=t.content.prompt;[">","> "].includes(n)||this._messages.push(t.content.prompt),this._onStdin(t)},this._future.onIOPub=e=>{const t=e.header.msg_type;if("stream"===t){const t=e;"stdout"===t.content.name&&this._messages.push(t.content.text),this._logger.log(t)}else"error"===t&&this._logger.log(e)},this._future.onReply=e=>{this._messages.push(e.content.status),this._logger.log(e)},this._future.done.catch((e=>{console.error("Error while running the waldiez file",e),e||(e={channel:"iopub",content:{name:"stderr",text:"Failed to run the waldiez file"},header:{msg_type:"stream"},metadata:{}}),this._logger.log(e)})).finally((()=>{this.reset()}))}}var C=n(848),v=n(992);n(794);class E extends l.ReactWidget{constructor(e){super(),Object.defineProperty(this,"_inputPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_waldiez",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.addClass("jp-waldiez-widget"),this._inputPrompt=e.inputPrompt;const t=(0,v.importFlow)(e.jsonData);this._waldiez={...t,flowId:e.flowId,storageId:t.storageId??e.flowId,onChange:e.onChange,onRun:e.onRun,onUserInput:e.onUserInput,onUpload:e.onUpload,monacoVsPath:e.vsPath}}render(){return(0,C.jsx)(l.UseSignal,{signal:this._inputPrompt,initialArgs:null,children:(e,t)=>(0,C.jsx)(v.Waldiez,{...this._waldiez,inputPrompt:t})})}}var I=n(178),R=n(602);class O extends I.DocumentWidget{constructor(e){super(e),Object.defineProperty(this,"_commands",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_settingsRegistry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_stdinRequest",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_inputPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_logger",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_runner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_restartKernelCommandId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interruptKernelCommandId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_restartKernelButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interruptKernelButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serverSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._commands=e.commands,this._settingsRegistry=e.settingregistry,this._inputPrompt=new R.Signal(this),this._logger=new f({commands:this._commands,editorId:this.id,panel:this.content,rendermime:e.rendermime}),this._restartKernelCommandId=`${_.restartKernel}-${this.id}`,this._interruptKernelCommandId=`${_.interruptKernel}-${this.id}`,this._restartKernelButton=new l.CommandToolbarButton({commands:this._commands,id:this._restartKernelCommandId,icon:l.kernelIcon,label:` ${a.RESTART_KERNEL}`}),this._interruptKernelButton=new l.CommandToolbarButton({commands:this._commands,id:this._interruptKernelCommandId,icon:l.kernelIcon,label:` ${a.INTERRUPT_KERNEL}`}),this.toolbar.addItem("toggle-logs-view",this._logger.toggleConsoleViewButton),this.toolbar.addItem("clear-logs",this._interruptKernelButton),this.toolbar.addItem("restart-kernel",this._restartKernelButton),this._serverSettings=g.ServerConnection.makeSettings(),this._runner=new y({logger:this._logger,onStdin:this._onStdin.bind(this)}),this.context.ready.then(this._onContextReady.bind(this)),this.context.sessionContext.statusChanged.connect(this._onSessionStatusChanged,this),this._initCommands()}dispose(){super.dispose(),this.content.dispose(),this._logger.dispose(),this._restartKernelButton.dispose(),this._commands.hasCommand(this._restartKernelCommandId)&&this._commands.notifyCommandChanged(this._restartKernelCommandId),this._interruptKernelButton.dispose(),this._commands.hasCommand(this._interruptKernelCommandId)&&this._commands.notifyCommandChanged(this._interruptKernelCommandId),this._runner.reset()}_onSessionStatusChanged(e,t){this._logger.log({data:a.KERNEL_STATUS_CHANGED(t),level:"info",type:"text"})}_onContextReady(){this._getServeMonacoSetting().then((e=>{const t=this._getWaldiezWidget(e);this.content.addWidget(t);const n={data:a.LOGGER_INITIALIZED,level:"info",type:"text"};this._logger.log(n)}))}_initCommands(){this._commands.hasCommand(this._restartKernelCommandId)||this._commands.addCommand(this._restartKernelCommandId,{execute:this._onRestartKernel.bind(this),label:` ${a.RESTART_KERNEL}`}),this._commands.hasCommand(this._interruptKernelCommandId)||this._commands.addCommand(this._interruptKernelCommandId,{execute:this._onInterruptKernel.bind(this),label:` ${a.INTERRUPT_KERNEL}`})}_onRestartKernel(){const e=this.context.sessionContext.session;e?.kernel&&e.kernel.restart()}_onInterruptKernel(){const e=this.context.sessionContext.session;e?.kernel&&e.kernel.interrupt()}_onContentChanged(e){e!==this.context.model.toString()&&(this.context.model.fromString(e),this.context.model.dirty=!0)}_getServeMonacoSetting(){return new Promise((e=>{this._settingsRegistry.get(r,"serve_monaco").then((t=>{if(t.composite){let t=this._serverSettings.baseUrl.replace(/https?:\/\/[^/]+/,"");t.endsWith("/")||(t+="/"),e(`${t}static/vs`)}else e(null)})).catch((t=>{console.error(t),e(null)}))}))}onUpload(e){return new Promise((t=>{const n=[],o=e.map((async e=>{try{const t=await(async e=>{const t=g.ServerConnection.makeSettings(),n=h.URLExt.join(t.baseUrl,"waldiez","upload");let o;try{const r=new FormData;r.append("file",e),o=await g.ServerConnection.makeRequest(n,{body:r,method:"POST"},t)}catch(e){throw new g.ServerConnection.NetworkError(e)}const r=await o.text();if(r.length>0)try{JSON.parse(r)}catch(e){throw new Error("Not a JSON response body.")}let i;if(!o.ok)throw new g.ServerConnection.ResponseError(o,r.message||r);if(r.length>0)try{i=JSON.parse(r)}catch(e){throw new Error("Not a JSON response body.")}return i.path})(e);n.push(t)}catch(e){let t="Unknown error";e instanceof Error&&(t=e.message),"string"==typeof e&&(t=e),"function"==typeof e.toString&&(t=e.toString()),"string"==typeof e.message&&(t=e.message),"object"==typeof e&&null!==e&&(t=JSON.stringify(e)),this._logger.log({data:t,level:"error",type:"text"})}}));Promise.all(o).then((()=>{t(n)}))}))}_getWaldiezWidget(e){const t=this.context.model.toString();let n={};try{n=JSON.parse(t)}catch(e){}return new E({flowId:this.id,jsonData:n,inputPrompt:this._inputPrompt,vsPath:e,onChange:this._onContentChanged.bind(this),onRun:this._onRun.bind(this),onUserInput:this._onUserInput.bind(this),onUpload:this.onUpload})}_onStdin(e){let t=e.content.prompt;">"!==t&&"> "!==t||(t=a.ON_EMPTY_PROMPT),this._logger.log({data:t,level:"warning",type:"text"}),this._stdinRequest=e,this._inputPrompt.emit({previousMessages:this._runner.getPreviousMessages(t),prompt:t})}_onUserInput(e){this._inputPrompt.emit(null),this._stdinRequest&&(this.context.sessionContext.session?.kernel?.sendInputReply({value:e,status:"ok"},this._stdinRequest.parent_header),this._stdinRequest=null)}_onRun(e){const t=this.context.sessionContext.session?.kernel;t?(this._logger.isVisible||this._logger.toggle(),this.context.model.dirty&&this.context.save(),(async e=>{const t=g.ServerConnection.makeSettings(),n=h.URLExt.join(t.baseUrl,"waldiez","files","?path="+e);let o;try{o=await g.ServerConnection.makeRequest(n,{method:"GET"},t)}catch(e){throw new g.ServerConnection.NetworkError(e)}const r=await o.text();let i;if(r.length>0)try{i=JSON.parse(r)}catch(e){throw new Error("Not a JSON response body.")}if(!o.ok)throw new g.ServerConnection.ResponseError(o,r.message||r);if(!i)throw new Error("No data returned from the server");return i.path})(this.context.path).then((e=>{this._runner.run(t,e)})).catch((e=>{this._logger.log({data:e,level:"error",type:"text"})}))):(0,p.showErrorMessage)(a.NO_KERNEL,a.NO_KERNEL_MESSAGE)}}var S=n(256);class P extends I.ABCWidgetFactory{constructor(e){super(e),Object.defineProperty(this,"_commands",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_rendermime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_editorServices",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_settingRegistry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._commands=e.commands,this._rendermime=e.rendermime,this._editorServices=e.editorServices,this._settingRegistry=e.settingRegistry}get name(){return i}createNewWidget(e){const t=new S.SplitPanel({orientation:"vertical",alignment:"start",spacing:0});return t.title.label="Waldiez",t.title.closable=!0,new O({context:e,rendermime:this._rendermime,editorServices:this._editorServices,settingregistry:this._settingRegistry,content:t,commands:this._commands})}}var x=n(118),N=n(764),T=n(498),L=n(968),K=n(226),k=n(208),z=n(653),W=n(981);const j={id:r,description:a.PLUGIN_DESCRIPTION,autoStart:!0,requires:[k.IRenderMimeRegistry,N.IEditorServices,T.IFileBrowserFactory,z.ISettingRegistry],optional:[x.ILayoutRestorer,L.ILauncher,p.ICommandPalette,K.IMainMenu,W.ITranslator],activate:async(e,t,n,r,d,h,g,m,w,f)=>{console.log("JupyterLab extension waldiez is activated!");const y=o,C=new p.WidgetTracker({namespace:y}),v=new P({name:"Waldiez",fileTypes:[s],defaultFor:[s],canStartKernel:!0,preferKernel:!0,shutdownOnClose:!1,autoStartDefault:!0,commands:e.commands,translator:f,rendermime:t,editorServices:n,settingRegistry:d});return g&&g.add({command:_.createNew,category:"Other",rank:1}),m&&m.addItem({command:_.createNew,args:{isPalette:!0},category:i}),h&&h.restore(C,{command:_.openWaldiez,args:e=>({path:e.context.path,factory:i}),name:e=>e.context.path}),v.widgetCreated.connect(((t,n)=>{n.title.icon=c,n.context.pathChanged.connect((()=>{C.save(n)})),C.has(n)||C.add(n),n.isAttached||e.shell.add(n,"main"),e.shell.activateById(n.id)})),e.docRegistry.addFileType({name:s,displayName:a.WALDIEZ_FILE,contentType:"file",fileFormat:"json",extensions:[`.${s}`],mimeTypes:["application/json","text/json"],icon:c,iconLabel:"JupyterLab-Waldiez"}),e.docRegistry.addWidgetFactory(v),await(async(e,t,n,o,r,i)=>{const d=b.bind(null,e,t);((e,t,n,o,r,i)=>{const{commands:d}=e,h=n=>{const o=t.currentWidget;return!1!==n.activate&&o&&e.shell.activateById(o.id),o??null};d.addCommand(_.createNew,{label:e=>e.isPalette?a.NEW_WALDIEZ_FILE:a.WALDIEZ_FILE,caption:a.CAPTION,icon:c,execute:async t=>{const r=t.cwd||n.tracker.currentWidget?.model.path||"",i=await d.execute("docmanager:new-untitled",{path:r,type:"file",ext:`.${s}`});if(!i)return void console.error("Could not create a new .waldiez file");const a=await d.execute(_.openWaldiez,{cwd:r,path:i.path,factory:o.name});a&&(a.isAttached||e.shell.add(a,"main"),e.shell.activateById(a.id))}}),d.addCommand(_.openWaldiez,{label:a.OPEN_WALDIEZ,icon:c,execute:async t=>{const n=t.path,r=await e.commands.execute("docmanager:open",{path:n??`Untitled.${s}`,factory:o.name});r&&(r.isAttached||e.shell.add(r,"main"),e.shell.activateById(r.id))}}),d.addCommand(_.exportToPython,{label:a.TO_PYTHON,caption:a.TO_PYTHON_CAPTION,icon:l.pythonIcon,execute:async()=>u(n,"py")}),d.addCommand(_.exportToJupyter,{label:a.TO_JUPYTER,caption:a.TO_JUPYTER_CAPTION,icon:l.notebookIcon,execute:async()=>u(n,"ipynb")}),d.addCommand(_.interruptKernel,{label:a.INTERRUPT_KERNEL,execute:e=>{const t=h(e);if(!t)return;const n=t.context.sessionContext.session?.kernel;return n?n.interrupt():Promise.resolve(void 0)},isEnabled:r}),d.addCommand(_.restartKernel,{label:a.RESTART_KERNEL,execute:e=>{const t=h(e);if(!t)return;const n=t.context.sessionContext.session?.kernel;return n?n.restart():Promise.resolve(void 0)},isEnabled:r}),d.addCommand(_.changeKernel,{label:a.CHANGE_KERNEL,execute:e=>{const t=h(e);if(!t)return;const n=t.context.sessionContext;if(!n.session)return;const o=n.specsManager.specs?.kernelspecs;return o?new p.SessionContextDialogs({translator:i}).selectKernel(n):void 0},isEnabled:r}),d.addCommand(_.shutdownKernel,{label:a.SHUTDOWN_KERNEL,execute:e=>{const t=h(e);if(t)return t.context.sessionContext.shutdown()},isEnabled:r}),d.addCommand(_.reconnectToKernel,{label:a.RECONNECT_TO_KERNEL,execute:e=>{const t=h(e);if(!t)return;const n=t.context.sessionContext.session?.kernel;return n?n.reconnect():Promise.resolve(void 0)},isEnabled:r})})(e,t,n,o,d,i),r&&((e,t)=>{e.fileMenu.newMenu.addItem({command:_.createNew}),e.kernelMenu.kernelUsers.interruptKernel.add({id:_.interruptKernel,isEnabled:t}),e.kernelMenu.kernelUsers.reconnectToKernel.add({id:_.reconnectToKernel,isEnabled:t}),e.kernelMenu.kernelUsers.restartKernel.add({id:_.restartKernel,isEnabled:t}),e.kernelMenu.kernelUsers.shutdownKernel.add({id:_.shutdownKernel,isEnabled:t}),e.kernelMenu.kernelUsers.changeKernel.add({id:_.changeKernel,isEnabled:t})})(r,d)})(e,C,r,v,w,f),v}}}}]);