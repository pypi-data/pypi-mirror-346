<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory Browser</title>
    <style>
        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        li {
            margin-left: 20px;
        }

        li:hover {
            background-color: #f0f0f0;
            cursor: pointer;
        }

        .folder:before {
            content: "üìÅ";
            margin-right: 5px;
        }

        .file:before {
            content: "üìÑ";
            margin-right: 5px;
        }
    </style>
</head>

<body>
    <h1>Server Directory Browser</h1>
    <ul id="directoryList"></ul>
    <button id="confirmSelection" style="margin-top: 10px;">Perform Action on Selection</button>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        let currentPath = '';

        function fetchDirectory(path) {
            $.getJSON(`http://127.0.0.1:8000/list-directory?sub_path=${encodeURIComponent(path)}`, function (data) {
                const directoryList = $('#directoryList');
                directoryList.empty();  // Clear the current list

                // Create a "go up" entry if not at the root
                if (path) {
                    directoryList.append('<li class="folder">.. (Go Up)</li>');
                }

                // Display files and folders
                data.forEach(item => {
                    const li = $('<li>');
                    if (!item.is_folder) {
                        li.append(`<input type="checkbox" value="${path ? `${path}/${item.name}` : item.name}" class="file-checkbox">`);
                    }
                    li.append('<span>' + item.name + '</span>');
                    li.addClass(item.is_folder ? 'folder' : 'file');

                    if (item.is_folder) {
                        li.click(() => {
                            currentPath = path ? `${path}/${item.name}` : item.name;
                            fetchDirectory(currentPath);
                        });
                    }

                    directoryList.append(li);
                });

                // "Go up" mechanism
                $('#directoryList .folder').first().click(() => {
                    const parts = currentPath.split('/');
                    parts.pop();  // Go up one level
                    currentPath = parts.join('/');
                    fetchDirectory(currentPath);
                });

            }).fail(function () {
                alert('Failed to load directory contents');
            });
        }

        $(document).ready(function () {
            fetchDirectory(currentPath);  // Load the initial directory

            $('#confirmSelection').click(function () {
                const selectedFiles = [];
                $('.file-checkbox:checked').each(function () {
                    selectedFiles.push(this.value);
                });

                if (selectedFiles.length > 0) {
                    alert('Selected files: ' + selectedFiles.join(', '));
                    // Implement further actions like download, or processing here.
                } else {
                    alert('No files selected.');
                }
            });
        });
    </script>
</body>

</html>